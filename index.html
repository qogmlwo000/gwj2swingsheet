<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GWJ2 OB Ïù∏Ïõê Í¥ÄÎ¶¨ ÏãúÌä∏</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700;800&display=swap');

        /* ÏÉâÏÉÅ Î≥ÄÏàò - ÍπîÎÅîÌïú ÌåîÎ†àÌä∏ */
        :root[color-theme='light'] {
            --bg-primary: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            --surface-primary: rgba(255, 255, 255, 0.8);
            --surface-secondary: rgba(255, 255, 255, 0.6);
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --accent: #3b82f6;
            --accent-hover: #2563eb;
            --border: rgba(148, 163, 184, 0.2);
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        :root[color-theme='dark'] {
            --bg-primary: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            --surface-primary: rgba(30, 41, 59, 0.8);
            --surface-secondary: rgba(30, 41, 59, 0.6);
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --accent: #60a5fa;
            --accent-hover: #3b82f6;
            --border: rgba(148, 163, 184, 0.1);
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.2), 0 1px 2px rgba(0, 0, 0, 0.12);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
			font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
			background: var(--bg-primary);
			color: var(--text-primary);
			min-height: 100vh;
			font-size: 14px;
			line-height: 1.5;
			transition: background 0.15s ease, color 0.15s ease;  /* ÌäπÏ†ï ÏÜçÏÑ±Îßå Îπ†Î•¥Í≤å */
			-webkit-font-smoothing: antialiased;
			-moz-osx-font-smoothing: grayscale;
		}

        /* Í≥†Ï†ï Ìó§Îçî */
        .fixed-header {
            position: fixed;
            top: 16px;
            left: 16px;
            right: 16px;
            background: var(--surface-primary);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--border);
            border-radius: 16px;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .fixed-header:hover {
            transform: translateY(-1px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        /* Ìó§Îçî ÏÉÅÎã® */
        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
        }

        .header-title {
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
            letter-spacing: -0.025em;
            position: relative;
            overflow: visible;
        }

        .title-text {
            position: relative;
            background: linear-gradient(45deg, #667eea, #764ba2, #f093fb, #f5576c, #4facfe, #00f2fe);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: smooth-gradient-flow 8s ease-in-out infinite, subtle-glow 4s ease-in-out infinite;
            filter: brightness(1.1);
        }

        .title-text::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(
                circle at center,
                rgba(255, 255, 255, 0.15) 0%,
                rgba(255, 255, 255, 0.08) 30%,
                transparent 70%
            );
            opacity: 0;
            animation: ethereal-glow 8s ease-in-out infinite;
            pointer-events: none;
        }
        
        .date-display {
            display: inline-flex; 
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 600;
            color: #ffffff;
            background-color: #ef4444; 
            border: 1px solid #dc2626; 
            border-radius: 12px;
            padding: 6px 10px;
            margin-left: 12px;
            vertical-align: middle;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
            animation: fadeIn 0.8s ease-out forwards;
            white-space: nowrap;
            letter-spacing: -0.01em;
        }

        .capture-btn {
            background: var(--surface-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 16px;
            line-height: 1;
            transition: all 0.2s ease;
        }
        .capture-btn:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        @keyframes subtle-glow {
            0%, 100% { 
                filter: brightness(1.1) drop-shadow(0 0 8px rgba(102, 126, 234, 0.2));
            }
            50% { 
                filter: brightness(1.2) drop-shadow(0 0 12px rgba(102, 126, 234, 0.3));
            }
        }

        @keyframes ethereal-glow {
            0%, 80% { 
                opacity: 0;
                transform: scale(0.8);
            }
            85% { 
                opacity: 0.6;
                transform: scale(1.1);
            }
            95% { 
                opacity: 0.3;
                transform: scale(1.3);
            }
            100% { 
                opacity: 0;
                transform: scale(1.5);
            }
        }

        .rocket {
            font-size: 24px;
            animation: rocket-thruster 2s ease-in-out infinite;
            filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.6));
        }

        @keyframes smooth-gradient-flow {
            0%, 100% { 
                background-position: 0% 50%;
                filter: brightness(1);
            }
            25% { 
                background-position: 100% 50%;
                filter: brightness(1.1);
            }
            50% { 
                background-position: 50% 100%;
                filter: brightness(1.05);
            }
            75% { 
                background-position: 100% 0%;
                filter: brightness(1.1);
            }
        }

        @keyframes rocket-thruster {
            0%, 100% { 
                transform: translateY(0px) rotate(-5deg);
                filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.6));
            }
            25% { 
                transform: translateY(-1px) rotate(0deg);
                filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.7));
            }
            75% { 
                transform: translateY(-0.5px) rotate(2deg);
                filter: drop-shadow(0 0 6px rgba(255, 215, 0, 0.5));
            }
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        /* ÏãúÍ≥Ñ Ïä§ÌÉÄÏùº */
        .clock-display {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: var(--surface-primary);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid var(--border);
            border-radius: 16px;
            box-shadow: var(--shadow);
            transition: all 0.2s ease;
        }

        .clock-display:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .clock-emoji {
            font-size: 18px;
            opacity: 0.8;
            margin-right: 4px;
        }

        .time-segment {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .time-unit {
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .digit-box {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 32px;
            background: var(--surface-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-family: 'Noto Sans KR', monospace;
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
        }

        .time-separator {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-secondary);
            margin: 0 2px;
            animation: blink 2s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        /* ÎßàÍ∞ê ÏûÑÎ∞ï Ìö®Í≥º */
        .clock-urgent .digit-box {
            background: rgba(239, 68, 68, 0.1) !important;
            border-color: #ef4444 !important;
            color: #ef4444 !important;
        }

        .clock-urgent .time-separator {
            color: #ef4444 !important;
        }

        @keyframes urgent-pulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: var(--shadow), 0 0 0 0 rgba(239, 68, 68, 0.4);
            }
            50% { 
                transform: scale(1.02);
                box-shadow: var(--shadow), 0 0 0 4px rgba(239, 68, 68, 0.1);
            }
        }

        .clock-urgent {
            animation: urgent-pulse 1.5s ease-in-out infinite;
        }

        /* Îã§ÌÅ¨/ÎùºÏù¥Ìä∏ Î™®Îìú ÌÜ†Í∏Ä */
        .dark-light-toggle {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            width: 48px;
            height: 48px;
            background: var(--surface-secondary);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            overflow: hidden;
        }

        .dark-light-toggle:hover {
            transform: translateY(-1px);
            background: var(--surface-primary);
            border-color: var(--border);
        }

        .icon30 {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 24px;
            height: 24px;
            position: absolute;
        }

        .icon30 > svg {
            transition: all 0.3s ease;
        }

        .sun {
            animation: rise-animation 0.6s ease-out forwards;
            transform-origin: center;
        }

        .moon {
            animation: set-animation 0.6s ease-out forwards;
            transform-origin: center;
        }

        [color-theme='dark'] .dark-light-toggle .sun {
            animation: set-animation 0.6s ease-out forwards;
        }

        [color-theme='dark'] .dark-light-toggle .moon {
            animation: rise-animation 0.6s ease-out forwards;
        }

        .dark-light-toggle:hover svg {
            fill: #f59e0b;
            transform: scale(1.1);
        }

        @keyframes rise-animation {
            from { 
                transform: rotate(-90deg) scale(0.8);
                opacity: 0;
            }
            to { 
                transform: rotate(0deg) scale(1);
                opacity: 1;
            }
        }

        @keyframes set-animation {
            from { 
                transform: rotate(0deg) scale(1);
                opacity: 1;
            }
            to { 
                transform: rotate(90deg) scale(0.8);
                opacity: 0;
            }
        }

        /* ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò - Í∞ÄÎ°ú ÏùºÎ†¨ */
        .tab-navigation {
            padding: 16px 24px;
            background: transparent;
            border-bottom-left-radius: 16px;
            border-bottom-right-radius: 16px;
        }

        .tab-list {
            display: flex;
            align-items: center;
            gap: 32px;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
            padding: 4px 0;
        }

        .tab-list::-webkit-scrollbar {
            display: none;
        }

        .tab-item {
            position: relative;
            padding: 12px 4px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            user-select: none;
            flex-shrink: 0;
        }

        .tab-item::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--accent);
            transform: scaleX(0);
            transition: transform 0.3s ease;
            border-radius: 1px;
        }

        .tab-item:hover {
            color: var(--text-primary);
        }

        .tab-item.active {
            color: var(--accent);
            font-weight: 600;
        }

        .tab-item.active::after {
            transform: scaleX(1);
        }
		
		/* Î°úÍ∑∏Ïù∏ Î™®Îã¨ */
        .login-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .login-modal.active {
            display: flex;
        }

        .login-box {
            background: var(--surface-primary);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 40px;
            max-width: 400px;
            width: 90%;
            box-shadow: var(--shadow-lg);
            animation: fadeInUp 0.3s ease-out;
        }

        .login-title {
            font-size: 28px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 8px;
            text-align: center;
        }

        .login-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 32px;
            text-align: center;
        }

        .login-input {
            width: 100%;
            padding: 12px 16px;
            margin-bottom: 16px;
            background: var(--surface-secondary);
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 15px;
            color: var(--text-primary);
            transition: all 0.2s ease;
        }

        .login-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .login-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 8px;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
        }

        .login-btn:active {
            transform: translateY(0);
        }

        .user-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            background: var(--surface-primary);
            border: 1px solid var(--border);
            border-radius: 16px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .user-badge:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .user-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: 700;
        }

        .error-message {
            color: #ef4444;
            font-size: 13px;
            margin-top: -8px;
            margin-bottom: 16px;
            text-align: center;
        }
		
		/* Í¥ÄÎ¶¨Ïûê Ìå®ÎÑê */
        .admin-panel {
            margin-top: 24px;
            padding: 24px;
            background: var(--surface-secondary);
            border: 2px solid var(--accent);
            border-radius: 16px;
        }

        .admin-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-list {
            margin-bottom: 20px;
        }

        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--surface-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .delete-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .delete-btn:hover {
            background: #dc2626;
        }

        .add-user-form {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        .admin-input {
            flex: 1;
            padding: 10px 14px;
            background: var(--surface-primary);
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            color: var(--text-primary);
        }

        .admin-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .add-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .add-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        /* Î©îÏù∏ ÏΩòÌÖêÏ∏† */
        .main-content {
            margin-top: 140px;
            padding: 24px;
            min-height: calc(100vh - 140px);
        }

        .content-area {
            background: var(--surface-primary);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 32px;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease;
        }

        .content-area:hover {
            transform: translateY(-2px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
        }

        .welcome-message {
            text-align: center;
            color: var(--text-secondary);
            font-size: 16px;
            font-weight: 500;
            margin-top: 40px;
            line-height: 1.6;
            letter-spacing: -0.025em;
        }

        .welcome-message strong {
            color: var(--text-primary);
            font-weight: 600;
        }
		
		/* Î©îÏù∏ ÌôîÎ©¥ Ïï†ÎãàÎ©îÏù¥ÏÖò */
        @keyframes fadeInUp {
            from { 
                opacity: 0; 
                transform: translateY(30px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }
        
        @keyframes rocketPulse {
            0%, 100% { 
                transform: scale(1) rotate(-5deg);
            }
            50% { 
                transform: scale(1.15) rotate(0deg);
            }
        }
        
        @keyframes gradientFlow {
            0%, 100% { 
                background-position: 0% 50%;
            }
            50% { 
                background-position: 100% 50%;
            }
        }
        
        .welcome-title {
            animation: fadeInUp 0.8s ease-out;
            letter-spacing: -0.5px;
        }
        
        .welcome-title-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientFlow 8s ease infinite;
        }
        
        .welcome-subtitle {
            animation: fadeInUp 0.8s ease-out 0.2s backwards;
        }
        
        .welcome-line {
            animation: fadeInUp 0.8s ease-out 0.4s backwards;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.3);
        }
        
        .welcome-version {
            animation: fadeInUp 0.8s ease-out 0.6s backwards;
            opacity: 0.5;
            transition: opacity 0.3s ease;
        }
        
        .welcome-version:hover {
            opacity: 1;
        }
		
		/* Ïó∞Í≤∞ ÏÉÅÌÉú ÌëúÏãú */
        .connection-status {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: var(--surface-primary);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid var(--border);
            border-radius: 16px;
            box-shadow: var(--shadow);
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .connection-status.connected {
            border-color: rgba(34, 197, 94, 0.3);
            background: rgba(34, 197, 94, 0.08);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        .status-dot.connected {
            background: #22c55e;
            box-shadow: 0 0 8px rgba(34, 197, 94, 0.6);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(0.95); }
        }
		
		/* ÏûÖÎ†• Ï§ë ÌëúÏãú */
        .typing-indicator {
            display: none;
            align-items: center;
            padding: 8px 14px;
            background: var(--surface-primary);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid var(--border);
            border-radius: 16px;
            box-shadow: var(--shadow);
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
            gap: 6px;
        }
		
		/* Ïù∏Ïõê ÌòÑÌô© ÌÖåÏù¥Î∏î input Ïä§ÌÉÄÏùº */
        .staffing-input {
            width: 70px;
            text-align: center;
            background: var(--surface-secondary);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 6px 8px;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 15px;
            transition: all 0.2s ease;
            -moz-appearance: textfield;
        }
        
        .staffing-input::-webkit-outer-spin-button,
        .staffing-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        .staffing-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .staffing-input:hover {
            border-color: var(--accent);
        }

        .report-input {
            width: 100%;
            background: transparent;
            border: 1px solid transparent;
            border-radius: 6px;
            padding: 4px;
            text-align: center;
            color: var(--text-primary);
            font-weight: 500;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        .report-input:focus {
            outline: none;
            background: var(--surface-secondary);
            border-color: var(--accent);
        }

        @keyframes fadeIn {
            from { 
                opacity: 0;
                transform: translateY(10px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Î∞òÏùëÌòï */
        @media (max-width: 1200px) {
            .welcome-message > div:nth-of-type(2) {
                flex-direction: column;
                align-items: center;
            }
        }
        
        @media (max-width: 768px) {
            .tab-navigation {
                padding: 12px 20px;
            }

            .tab-list {
                gap: 24px;
            }
            
            .tab-item {
                font-size: 13px;
            }

            .main-content {
                margin-top: 160px;
            }

            .header-top {
                padding: 16px 20px;
            }

            .header-title {
                font-size: 18px;
            }
            
            .date-display {
                background: none;
                border: none;
                padding: 0;
                color: var(--text-secondary);
                box-shadow: none;
                font-size: 12px;
                margin-left: 8px;
                vertical-align: baseline;
            }
        }

        @media (max-width: 480px) {
            .tab-list {
                gap: 20px;
            }
            
            .tab-item {
                font-size: 12px;
            }
        }
		
		/* Î≥ÄÍ≤Ω Î°úÍ∑∏ Ìå®ÎÑê */
        .activity-log-btn {
            background: var(--surface-secondary);
            backdrop-filter: blur(8px);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 10px 14px;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: all 0.2s ease;
            font-size: 18px;
            margin-right: 12px;
        }

        .activity-log-btn:hover {
            transform: translateY(-1px);
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .activity-log-panel {
            position: fixed;
            left: -400px;
            top: 0;
            width: 400px;
            height: 100vh;
            background: var(--surface-primary);
            backdrop-filter: blur(12px);
            border-right: 1px solid var(--border);
            box-shadow: var(--shadow-lg);
            z-index: 1001;
            transition: left 0.3s ease;
            overflow-y: auto;
        }

        .activity-log-panel.open {
            left: 0;
        }

        .activity-log-header {
            position: sticky;
            top: 0;
            background: var(--surface-primary);
            backdrop-filter: blur(12px);
            padding: 20px 24px;
            border-bottom: 2px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }

        .activity-log-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .close-log-btn {
            background: transparent;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: color 0.2s ease;
        }

        .close-log-btn:hover {
            color: var(--text-primary);
        }

        .activity-log-content {
            padding: 16px 24px;
        }

        .log-item {
            padding: 12px;
            margin-bottom: 8px;
            background: var(--surface-secondary);
            border-radius: 8px;
            border-left: 3px solid var(--accent);
            animation: fadeIn 0.3s ease-out;
        }

        .log-user {
            font-weight: 600;
            color: var(--accent);
        }

        .log-time {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .log-change {
            margin-top: 6px;
            font-size: 13px;
            color: var(--text-primary);
        }

        .log-value {
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 4px;
            background: rgba(59, 130, 246, 0.1);
        }

        .log-empty {
            text-align: center;
            color: var(--text-secondary);
            padding: 40px 20px;
            font-size: 14px;
        }
		
		/* DATA ÌÉ≠ Ïä§ÌÉÄÏùº */
        .data-management {
            animation: fadeIn 0.3s ease-out;
        }

        .data-section {
            margin-bottom: 32px;
            background: var(--surface-primary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            box-shadow: var(--shadow);
            max-width: 1400px;  /* üëà ÏµúÎåÄ ÎÑàÎπÑ Ï†úÌïú */
            margin-left: auto;   /* üëà Ï§ëÏïô Ï†ïÎ†¨ */
            margin-right: auto;  /* üëà Ï§ëÏïô Ï†ïÎ†¨ */
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border);
        }

        .section-header h3 {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .add-row-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .add-row-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .table-wrapper {
            overflow-x: auto;
            border-radius: 8px;
			max-height: 600px;
            overflow-y: visible;
        }

        .data-table {
            width: 100%;  /* autoÏóêÏÑú 100%Î°ú Î≥ÄÍ≤Ω */
            border-collapse: collapse;
            font-size: 12px;
        }

        .data-table th,
        .data-table td {
            padding: 8px 12px;  /* Ìå®Îî© Ï¶ùÍ∞Ä */
        }

        .data-table thead {
            background: var(--surface-secondary);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .data-table th {
            padding: 8px 6px;
            text-align: center;
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 2px solid var(--border);
            white-space: nowrap;
            font-size: 11px;
        }

        .data-table td {
            padding: 6px 4px;
            text-align: center;
            border-bottom: 1px solid var(--border);
        }

        .data-row:hover {
            background: var(--surface-secondary);
        }

        .data-input {
            width: 100%;
            padding: 6px 10px;
            background: var(--surface-secondary);  /* transparentÏóêÏÑú Î≥ÄÍ≤Ω */
            border: 2px solid var(--border);  /* 1pxÏóêÏÑú 2pxÎ°ú Ï¶ùÍ∞Ä */
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 12px;
            text-align: center;
            transition: all 0.2s ease;
        }

        .data-input:focus {
            outline: none;
            background: var(--surface-primary);
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .data-input:hover {
            border-color: var(--accent);
            background: var(--surface-primary);
        }

        .data-select {
            width: 100%;
            padding: 6px 10px;
            background: var(--surface-secondary);
            border: 2px solid var(--border);  /* 1pxÏóêÏÑú 2pxÎ°ú Ï¶ùÍ∞Ä */
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .data-select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .skill-checkbox {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: var(--accent);
        }

        .delete-row-btn {
            background: transparent;
            border: none;
            font-size: 18px;
            cursor: pointer;
            opacity: 0.6;
        }

        .delete-row-btn:hover {
            opacity: 1;
            transform: scale(1.2);
            transition: none;
        }
		
		/* DATA ÌÉ≠ - ÌòÑÎåÄÏ†Å ÎîîÏûêÏù∏ */
        .data-section-modern {
            background: var(--surface-primary);
            border: 1px solid var(--border);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            transition: all 0.3s ease;
        }

        .data-section-modern:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        }

        .data-section-modern[data-color="blue"] .data-header-modern {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }

        .data-section-modern[data-color="orange"] .data-header-modern {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
        }

        .data-section-modern[data-color="purple"] .data-header-modern {
            background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);
        }

        .data-section-modern[data-color="green"] .data-header-modern {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .data-section-modern[data-color="cyan"] .data-header-modern {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
        }

        .data-section-modern[data-color="pink"] .data-header-modern {
            background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
        }

        .data-section-modern[data-color="gray"] .data-header-modern {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
        }

        .data-header-modern {
            padding: 20px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .data-header-modern::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: shimmer 3s linear infinite;
        }

        .data-title-group {
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            z-index: 1;
        }

        .data-icon {
            font-size: 24px;
            animation: bounce 2s ease-in-out infinite;
        }

        .data-title-group h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 800;
            letter-spacing: -0.5px;
        }

        .add-row-btn-modern {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            color: white;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            z-index: 1;
        }

        .add-row-btn-modern:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
		
		/* FLOW ÌÉ≠ - ÌòÑÎåÄÏ†Å ÎîîÏûêÏù∏ */
        .flow-management {
            animation: fadeIn 0.5s ease-out;
        }

        .flow-section-modern {
            background: var(--surface-primary);
            border: 1px solid var(--border);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            transition: all 0.3s ease;
        }

        .flow-section-modern:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        }

        .flow-section-modern[data-color="red"] .flow-header-modern {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .flow-section-modern[data-color="yellow"] .flow-header-modern {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        }

        .flow-section-modern[data-color="white"] .flow-header-modern {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            color: #1e293b;
        }

        .flow-section-modern[data-color="pink"] .flow-header-modern {
            background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
        }

        .flow-header-modern {
            padding: 20px 28px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .flow-header-modern::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: shimmer 3s linear infinite;
        }

        @keyframes shimmer {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .flow-title-group {
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            z-index: 1;
        }

        .flow-icon {
            font-size: 24px;
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .flow-title-group h3 {
            margin: 0;
            font-size: 20px;
            font-weight: 800;
            letter-spacing: -0.5px;
        }

        .flow-count-badge {
            padding: 8px 20px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            font-size: 16px;
            font-weight: 800;
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
            z-index: 1;
        }

        .flow-table-container {
            max-height: 800px;  /* 400pxÏóêÏÑú 300pxÎ°ú Ï§ÑÏù¥Í∏∞ */
            overflow-y: auto;
            overflow-x: auto;
        }

        .flow-table-modern {
            width: 100%;
            border-collapse: collapse;
        }

        .flow-table-modern thead {
            position: sticky;
            top: 0;
            background: var(--surface-secondary);
            z-index: 10;
        }

        .flow-table-modern th {
            padding: 14px 12px;
            text-align: center;
            font-weight: 700;
            font-size: 13px;
            color: var(--text-primary);
            border-bottom: 2px solid var(--border);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .flow-table-modern td {
            padding: 10px 12px;
            text-align: center;
            border-bottom: 1px solid var(--border);
        }

        .flow-row-modern {
            transition: all 0.2s ease;
        }

        .flow-row-modern:hover {
            background: var(--surface-secondary);
            transform: scale(1.01);
        }

        .flow-no {
            font-weight: 700;
            color: var(--text-secondary);
            font-size: 12px;
        }

        .flow-input {
            width: 100%;
            padding: 8px 12px;
            background: var(--surface-secondary);
            border: 2px solid transparent;
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 13px;
            text-align: center;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .flow-input:focus {
            outline: none;
            border-color: var(--accent);
            background: var(--surface-primary);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
            transform: scale(1.02);
        }

        .flow-input:hover {
            border-color: var(--border);
        }

        .flow-name,
        .flow-nick,
        .flow-team {
            font-weight: 700;
            color: var(--accent);
            font-size: 14px;
        }
    </style>
</head>
<body>
    <header class="fixed-header">
        <div class="header-top">
            <div class="header-title">
                <button class="activity-log-btn" id="activityLogBtn" title="Î≥ÄÍ≤Ω ÎÇ¥Ïó≠">üìã</button>
                <span class="rocket">üöÄ</span>
                <span class="title-text">GWJ2 OB Ïù∏Ïõê Í¥ÄÎ¶¨ ÏãúÌä∏ #PDA ÏùºÏßÄ</span>
            </div>
            <div class="header-controls">
                <div class="clock-display" id="currentClock">
                    <span class="clock-emoji">‚è∞</span>
                    <div class="time-segment">
                        <div class="time-unit">
                            <div class="digit-box" id="hour1">0</div>
                            <div class="digit-box" id="hour2">0</div>
                        </div>
                        <span class="time-separator">:</span>
                        <div class="time-unit">
                            <div class="digit-box" id="minute1">0</div>
                            <div class="digit-box" id="minute2">0</div>
                        </div>
                        <span class="time-separator">:</span>
                        <div class="time-unit">
                            <div class="digit-box" id="second1">0</div>
                            <div class="digit-box" id="second2">0</div>
                        </div>
                    </div>
                </div>
                <button class="dark-light-toggle" aria-label="Îã§ÌÅ¨Î™®Îìú ÌÜ†Í∏Ä">
                    <div class="icon30 sun">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#fbbf24">
                            <path d="M480-280q-83 0-141.5-58.5T280-480q0-83 58.5-141.5T480-680q83 0 141.5 58.5T680-480q0 83-58.5 141.5T480-280ZM200-440H40v-80h160v80Zm720 0H760v-80h160v80ZM440-760v-160h80v160h-80Zm0 720v-160h80v160h-80ZM256-650l-101-97 57-59 96 100-52 56Zm492 496-97-101 53-55 101 97-57 59Zm-98-550 97-101 59 57-100 96-56-52ZM154-212l101-97 55 53-97 101-59-57Z"/>
                        </svg>
                    </div>
                    <div class="icon30 moon">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#fbbf24">
                            <path d="M480-120q-150 0-255-105T120-480q0-150 105-255t255-105q14 0 27.5 1t26.5 3q-41 29-65.5 75.5T444-660q0 90 63 153t153 63q55 0 101-24.5t75-65.5q2 13 3 26.5t1 27.5q0 150-105 255T480-120Z"/>
                        </svg>
                    </div>
                </button>
				<div class="user-badge" id="userBadge" style="display: none;">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <span id="userName">ÏÇ¨Ïö©Ïûê</span>
                </div>
				<div class="connection-status" id="connectionStatus">
                    <div class="status-dot" id="statusDot"></div>
                    <span id="statusText">Ïó∞Í≤∞ Ï§ë...</span>
                </div>
                <div class="typing-indicator" id="typingIndicator">
                    <span style="color: var(--accent);">‚úçÔ∏è</span>
                    <span id="typingUser"></span>
                    <span style="color: var(--text-secondary);">ÏûÖÎ†• Ï§ë...</span>
                </div>
            </div>
        </div>
        
        <nav class="tab-navigation">
            <div class="tab-list">
                <div class="tab-item active" data-tab="home">HOME</div>
                <div class="tab-item" data-tab="data">DATA</div>
                <div class="tab-item" data-tab="flow">FLOW</div>
                <div class="tab-item" data-tab="pack">PACK</div>
                <div class="tab-item" data-tab="pick">PICK</div>
                <div class="tab-item" data-tab="share">Í≥µÏú†</div>
                <div class="tab-item" data-tab="rtpb">RTPB DATA</div>
                <div class="tab-item" data-tab="raw">RAW</div>
                <div class="tab-item" data-tab="duplicate">Ï§ëÎ≥µÍ∞í</div>
                <div class="tab-item" data-tab="extension">Ïó∞Ïû• Ï°∞ÏÇ¨</div>
            </div>
        </nav>
    </header>

    <main class="main-content">
	<div class="content-area" id="contentArea">
        <!-- ÎÇ¥Ïö©ÏùÄ switchTab Ìï®ÏàòÏóê ÏùòÌï¥ ÎèôÏ†ÅÏúºÎ°ú Ï±ÑÏõåÏßëÎãàÎã§ -->
    </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, setDoc, onSnapshot, collection, query, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
		
		// ÏûÖÎ†•Ï§ë Ï†ÑÏó≠Î≥ÄÏàò
        let typingTimeout = null;
        let isTyping = false;
        let saveTimeout = null;
        let lastSavedData = {};

        // Firebase API KEY
        const firebaseConfig = {
            apiKey: "AIzaSyDhYh-C1Zsv7PjRq0kHBNDUf8JMcxTV_l4",
            authDomain: "gwj2swingsheet.firebaseapp.com",
            projectId: "gwj2swingsheet",
            storageBucket: "gwj2swingsheet.appspot.com",
            messagingSenderId: "336629205001",
            appId: "1:336629205001:web:480a6bbb643ceff98c10d8",
            measurementId: "G-L5P3HWMB41"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const docRef = doc(db, "reports", "today");
		let cachedData = null;
        let currentUser = null;
		
		// ÌïòÎìúÏΩîÎî©Îêú ÏÇ¨Ïö©Ïûê Í≥ÑÏ†ï Î™©Î°ù
        const users = [
            { username: 'Aaron', password: '1234', displayName: 'Aaron' },
            { username: 'Dua', password: '1234', displayName: 'Dua' },
            { username: 'Ralph', password: '1234', displayName: 'Ralph' },
            { username: 'David', password: '1234', displayName: 'David' },
            { username: 'Jin', password: '1234', displayName: 'Jin' },
            { username: 'Bron', password: '1234', displayName: 'Bron' },
            { username: 'Sally', password: '1234', displayName: 'Sally' },
            { username: 'Covy', password: '1234', displayName: 'Covy' },
            { username: 'Leto', password: '1234', displayName: 'Leto' },
            { username: 'Daniel', password: '1234', displayName: 'Daniel' },
            { username: 'Sangyeong', password: '1234', displayName: 'Sangyeong' },
            { username: 'Hwan', password: '1234', displayName: 'Hwan' },
            { username: 'Ford', password: '1234', displayName: 'Ford' },
            { username: 'Tory', password: '1234', displayName: 'Tory' },
            { username: 'Stone', password: '1234', displayName: 'Stone' },
            { username: 'Leks', password: '1234', displayName: 'Leks' },
            { username: 'Steve', password: '1234', displayName: 'Steve' },
            { username: 'Bennett', password: '1234', displayName: 'Bennett' },
            { username: 'Torres', password: '1234', displayName: 'Torres' },
            { username: 'Freesia', password: '1234', displayName: 'Freesia' },
            { username: 'Jessie', password: '1234', displayName: 'Jessie' },
            { username: 'Garden', password: '1234', displayName: 'Garden' },
            { username: 'Jonny', password: '1234', displayName: 'Jonny' },
            { username: 'Beeny', password: '1234', displayName: 'Beeny' },
            { username: 'Leif', password: '1234', displayName: 'Leif' },
            { username: 'Bambi', password: '1234', displayName: 'Bambi' },
            { username: 'Winter', password: '1234', displayName: 'Winter' },
            { username: 'Bruse', password: '1234', displayName: 'Bruse' },
            { username: 'Cloud', password: '1234', displayName: 'Cloud' },
            { username: 'Ronnie', password: '1234', displayName: 'Ronnie' },
            { username: 'Rex', password: '1234', displayName: 'Rex' },
            { username: 'Siwoo', password: '1234', displayName: 'Siwoo' },
            { username: 'Zeta', password: '1234', displayName: 'Zeta' },
            { username: 'Xenon', password: '1234', displayName: 'Xenon' },
            { username: 'Damian', password: '1234', displayName: 'Damian' },
            { username: 'Alan', password: '1234', displayName: 'Alan' },
            { username: 'Colin', password: '1234', displayName: 'Colin' },
            { username: 'Eric', password: '1234', displayName: 'Eric' },
            { username: 'Zed', password: '1234', displayName: 'Zed' },
            { username: 'Ras', password: '1234', displayName: 'Ras' },
            { username: 'Tani', password: '1234', displayName: 'Tani' },
            { username: 'Healer', password: '1234', displayName: 'Healer' },
            { username: 'Loosie', password: '1234', displayName: 'Loosie' },
            { username: 'Peon', password: '1234', displayName: 'Peon' },
            { username: 'Owen', password: '1234', displayName: 'Owen' },
            { username: 'Lily', password: '1234', displayName: 'Lily' },
            { username: 'Admin', password: 'admin123', displayName: 'Admin' }
        ];

        // ÌÉ≠ ÏΩòÌÖêÏ∏† Îç∞Ïù¥ÌÑ∞
        const tabContents = {
			home: {
                title: 'HOME',
                content: ''
            },
            data: {
                title: 'DATA Í¥ÄÎ¶¨',
                content: 'Í∏∞Î≥∏ Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨ Î∞è Ï°∞Ìöå Í∏∞Îä•ÏùÑ Ï†úÍ≥µÌï©ÎãàÎã§.'
            },
            flow: {
                title: 'FLOW Í¥ÄÎ¶¨',
                content: 'ÏõåÌÅ¨ÌîåÎ°úÏö∞ Î∞è ÌîÑÎ°úÏÑ∏Ïä§ Í¥ÄÎ¶¨Î•º ÏúÑÌïú ÎèÑÍµ¨ÏûÖÎãàÎã§.'
            },
            pack: {
                title: 'PACK Í¥ÄÎ¶¨',
                content: 'Ìå®ÌÇ§ÏßÄ Î∞è Î¨∂Ïùå Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨ Í∏∞Îä•ÏûÖÎãàÎã§.'
            },
            pick: {
                title: 'PICK Í¥ÄÎ¶¨',
                content: 'ÏÑ†Î≥Ñ Î∞è Ï∂îÏ∂ú ÏûëÏóÖÏùÑ ÏúÑÌïú ÎèÑÍµ¨ÏûÖÎãàÎã§.'
            },
            share: {
                title: 'Í≥µÏú† Í¥ÄÎ¶¨',
                content: 'Îç∞Ïù¥ÌÑ∞ Í≥µÏú† Î∞è ÌòëÏóÖ Í∏∞Îä•ÏùÑ Ï†úÍ≥µÌï©ÎãàÎã§.'
            },
            rtpb: {
                title: 'RTPB DATA',
                content: 'Ïã§ÏãúÍ∞Ñ RTPB Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑù Î∞è Î™®ÎãàÌÑ∞ÎßÅ Í∏∞Îä•ÏûÖÎãàÎã§.'
            },
            raw: {
                title: 'RAW Îç∞Ïù¥ÌÑ∞',
                content: 'ÏõêÎ≥∏ Îç∞Ïù¥ÌÑ∞ Ï°∞Ìöå Î∞è Ï≤òÎ¶¨ Í∏∞Îä•ÏùÑ Ï†úÍ≥µÌï©ÎãàÎã§.'
            },
            duplicate: {
                title: 'Ï§ëÎ≥µÍ∞í Í≤ÄÏÇ¨',
                content: 'Îç∞Ïù¥ÌÑ∞ Ï§ëÎ≥µ Í≤ÄÏÇ¨ Î∞è Ï†ïÎ¶¨ ÎèÑÍµ¨ÏûÖÎãàÎã§.'
            },
            extension: {
                title: 'Ïó∞Ïû• Ï°∞ÏÇ¨',
                content: 'Ï∂îÍ∞Ä Ï°∞ÏÇ¨ Î∞è Ïó∞Ïû• Í¥ÄÎ†® ÏóÖÎ¨¥ Í¥ÄÎ¶¨ Í∏∞Îä•ÏûÖÎãàÎã§.'
            }
        };

        function switchTab(tabId) {
            const contentArea = document.getElementById('contentArea');
            if (!contentArea) return;
            
            document.querySelectorAll('.tab-item').forEach(tab => tab.classList.remove('active'));
            const selectedTab = document.querySelector(`[data-tab="${tabId}"]`);
            if (selectedTab) selectedTab.classList.add('active');
            
            if (tabId === 'home') {
                contentArea.innerHTML = `
                    <div class="welcome-message">
                        <div class="welcome-title" style="font-size: 48px; font-weight: 900; margin-bottom: 12px; line-height: 1.2;">
                            <span style="display: inline-block; animation: rocketPulse 2s ease-in-out infinite;">üöÄ</span> 
                            <span class="welcome-title-gradient">GWJ2 OB Ïù∏Ïõê Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</span>
                        </div>
                        <div class="welcome-subtitle" style="font-size: 22px; font-weight: 600; color: var(--text-secondary); margin-bottom: 24px;">
                            # SWING PDA ÏùºÏßÄ
                        </div>
                        <div class="welcome-line" style="width: 300px; height: 3px; background: linear-gradient(90deg, transparent, var(--accent), transparent); margin: 0 auto 24px;"></div>
                        <div class="welcome-version" style="font-size: 14px; color: var(--text-tertiary); font-weight: 500;">
                            Ver 1.0
                        </div>
                        
                        <div style="margin-top: 40px; display: flex; justify-content: center; align-items: stretch; gap: 24px;">
                            <!-- Ïù∏Ïõê ÌòÑÌô© ÌÖåÏù¥Î∏î -->
                            <div style="flex: 1; max-width: 580px;">
                                <div id="staffing-box" style="background: var(--surface-primary); backdrop-filter: blur(12px); border: 1px solid var(--border); border-radius: 16px; padding: 24px; box-shadow: var(--shadow-lg); height: 100%;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 14px; border-bottom: 2px solid var(--border);">
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <h3 style="font-size: 20px; font-weight: 800; color: var(--text-primary); margin: 0; letter-spacing: -0.5px;">üìä Ïù∏Ïõê ÌòÑÌô©</h3>
                                            <button id="capture-staffing-btn" class="capture-btn">üì∏</button>
                                        </div>
                                        <div style="display: flex; gap: 10px;">
                                            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 8px 18px; border-radius: 10px; box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);">
                                                <div style="font-size: 9px; color: rgba(255,255,255,0.8); font-weight: 600; margin-bottom: 1px; letter-spacing: 0.3px;">Ï±ÑÏö©Î•†</div>
                                                <div style="color: white; font-weight: 900; font-size: 24px; line-height: 1; letter-spacing: -1px;"><span id="hiring-rate">-</span><span style="font-size: 16px;"> %</span></div>
                                            </div>
                                            <div style="background: linear-gradient(135deg, #38bdf8 0%, #3b82f6 100%); padding: 0 18px; border-radius: 10px; box-shadow: 0 3px 10px rgba(59, 130, 246, 0.3); display: flex; align-items: center; justify-content: center;">
                                                <div style="color: white; font-weight: 900; font-size: 20px; letter-spacing: -0.5px;">SWING üåô</div>
                                            </div>
                                        </div>
                                    </div>
                                    <table style="width: 100%; border-collapse: collapse;">
                                        <thead>
                                            <tr style="border-bottom: 2px solid var(--border);"><th style="padding: 8px 0; text-align: center; color: var(--text-tertiary); font-weight: 700; font-size: 11px; text-transform: uppercase; letter-spacing: 0.3px; width: 34%;">Íµ¨Î∂Ñ</th><th style="padding: 8px 0; text-align: center; color: var(--text-tertiary); font-weight: 700; font-size: 11px; text-transform: uppercase; letter-spacing: 0.3px; width: 22%;">Plan</th><th style="padding: 8px 0; text-align: center; color: var(--text-tertiary); font-weight: 700; font-size: 11px; text-transform: uppercase; letter-spacing: 0.3px; width: 22%;">Actual</th><th style="padding: 8px 0; text-align: center; color: var(--text-tertiary); font-weight: 700; font-size: 11px; text-transform: uppercase; letter-spacing: 0.3px; width: 22%;">Gap</th></tr>
                                        </thead>
                                        <tbody>
                                            <tr style="border-bottom: 1px solid var(--border);"><td colspan="4" style="padding: 10px 0; font-weight: 800; font-size: 15px; color: var(--text-primary); background: var(--surface-secondary); text-align: center;">ÏÉÅÏö©ÏßÅ</td></tr>
                                            <tr style="border-bottom: 1px solid rgba(148, 163, 184, 0.08);"><td style="padding: 8px 0; color: var(--text-primary); font-weight: 500; font-size: 14px; text-align: center;">T/C</td><td style="padding: 8px 0; text-align: center;"><input type="number" id="perm-tc-plan" class="staffing-input"></td><td style="padding: 8px 0; text-align: center;"><input type="number" id="perm-tc-actual" class="staffing-input"></td><td style="padding: 8px 0; text-align: center; font-weight: 700; font-size: 15px;" id="perm-tc-gap"></td></tr>
                                            <tr style="border-bottom: 1px solid rgba(148, 163, 184, 0.08);"><td style="padding: 8px 0; color: var(--text-primary); font-weight: 500; font-size: 14px; text-align: center;">Perm</td><td style="padding: 8px 0; text-align: center;"><input type="number" id="perm-perm-plan" class="staffing-input"></td><td style="padding: 8px 0; text-align: center;"><input type="number" id="perm-perm-actual" class="staffing-input"></td><td style="padding: 8px 0; text-align: center; font-weight: 700; font-size: 15px;" id="perm-perm-gap"></td></tr>
                                            <tr style="background: var(--surface-secondary); border-bottom: 2px solid var(--border);"><td style="padding: 9px 0; font-weight: 700; color: var(--text-primary); font-size: 14px; text-align: center;">ÏÜåÍ≥Ñ</td><td style="padding: 9px 0; text-align: center; font-weight: 700; font-size: 16px; color: var(--text-primary);" id="perm-total-plan"></td><td style="padding: 9px 0; text-align: center; font-weight: 700; font-size: 16px; color: var(--text-primary);" id="perm-total-actual"></td><td style="padding: 9px 0; text-align: center; font-weight: 700; font-size: 16px;" id="perm-total-gap"></td></tr>
                                            <tr style="border-bottom: 1px solid var(--border);"><td colspan="4" style="padding: 10px 0; font-weight: 800; font-size: 15px; color: var(--text-primary); background: var(--surface-secondary); text-align: center;">ÏûÑÏãúÏßÅ</td></tr>
                                            <tr style="border-bottom: 1px solid rgba(148, 163, 184, 0.08);"><td style="padding: 8px 0; color: var(--text-primary); font-weight: 500; font-size: 14px; text-align: center;">Temp</td><td style="padding: 8px 0; text-align: center;"><input type="number" id="temp-temp-plan" class="staffing-input"></td><td style="padding: 8px 0; text-align: center;"><input type="number" id="temp-temp-actual" class="staffing-input"></td><td style="padding: 8px 0; text-align: center; font-weight: 700; font-size: 15px;" id="temp-temp-gap"></td></tr>
                                            <tr style="border-bottom: 1px solid rgba(148, 163, 184, 0.08);"><td style="padding: 8px 0; color: var(--text-primary); font-weight: 500; font-size: 14px; text-align: center;">Newbie</td><td style="padding: 8px 0; text-align: center;"><input type="number" id="temp-newbie-plan" class="staffing-input"></td><td style="padding: 8px 0; text-align: center;"><input type="number" id="temp-newbie-actual" class="staffing-input"></td><td style="padding: 8px 0; text-align: center; font-weight: 700; font-size: 15px;" id="temp-newbie-gap"></td></tr>
                                            <tr style="background: var(--surface-secondary); border-bottom: 2px solid var(--border);"><td style="padding: 9px 0; font-weight: 700; color: var(--text-primary); font-size: 14px; text-align: center;">ÏÜåÍ≥Ñ</td><td style="padding: 9px 0; text-align: center; font-weight: 700; font-size: 16px; color: var(--text-primary);" id="temp-total-plan"></td><td style="padding: 9px 0; text-align: center; font-weight: 700; font-size: 16px; color: var(--text-primary);" id="temp-total-actual"></td><td style="padding: 9px 0; text-align: center; font-weight: 700; font-size: 16px;" id="temp-total-gap"></td></tr>
                                            <tr style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);"><td style="padding: 11px 0; font-weight: 800; font-size: 15px; color: var(--text-primary); text-align: center;">Total</td><td style="padding: 11px 0; text-align: center; font-weight: 800; font-size: 18px; color: var(--text-primary);" id="grand-total-plan"></td><td style="padding: 11px 0; text-align: center; font-weight: 800; font-size: 18px; color: var(--text-primary);" id="grand-total-actual"></td><td style="padding: 11px 0; text-align: center; font-weight: 800; font-size: 18px;" id="grand-total-gap"></td></tr>
                                        </tbody>
                                    </table>
                                    <div style="margin-top: 24px; display: flex; justify-content: center; gap: 12px;"><button id="reset-btn" style="background: #f87171; color: white; border: none; padding: 10px 20px; border-radius: 10px; font-weight: 600; cursor: pointer; transition: background 0.2s ease;">Í∞í Ï¥àÍ∏∞Ìôî</button></div>
                                </div>
                            </div>
                            <div style="flex: 1; max-width: 580px;">
                                <div id="report-box" style="background: var(--surface-primary); backdrop-filter: blur(12px); border: 1px solid var(--border); border-radius: 16px; padding: 24px; box-shadow: var(--shadow-lg); height: 100%;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding-bottom: 14px; border-bottom: 2px solid var(--border);">
                                        <h3 style="font-size: 20px; font-weight: 800; color: var(--text-primary); margin: 0; letter-spacing: -0.5px;">‚ñ£ OB Employees Report</h3>
                                        <button id="capture-report-btn" class="capture-btn">üì∏</button>
                                    </div>
                                    <table id="manager-report-table" style="width: 100%; font-size: 14px; border-collapse: collapse;">
                                        <tbody>
                                            <tr><td style="width: 80px; font-weight: 600; padding: 2px 4px; text-align: center;">OM/AM</td><td style="padding: 2px;"><input type="text" class="report-input" id="om-report-0" placeholder="-"></td><td style="padding: 2px;"><input type="text" class="report-input" id="om-report-1" placeholder="-"></td><td style="padding: 2px;"><input type="text" class="report-input" id="om-report-2" placeholder="-"></td></tr>
											<tr><td style="font-weight: 600; padding: 2px 4px; text-align: center;">T/C</td><td style="padding: 2px;"><input type="text" class="report-input" id="tc-report-0" placeholder="-"></td><td style="padding: 2px;"><input type="text" class="report-input" id="tc-report-1" placeholder="-"></td><td style="padding: 2px;"><input type="text" class="report-input" id="tc-report-2" placeholder="-"></td></tr>
<tr><td></td><td style="padding: 2px;"><input type="text" class="report-input" id="tc-report-3" placeholder="-"></td><td style="padding: 2px;"><input type="text" class="report-input" id="tc-report-4" placeholder="-"></td><td style="padding: 2px;"><input type="text" class="report-input" id="tc-report-5" placeholder="-"></td></tr>
<tr><td></td><td style="padding: 2px;"><input type="text" class="report-input" id="tc-report-6" placeholder="-"></td><td style="padding: 2px;"><input type="text" class="report-input" id="tc-report-7" placeholder="-"></td><td style="padding: 2px;"><input type="text" class="report-input" id="tc-report-8" placeholder="-"></td></tr>
<tr><td></td><td style="padding: 2px;"><input type="text" class="report-input" id="tc-report-9" placeholder="-"></td><td style="padding: 2px;"><input type="text" class="report-input" id="tc-report-10" placeholder="-"></td><td style="padding: 2px;"><input type="text" class="report-input" id="tc-report-11" placeholder="-"></td></tr>
<tr><td></td><td style="padding: 2px;"><input type="text" class="report-input" id="tc-report-12" placeholder="-"></td><td style="padding: 2px;"><input type="text" class="report-input" id="tc-report-13" placeholder="-"></td><td style="padding: 2px;"><input type="text" class="report-input" id="tc-report-14" placeholder="-"></td></tr>
<tr><td></td><td style="padding: 2px;"><input type="text" class="report-input" id="tc-report-15" placeholder="-"></td><td style="padding: 2px;"><input type="text" class="report-input" id="tc-report-16" placeholder="-"></td><td style="padding: 2px;"><input type="text" class="report-input" id="tc-report-17" placeholder="-"></td></tr>
<tr><td></td><td style="padding: 2px;"><input type="text" class="report-input" id="tc-report-18" placeholder="-"></td><td style="padding: 2px;"><input type="text" class="report-input" id="tc-report-19" placeholder="-"></td><td style="padding: 2px;"><input type="text" class="report-input" id="tc-report-20" placeholder="-"></td></tr>
											<tr style="border-top: 1px solid var(--border);"><td style="font-weight: 600; padding: 6px 4px; text-align: center;">Total</td><td id="report-manager-total" style="font-weight: 700; text-align: center;" colspan="3">0</td></tr>
                                        </tbody>
                                    </table>
                                    <h3 style="font-size: 20px; font-weight: 800; color: var(--text-primary); margin: 20px 0 4px 0; letter-spacing: -0.5px; text-align: left; padding-top: 20px; padding-bottom: 14px; border-top: 2px solid var(--border);">üìä Ïã§ÏãúÍ∞Ñ Ïù∏Ïõê ÌòÑÌô©</h3>
                                    <table style="width: 100%; margin-top: 10px; font-size: 14px; border-collapse: collapse;">
                                        <thead>
                                            <tr style="border-bottom: 2px solid var(--border);"><th style="text-align: center; color: var(--text-tertiary); font-weight: 700; font-size: 11px; text-transform: uppercase; letter-spacing: 0.3px; width: 50%;">Íµ¨Î∂Ñ</th><th style="text-align: center; color: var(--text-tertiary); font-weight: 700; font-size: 11px; text-transform: uppercase; letter-spacing: 0.3px; width: 25%;">Ïù∏Ïõê</th><th style="text-align: center; color: var(--text-tertiary); font-weight: 700; font-size: 11px; text-transform: uppercase; letter-spacing: 0.3px; width: 25%;">ÎπÑÍ≥†</th></tr>
                                        </thead>
                                        <tbody>
                                            <tr><td style="font-weight: 500; padding: 8px 0; text-align: center;">Team Captain</td><td id="report-tc-actual" style="text-align: center; font-weight: 600;">- Î™Ö</td><td style="text-align: center; padding: 2px;"><input type="text" class="report-input report-remark"></td></tr>
                                            <tr><td style="font-weight: 500; padding: 8px 0; text-align: center;">Í≥ÑÏïΩÏßÅ</td><td id="report-perm-actual" style="text-align: center; font-weight: 600;">- Î™Ö</td><td style="text-align: center; padding: 2px;"><input type="text" class="report-input report-remark"></td></tr>
                                            <tr><td style="font-weight: 500; padding: 8px 0; text-align: center;">Îã®Í∏∞ÏßÅ</td><td id="report-temp-actual" style="text-align: center; font-weight: 600;">- Î™Ö</td><td style="text-align: center; padding: 2px;"><input type="text" class="report-input report-remark"></td></tr>
                                            <tr style="border-top: 1px solid var(--border);"><td style="font-weight: 700; padding: 8px 0; text-align: center;">Total</td><td id="report-total-actual" style="text-align: center; font-weight: 700;">- Î™Ö</td><td style="text-align: center;">-</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    <!-- üëá Ïó¨Í∏∞Ïóê Ï∂îÍ∞Ä! -->
                        <div id="adminPanel" style="display: none;" class="admin-panel">
                            <h3 class="admin-title">üîê Í¥ÄÎ¶¨Ïûê Ìå®ÎÑê - Í≥ÑÏ†ï Í¥ÄÎ¶¨</h3>
                            <div class="user-list" id="userList"></div>
                            <div style="border-top: 1px solid var(--border); padding-top: 16px;">
                                <h4 style="font-size: 16px; font-weight: 600; margin-bottom: 12px;">ÏÉà Í≥ÑÏ†ï Ï∂îÍ∞Ä</h4>
                                <div class="add-user-form">
                                    <input type="text" id="newUsername" class="admin-input" placeholder="ÏïÑÏù¥Îîî">
                                    <input type="text" id="newDisplayName" class="admin-input" placeholder="ÌëúÏãú Ïù¥Î¶Ñ">
                                    <input type="password" id="newPassword" class="admin-input" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏">
                                    <button id="addUserBtn" class="add-btn">Ï∂îÍ∞Ä</button>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                `;
                 setTimeout(() => {
                    initializeHomeTabListeners();
                    if (cachedData) {
                        updateUIFromData(cachedData);
                    }
                    
                    // FLOW Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÏúºÎ©¥ ÏûêÎèô ÎèôÍ∏∞Ìôî
                    syncFlowToHome();
                    
                    // Admin ÏÇ¨Ïö©ÏûêÎ©¥ Í¥ÄÎ¶¨Ïûê Ìå®ÎÑê Îã§Ïãú ÌëúÏãú
                    if (currentUser && currentUser.username.toLowerCase() === 'admin') {
                        showAdminPanel();
                    }
                }, 0);
                return;
            }
			
			if (tabId === 'data') {
                contentArea.innerHTML = `
                    <div class="data-management">
                        <h2 style="font-size: 28px; font-weight: 700; margin-bottom: 32px; color: var(--text-primary);">üìä ÏÇ¨Ïõê Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨</h2>
                        
                        <!-- 1Ìñâ: Îß§ÎãàÏ†Ä, T/C, PS (1x3) -->
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 20px;">
                            <!-- Îß§ÎãàÏ†Ä -->
                            <div class="data-section-modern" data-color="blue">
                                <div class="data-header-modern">
                                    <div class="data-title-group">
                                        <div class="data-icon">üëî</div>
                                        <h3>Îß§ÎãàÏ†Ä (M/G)</h3>
                                    </div>
                                    <button class="add-row-btn-modern" data-table="managers">+ Ìñâ Ï∂îÍ∞Ä</button>
                                </div>
                                <div class="table-wrapper">
                                    <table class="data-table" id="managers-table">
                                        <thead>
                                            <tr>
                                                <th>ÏõêÎ∞îÏΩîÎìú</th>
                                                <th>ÎãâÎÑ§ÏûÑ</th>
                                                <th>Ïù¥Î¶Ñ</th>
                                                <th>ÏÇ≠Ï†ú</th>
                                            </tr>
                                        </thead>
                                        <tbody id="managers-tbody">
                                            <tr class="data-row">
                                                <td><input type="text" class="data-input" placeholder="ÏõêÎ∞îÏΩîÎìú"></td>
                                                <td><input type="text" class="data-input" placeholder="ÎãâÎÑ§ÏûÑ"></td>
                                                <td><input type="text" class="data-input" placeholder="Ïù¥Î¶Ñ"></td>
                                                <td><button class="delete-row-btn">üóëÔ∏è</button></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- T/C -->
                            <div class="data-section-modern" data-color="orange">
                                <div class="data-header-modern">
                                    <div class="data-title-group">
                                        <div class="data-icon">üë∑</div>
                                        <h3>ÌòÑÏû•Í¥ÄÎ¶¨Ïûê (T/C)</h3>
                                    </div>
                                    <button class="add-row-btn-modern" data-table="tc">+ Ìñâ Ï∂îÍ∞Ä</button>
                                </div>
                                <div class="table-wrapper">
                                    <table class="data-table" id="tc-table">
                                        <thead>
                                            <tr>
                                                <th>ÏõêÎ∞îÏΩîÎìú</th>
                                                <th>ÎãâÎÑ§ÏûÑ</th>
                                                <th>Ïù¥Î¶Ñ</th>
                                                <th>ÏÇ≠Ï†ú</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tc-tbody">
                                            <tr class="data-row">
                                                <td><input type="text" class="data-input" placeholder="ÏõêÎ∞îÏΩîÎìú"></td>
                                                <td><input type="text" class="data-input" placeholder="ÎãâÎÑ§ÏûÑ"></td>
                                                <td><input type="text" class="data-input" placeholder="Ïù¥Î¶Ñ"></td>
                                                <td><button class="delete-row-btn">üóëÔ∏è</button></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- PS -->
                            <div class="data-section-modern" data-color="purple">
                                <div class="data-header-modern">
                                    <div class="data-title-group">
                                        <div class="data-icon">‚≠ê</div>
                                        <h3>PS ÏÇ¨Ïõê</h3>
                                    </div>
                                    <button class="add-row-btn-modern" data-table="ps">+ Ìñâ Ï∂îÍ∞Ä</button>
                                </div>
                                <div class="table-wrapper">
                                    <table class="data-table" id="ps-table">
                                        <thead>
                                            <tr>
                                                <th>ÏõêÎ∞îÏΩîÎìú</th>
                                                <th>Ï°∞</th>
                                                <th>Ïù¥Î¶Ñ</th>
                                                <th>ÏÇ≠Ï†ú</th>
                                            </tr>
                                        </thead>
                                        <tbody id="ps-tbody">
                                            <tr class="data-row">
                                                <td><input type="text" class="data-input" placeholder="ÏõêÎ∞îÏΩîÎìú"></td>
                                                <td>
                                                    <select class="data-select">
                                                        <option value="">ÏÑ†ÌÉù</option>
                                                        <option value="A">AÏ°∞</option>
                                                        <option value="B">BÏ°∞</option>
                                                        <option value="C">CÏ°∞</option>
                                                        <option value="D">DÏ°∞</option>
                                                        <option value="E">EÏ°∞</option>
                                                        <option value="F">FÏ°∞</option>
                                                        <option value="G">GÏ°∞</option>
                                                    </select>
                                                </td>
                                                <td><input type="text" class="data-input" placeholder="Ïù¥Î¶Ñ"></td>
                                                <td><button class="delete-row-btn">üóëÔ∏è</button></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- 2Ìñâ: Í≥ÑÏïΩÏßÅ (1x1) -->
                        <div style="margin-bottom: 20px;">
                            <div class="data-section-modern" data-color="green">
                                <div class="data-header-modern">
                                    <div class="data-title-group">
                                        <div class="data-icon">üíº</div>
                                        <h3>Í≥ÑÏïΩÏßÅ ÏÇ¨Ïõê</h3>
                                    </div>
                                    <div style="display: flex; gap: 10px;">
                                        <button id="sort-permanent-btn" class="add-row-btn-modern" style="background: linear-gradient(135deg, #fb923c, #f97316);">Ï°∞Î≥Ñ Ï†ïÎ†¨</button>
                                        <button class="add-row-btn-modern" data-table="permanent">+ Ìñâ Ï∂îÍ∞Ä</button>
                                        <button id="clear-permanent-btn" class="add-row-btn-modern" style="background: linear-gradient(135deg, #ef4444, #dc2626);">Ï†ÑÏ≤¥ ÏÇ≠Ï†ú</button>
                                    </div>
                                </div>
                                <div class="table-wrapper">
                                    <table class="data-table" id="permanent-table">
                                        <thead>
                                            <tr>
                                                <th>ÏõêÎ∞îÏΩîÎìú</th>
                                                <th>Ï°∞</th>
                                                <th>Ïù¥Î¶Ñ</th>
                                                <th>Ïò§ÌÜ†Î∞±</th>
                                                <th>Î©îÎâ¥Ïñº</th>
                                                <th>Î©ÄÌã∞</th>
                                                <th>ÌïòÏù¥Ïä§ÌÇ¨</th>
                                                <th>AGV</th>
                                                <th>Ïò§ÎçîÌîºÏª§</th>
                                                <th>ÏõåÌÑ∞</th>
                                                <th>ÏÇ≠Ï†ú</th>
                                            </tr>
                                        </thead>
                                        <tbody id="permanent-tbody">
                                            <tr class="data-row">
                                                <td><input type="text" class="data-input" placeholder="ÏõêÎ∞îÏΩîÎìú"></td>
                                                <td>
                                                    <select class="data-select">
                                                        <option value="">ÏÑ†ÌÉù</option>
                                                        <option value="A">AÏ°∞</option>
                                                        <option value="B">BÏ°∞</option>
                                                        <option value="C">CÏ°∞</option>
                                                        <option value="D">DÏ°∞</option>
                                                        <option value="E">EÏ°∞</option>
                                                        <option value="F">FÏ°∞</option>
                                                        <option value="G">GÏ°∞</option>
                                                    </select>
                                                </td>
                                                <td><input type="text" class="data-input" placeholder="Ïù¥Î¶Ñ"></td>
                                                <td><input type="checkbox" class="skill-checkbox"></td>
                                                <td><input type="checkbox" class="skill-checkbox"></td>
                                                <td><input type="checkbox" class="skill-checkbox"></td>
                                                <td><input type="checkbox" class="skill-checkbox"></td>
                                                <td><input type="checkbox" class="skill-checkbox"></td>
                                                <td><input type="checkbox" class="skill-checkbox"></td>
                                                <td><input type="checkbox" class="skill-checkbox"></td>
                                                <td><button class="delete-row-btn">üóëÔ∏è</button></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- 3Ìñâ: Îã®Í∏∞ÏßÅ (1x1) -->
                        <div style="margin-bottom: 20px;">
                            <div class="data-section-modern" data-color="cyan">
                                <div class="data-header-modern">
                                    <div class="data-title-group">
                                        <div class="data-icon">üìã</div>
                                        <h3>Îã®Í∏∞ÏßÅ ÏÇ¨Ïõê</h3>
                                    </div>
                                    <div style="display: flex; gap: 10px;">
                                        <button id="sort-temporary-btn" class="add-row-btn-modern" style="background: linear-gradient(135deg, #3b82f6, #60a5fa);">Ïù¥Î¶Ñ Ï†ïÎ†¨</button>
                                        <button class="add-row-btn-modern" data-table="temporary">+ Ìñâ Ï∂îÍ∞Ä</button>
                                        <button id="clear-temporary-btn" class="add-row-btn-modern" style="background: linear-gradient(135deg, #ef4444, #dc2626);">Ï†ÑÏ≤¥ ÏÇ≠Ï†ú</button>
                                    </div>
                                </div>
                                <div class="table-wrapper">
                                    <table class="data-table" id="temporary-table">
                                        <thead>
                                            <tr>
                                                <th>ÏõêÎ∞îÏΩîÎìú</th>
                                                <th>Ïù¥Î¶Ñ</th>
                                                <th>Ïò§ÌÜ†Î∞±</th>
                                                <th>Î©îÎâ¥Ïñº</th>
                                                <th>Î©ÄÌã∞</th>
                                                <th>ÌïòÏù¥Ïä§ÌÇ¨</th>
                                                <th>AGV</th>
                                                <th>Ïò§ÎçîÌîºÏª§</th>
                                                <th>ÏõåÌÑ∞</th>
                                                <th>ÏÇ≠Ï†ú</th>
                                            </tr>
                                        </thead>
                                        <tbody id="temporary-tbody">
                                            <tr class="data-row">
                                                <td><input type="text" class="data-input" placeholder="ÏõêÎ∞îÏΩîÎìú"></td>
                                                <td><input type="text" class="data-input" placeholder="Ïù¥Î¶Ñ"></td>
                                                <td><input type="checkbox" class="skill-checkbox"></td>
                                                <td><input type="checkbox" class="skill-checkbox"></td>
                                                <td><input type="checkbox" class="skill-checkbox"></td>
                                                <td><input type="checkbox" class="skill-checkbox"></td>
                                                <td><input type="checkbox" class="skill-checkbox"></td>
                                                <td><input type="checkbox" class="skill-checkbox"></td>
                                                <td><input type="checkbox" class="skill-checkbox"></td>
                                                <td><button class="delete-row-btn">üóëÔ∏è</button></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- 4Ìñâ: Ïã†Í∑úÎã®Í∏∞, CD (1x2) -->
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                            <!-- Ïã†Í∑úÎã®Í∏∞ -->
                            <div class="data-section-modern" data-color="pink">
                                <div class="data-header-modern">
                                    <div class="data-title-group">
                                        <div class="data-icon">üÜï</div>
                                        <h3>Ïã†Í∑úÎã®Í∏∞ ÏÇ¨Ïõê</h3>
                                    </div>
                                    <button class="add-row-btn-modern" data-table="newbie">+ Ìñâ Ï∂îÍ∞Ä</button>
                                </div>
                                <div class="table-wrapper">
                                    <table class="data-table" id="newbie-table">
                                        <thead>
                                            <tr>
                                                <th>ÏõêÎ∞îÏΩîÎìú</th>
                                                <th>Ïù¥Î¶Ñ</th>
                                                <th>ÏÇ≠Ï†ú</th>
                                            </tr>
                                        </thead>
                                        <tbody id="newbie-tbody">
                                            <tr class="data-row">
                                                <td><input type="text" class="data-input" placeholder="ÏõêÎ∞îÏΩîÎìú"></td>
                                                <td><input type="text" class="data-input" placeholder="Ïù¥Î¶Ñ"></td>
                                                <td><button class="delete-row-btn">üóëÔ∏è</button></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- CD -->
                            <div class="data-section-modern" data-color="gray">
                                <div class="data-header-modern">
                                    <div class="data-title-group">
                                        <div class="data-icon">üîß</div>
                                        <h3>CD ÏÇ¨Ïõê</h3>
                                    </div>
                                    <button class="add-row-btn-modern" data-table="cd">+ Ìñâ Ï∂îÍ∞Ä</button>
                                </div>
                                <div class="table-wrapper">
                                    <table class="data-table" id="cd-table">
                                        <thead>
                                            <tr>
                                                <th>ÏõêÎ∞îÏΩîÎìú</th>
                                                <th>Í≥µÏ†ï</th>
                                                <th>Ïù¥Î¶Ñ</th>
                                                <th>ÏÇ≠Ï†ú</th>
                                            </tr>
                                        </thead>
                                        <tbody id="cd-tbody">
                                            <tr class="data-row">
                                                <td><input type="text" class="data-input" placeholder="ÏõêÎ∞îÏΩîÎìú"></td>
                                                <td>
                                                    <select class="data-select">
                                                        <option value="">ÏÑ†ÌÉù</option>
                                                        <option value="OB">OB</option>
                                                        <option value="IB">IB</option>
                                                        <option value="ICQA">ICQA</option>
                                                        <option value="HUB">HUB</option>
                                                        <option value="CFC">CFC</option>
                                                    </select>
                                                </td>
                                                <td><input type="text" class="data-input" placeholder="Ïù¥Î¶Ñ"></td>
                                                <td><button class="delete-row-btn">üóëÔ∏è</button></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                setTimeout(() => {
                    initializeDataTab();
                }, 0);
                return;
            }
			
			if (tabId === 'flow') {
                contentArea.innerHTML = `
                    <div class="flow-management">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
                            <h2 style="font-size: 28px; font-weight: 700; color: var(--text-primary); margin: 0;">üìã FLOW Í¥ÄÎ¶¨</h2>
                            <button id="clear-flow-btn" style="background: linear-gradient(135deg, #ef4444, #dc2626); color: white; border: none; padding: 12px 24px; border-radius: 12px; font-size: 14px; font-weight: 700; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);">üóëÔ∏è Ï†ÑÏ≤¥ Ï¥àÍ∏∞Ìôî</button>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px;">
                            <!-- Team Captain -->
                            <div class="flow-section-modern" data-color="red">
                                <div class="flow-header-modern">
                                    <div class="flow-title-group">
                                        <div class="flow-icon">üëî</div>
                                        <h3>Team Captain</h3>
                                    </div>
                                    <div class="flow-count-badge" id="tc-count">0Î™Ö</div>
                                </div>
                                <div class="flow-table-container">
                                    <table class="flow-table-modern">
                                        <thead>
                                            <tr>
                                                <th style="width: 60px;">NO</th>
                                                <th style="width: 140px;">ÏõêÎ∞îÏΩîÎìú</th>
                                                <th style="width: 120px;">ÏÑ±Î™Ö</th>
                                                <th style="width: 100px;">Nick</th>
                                                <th style="width: 150px;">Role</th>
                                            </tr>
                                        </thead>
                                        <tbody id="flow-tc-tbody">
                                            ${Array.from({length: 20}, (_, i) => `
                                                <tr class="flow-row-modern">
                                                    <td class="flow-no">${i + 1}</td>
                                                    <td><input type="text" class="flow-input flow-barcode-input" data-section="tc" data-index="${i}" placeholder="ÏõêÎ∞îÏΩîÎìú ÏûÖÎ†•"></td>
                                                    <td class="flow-name" data-section="tc" data-index="${i}">-</td>
                                                    <td class="flow-nick" data-section="tc" data-index="${i}">-</td>
                                                    <td><input type="text" class="flow-input flow-role-input" data-section="tc" data-index="${i}" placeholder="Role ÏûÖÎ†•"></td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- PS -->
                            <div class="flow-section-modern" data-color="yellow">
                                <div class="flow-header-modern">
                                    <div class="flow-title-group">
                                        <div class="flow-icon">‚≠ê</div>
                                        <h3>PS</h3>
                                    </div>
                                    <div class="flow-count-badge" id="ps-count">0Î™Ö</div>
                                </div>
                                <div class="flow-table-container">
                                    <table class="flow-table-modern">
                                        <thead>
                                            <tr>
                                                <th style="width: 60px;">NO</th>
                                                <th style="width: 140px;">ÏõêÎ∞îÏΩîÎìú</th>
                                                <th style="width: 120px;">ÏÑ±Î™Ö</th>
                                                <th style="width: 100px;">Íµ¨Î∂Ñ</th>
                                                <th style="width: 150px;">Role</th>
                                            </tr>
                                        </thead>
                                        <tbody id="flow-ps-tbody">
                                            ${Array.from({length: 20}, (_, i) => `
                                                <tr class="flow-row-modern">
                                                    <td class="flow-no">${i + 1}</td>
                                                    <td><input type="text" class="flow-input flow-barcode-input" data-section="ps" data-index="${i}" placeholder="ÏõêÎ∞îÏΩîÎìú ÏûÖÎ†•"></td>
                                                    <td class="flow-name" data-section="ps" data-index="${i}">-</td>
                                                    <td class="flow-team" data-section="ps" data-index="${i}">-</td>
                                                    <td><input type="text" class="flow-input flow-role-input" data-section="ps" data-index="${i}" placeholder="Role ÏûÖÎ†•"></td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Ï°∞Ìá¥Ïù∏Ïõê -->
                            <div class="flow-section-modern" data-color="white">
                                <div class="flow-header-modern">
                                    <div class="flow-title-group">
                                        <div class="flow-icon">üö™</div>
                                        <h3>Ï°∞Ìá¥Ïù∏Ïõê</h3>
                                    </div>
                                    <div class="flow-count-badge" id="leave-count">0Î™Ö</div>
                                </div>
                                <div class="flow-table-container">
                                    <table class="flow-table-modern">
                                        <thead>
                                            <tr>
                                                <th style="width: 60px;">NO</th>
                                                <th style="width: 140px;">ÏõêÎ∞îÏΩîÎìú</th>
                                                <th style="width: 120px;">ÏÑ±Î™Ö</th>
                                                <th style="width: 200px;">ÎπÑÍ≥†</th>
                                            </tr>
                                        </thead>
                                        <tbody id="flow-leave-tbody">
                                            ${Array.from({length: 20}, (_, i) => `
                                                <tr class="flow-row-modern">
                                                    <td class="flow-no">${i + 1}</td>
                                                    <td><input type="text" class="flow-input flow-barcode-input" data-section="leave" data-index="${i}" placeholder="ÏõêÎ∞îÏΩîÎìú ÏûÖÎ†•"></td>
                                                    <td class="flow-name" data-section="leave" data-index="${i}">-</td>
                                                    <td><input type="text" class="flow-input flow-remark-input" data-section="leave" data-index="${i}" placeholder="ÎπÑÍ≥† ÏûÖÎ†•"></td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Newbie & WD -->
                            <div class="flow-section-modern" data-color="pink">
                                <div class="flow-header-modern">
                                    <div class="flow-title-group">
                                        <div class="flow-icon">üÜï</div>
                                        <h3>Newbie & WD</h3>
                                    </div>
                                    <div class="flow-count-badge" id="newbie-count">0Î™Ö</div>
                                </div>
                                <div class="flow-table-container">
                                    <table class="flow-table-modern">
                                        <thead>
                                            <tr>
                                                <th style="width: 60px;">NO</th>
                                                <th style="width: 140px;">ÏõêÎ∞îÏΩîÎìú</th>
                                                <th style="width: 200px;">ÎπÑÍ≥†</th>
                                            </tr>
                                        </thead>
                                        <tbody id="flow-newbie-tbody">
                                            ${Array.from({length: 35}, (_, i) => `
                                                <tr class="flow-row-modern">
                                                    <td class="flow-no">${i + 36}</td>
                                                    <td><input type="text" class="flow-input flow-barcode-input" data-section="newbie" data-index="${i}" placeholder="ÏõêÎ∞îÏΩîÎìú ÏûÖÎ†•"></td>
                                                    <td><input type="text" class="flow-input flow-remark-input" data-section="newbie" data-index="${i}" placeholder="ÎπÑÍ≥† ÏûÖÎ†•"></td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                setTimeout(() => {
                    initializeFlowTab();
                }, 0);
                return;
            }
            
            const content = tabContents[tabId];
            contentArea.innerHTML = `
                <div class="tab-content" style="animation: fadeIn 0.3s ease-out;">
                    <h2 style="color: var(--text-primary); font-size: 28px; font-weight: 700; margin-bottom: 16px;">${content.title}</h2>
                    <p style="color: var(--text-secondary); font-size: 16px; line-height: 1.6;">${content.content}</p>
                    <div style="margin-top: 32px; padding: 24px; background: var(--surface-secondary); border-radius: 16px; border: 1px solid var(--border);">
                        <p style="color: var(--text-secondary); font-size: 14px; text-align: center; opacity: 0.8;">
                            ${content.title} Í∏∞Îä•Ïù¥ Í≥ß ÏóÖÎç∞Ïù¥Ìä∏Îê©ÎãàÎã§. ‚ú®
                        </p>
                    </div>
                </div>
            `;
        }

        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('hour1').textContent = hours[0];
            document.getElementById('hour2').textContent = hours[1];
            document.getElementById('minute1').textContent = minutes[0];
            document.getElementById('minute2').textContent = minutes[1];
            document.getElementById('second1').textContent = seconds[0];
            document.getElementById('second2').textContent = seconds[1];
            checkUrgentDeadline(now);
        }

        function checkUrgentDeadline(currentTime) {
            const clockElement = document.getElementById('currentClock');
            let isUrgent = false;
            const deadlines = [ { hour: 11, minute: 10 }, { hour: 11, minute: 30 }, { hour: 17, minute: 30 }, { hour: 22, minute: 0 }, { hour: 1, minute: 15 }, { hour: 3, minute: 30 }, { hour: 4, minute: 30 } ];
            deadlines.forEach(deadline => {
                const deadlineTime = new Date(currentTime);
                deadlineTime.setHours(deadline.hour, deadline.minute, 0, 0);
                const urgentTime = new Date(deadlineTime);
                urgentTime.setHours(urgentTime.getHours() - 1);
                if (currentTime >= urgentTime && currentTime <= deadlineTime) {
                    isUrgent = true;
                }
            });
            if (isUrgent) {
                clockElement.classList.add('clock-urgent');
            } else {
                clockElement.classList.remove('clock-urgent');
            }
        }
        
        function displayCurrentDate() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const date = String(now.getDate()).padStart(2, '0');
            const dayNames = ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'];
            const day = dayNames[now.getDay()];
            const formattedDate = `${year}ÎÖÑ ${month}Ïõî ${date}Ïùº (${day})`;
            const dateElement = document.createElement('span');
            dateElement.className = 'date-display';
            dateElement.textContent = formattedDate;
            const titleContainer = document.querySelector('.header-title');
            if (titleContainer) {
                titleContainer.appendChild(dateElement);
            }
        }
        
        function captureElementAsImage(elementId, friendlyName) {
            const element = document.getElementById(elementId);
            if (!element) {
                alert('Ï∫°Ï≤òÌï† ÎåÄÏÉÅÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                return;
            }
            const currentTheme = document.documentElement.getAttribute("color-theme");
            const bgColor = (currentTheme === 'dark') ? '#1e293b' : '#f8fafc';

            html2canvas(element, { 
                useCORS: true, 
                backgroundColor: bgColor,
                scale: 2
            }).then(canvas => {
                canvas.toBlob(blob => {
                    if (navigator.clipboard && navigator.clipboard.write) {
                        const item = new ClipboardItem({ 'image/png': blob });
                        navigator.clipboard.write([item]).then(() => {
                            alert(`'${friendlyName}' Î∞ïÏä§Í∞Ä Ïù¥ÎØ∏ÏßÄ(PNG)Î°ú Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!`);
                        }).catch(err => {
                            console.error('ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨ Ïã§Ìå®:', err);
                            alert('ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. Î∏åÎùºÏö∞Ï†Ä Í∂åÌïúÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
                        });
                    } else {
                        alert('Ïù¥ Î∏åÎùºÏö∞Ï†ÄÏóêÏÑúÎäî ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨ Í∏∞Îä•ÏùÑ ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.');
                    }
                }, 'image/png');
            });
        }
        
        function initializeHomeTabListeners() {
            document.querySelectorAll('.staffing-input, .report-input').forEach(input => {
                input.addEventListener('input', () => {
                    saveDataToFirestore();
                    notifyTyping();
                });
            });
            document.getElementById('reset-btn')?.addEventListener('click', () => {
                if (confirm('Ï†ïÎßêÎ°ú Î™®Îì† Í∞íÏùÑ 0ÏúºÎ°ú Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    const defaultData = getInitialData();
                    setDoc(docRef, defaultData);
                    alert('Î™®Îì† Í∞íÏù¥ 0ÏúºÎ°ú Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§.');
                }
            });
            document.getElementById('capture-staffing-btn')?.addEventListener('click', () => captureElementAsImage('staffing-box', 'Ïù∏Ïõê ÌòÑÌô©'));
            document.getElementById('capture-report-btn')?.addEventListener('click', () => captureElementAsImage('report-box', 'OB Report'));
        }

        document.addEventListener("DOMContentLoaded", function () {
            const savedTheme = localStorage.getItem("color-theme") || "light";
            document.documentElement.setAttribute("color-theme", savedTheme);
            
            displayCurrentDate(); 
            updateClock();
            setInterval(updateClock, 1000);

            document.querySelectorAll('.tab-item').forEach(tab => {
                tab.addEventListener('click', () => switchTab(tab.dataset.tab));
            });
            
            // Î°úÍ∑∏Ïù∏ ÏÑ§Ï†ï (Ïù¥ Ï§Ñ Ï∂îÍ∞Ä!)
            setupLoginListeners();
            
            switchTab('home');
			
			// Î°úÍ∑∏ Ìå®ÎÑê Ïù¥Î≤§Ìä∏
            document.getElementById('activityLogBtn')?.addEventListener('click', toggleActivityLog);
            document.getElementById('closeLogBtn')?.addEventListener('click', toggleActivityLog);
        });

        const toggleButton = document.querySelector('.dark-light-toggle');
        toggleButton.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute("color-theme");
            const newTheme = currentTheme === "light" ? "dark" : "light";
            document.documentElement.setAttribute("color-theme", newTheme);
            localStorage.setItem("color-theme", newTheme);
        });

        // Firestore Îç∞Ïù¥ÌÑ∞ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
        onSnapshot(docRef, (doc) => {
            updateConnectionStatus(true);
            if (doc.exists()) {
                cachedData = doc.data();
                updateUIFromData(cachedData);
            } else {
                console.log("No such document! Creating with initial data.");
                setDoc(docRef, getInitialData());
            }
        }, (error) => {
            console.error('Connection error:', error);
            updateConnectionStatus(false);
        });
		
		// ÌÉÄÏù¥Ìïë ÏÉÅÌÉú Î¶¨Ïä§ÎÑà - Ïª¨Î†âÏÖò Ï†ÑÏ≤¥ Í∞êÏãú
        const typingCollectionRef = collection(db, "typing");
        onSnapshot(typingCollectionRef, (snapshot) => {
            const typingIndicator = document.getElementById('typingIndicator');
            const typingUser = document.getElementById('typingUser');
            
            if (!typingIndicator || !typingUser) return;
            
            const now = new Date().getTime();
            const typingUsers = [];
            
            snapshot.forEach((doc) => {
                const data = doc.data();
                // 5Ï¥à Ïù¥ÎÇ¥ & Î≥∏Ïù∏ ÏïÑÎãå Í≤ΩÏö∞Îßå
                if (data.displayName && 
                    data.timestamp && 
                    (now - data.timestamp < 5000) &&
                    data.displayName !== currentUser?.displayName) {
                    typingUsers.push(data.displayName);
                }
            });
            
            if (typingUsers.length > 0) {
                if (typingUsers.length === 1) {
                    typingUser.textContent = typingUsers[0] + ' ÎãòÏù¥';
                } else {
                    typingUser.textContent = typingUsers.join(', ') + ' ÎãòÏù¥';
                }
                typingIndicator.style.display = 'flex';
            } else {
                typingIndicator.style.display = 'none';
            }
        });
        
        function getInitialData() {
            // Î™®Îì† ÏûÖÎ†• ÌïÑÎìúÏùò Í∏∞Î≥∏Í∞íÏùÑ Ìè¨Ìï®ÌïòÎäî Í∞ùÏ≤¥Î•º Î∞òÌôòÌïòÎäî Ìï®Ïàò
            return {
                staffing: {
                    'perm-tc-plan': 0, 'perm-tc-actual': 0,
                    'perm-perm-plan': 0, 'perm-perm-actual': 0,
                    'temp-temp-plan': 0, 'temp-temp-actual': 0,
                    'temp-newbie-plan': 0, 'temp-newbie-actual': 0,
                },
                report: {
                    managers: Array(24).fill(''),
                    remarks: Array(3).fill('')
                }
            };
        }
        
        function saveDataToFirestore() {
            const staffingData = {};
            document.querySelectorAll('.staffing-input').forEach(input => {
                staffingData[input.id] = parseInt(input.value) || 0;
            });

            const managerInputs = document.querySelectorAll('#manager-report-table .report-input');
            const managerData = Array.from(managerInputs).map(input => input.value.trim() || '');
            
            const remarkInputs = document.querySelectorAll('.report-remark');
            const remarkData = Array.from(remarkInputs).map(input => input.value.trim() || '');

            const dataToSave = {
                staffing: staffingData,
                report: {
                    managers: managerData,
                    remarks: remarkData
                }
            };
            
            // 5Ï¥à ÎîîÎ∞îÏö¥Ïä§ - ÎßàÏßÄÎßâ ÏàòÏ†ïÎßå Í∏∞Î°ù
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                // Î≥ÄÍ≤ΩÏÇ¨Ìï≠ Î°úÍ∑∏ Í∏∞Î°ù (ÏûêÎèô Í∞êÏßÄ)
                if (Object.keys(lastSavedData).length > 0) {
                    logChangesAuto(lastSavedData, dataToSave);
                }
                lastSavedData = JSON.parse(JSON.stringify(dataToSave));
                
                setDoc(docRef, dataToSave, { merge: true });
            }, 5000);
        }
		
		// ÏûêÎèô Î≥ÄÍ≤ΩÏÇ¨Ìï≠ Í∞êÏßÄ (Î™®Îì† ÌïÑÎìú ÏûêÎèô Ï∂îÏ†Å)
        function logChangesAuto(oldData, newData) {
            if (!currentUser) return;
            
            const changes = [];
            
            // Ïû¨Í∑ÄÏ†ÅÏúºÎ°ú Î™®Îì† Î≥ÄÍ≤ΩÏÇ¨Ìï≠ Ï∞æÍ∏∞
            function findChanges(oldObj, newObj, path = '') {
                if (typeof newObj !== 'object' || newObj === null) {
                    if (oldObj !== newObj) {
                        changes.push({
                            field: path,
                            oldValue: oldObj === undefined || oldObj === null ? '-' : String(oldObj),
                            newValue: newObj === undefined || newObj === null ? '-' : String(newObj)
                        });
                    }
                    return;
                }
                
                // Î∞∞Ïó¥ Ï≤òÎ¶¨
                if (Array.isArray(newObj)) {
                    newObj.forEach((item, index) => {
                        const oldItem = oldObj?.[index];
                        const fieldPath = path ? `${path}[${index}]` : `[${index}]`;
                        
                        // Îπà Í∞íÎÅºÎ¶¨Îäî Î¨¥Ïãú
                        if ((oldItem || item) && oldItem !== item) {
                            findChanges(oldItem, item, fieldPath);
                        }
                    });
                    return;
                }
                
                // Í∞ùÏ≤¥ Ï≤òÎ¶¨
                for (const key in newObj) {
                    const oldValue = oldObj?.[key];
                    const newValue = newObj[key];
                    const fieldPath = path ? `${path}.${key}` : key;
                    
                    findChanges(oldValue, newValue, fieldPath);
                }
            }
            
            findChanges(oldData, newData);
            
            // Î≥ÄÍ≤ΩÏÇ¨Ìï≠Ïù¥ ÏûàÏúºÎ©¥ FirestoreÏóê Ï†ÄÏû•
            if (changes.length > 0) {
                const logRef = doc(collection(db, "activityLogs"));
                setDoc(logRef, {
                    user: currentUser.displayName,
                    timestamp: new Date().getTime(),
                    changes: changes
                });
            }
        }
        
        // Î°úÍ∑∏ Ìå®ÎÑê ÌÜ†Í∏Ä
        function toggleActivityLog() {
            const panel = document.getElementById('activityLogPanel');
            panel.classList.toggle('open');
            
            if (panel.classList.contains('open')) {
                loadActivityLogs();
            }
        }
        
        // Î°úÍ∑∏ Î∂àÎü¨Ïò§Í∏∞
        function loadActivityLogs() {
            const logsCollectionRef = collection(db, "activityLogs");
            
            onSnapshot(logsCollectionRef, (snapshot) => {
                const logs = [];
                const sevenDaysAgo = new Date().getTime() - (7 * 24 * 60 * 60 * 1000);
                
                snapshot.forEach((docSnapshot) => {
                    const data = docSnapshot.data();
                    
                    // 7Ïùº Ïù¥ÏÉÅ Îêú Î°úÍ∑∏Îäî ÏÇ≠Ï†ú
                    if (data.timestamp < sevenDaysAgo) {
                        docSnapshot.ref.delete();
                    } else {
                        logs.push({ id: docSnapshot.id, ...data });
                    }
                });
                
                // ÏµúÏã†Ïàú Ï†ïÎ†¨
                logs.sort((a, b) => b.timestamp - a.timestamp);
                
                // ÏµúÍ∑º 20Í∞úÎßå ÌëúÏãú
                displayActivityLogs(logs.slice(0, 20));
            }, (error) => {
                console.error('Î°úÍ∑∏ Î°úÎî© ÏóêÎü¨:', error);
            });
        }
        
        // Î°úÍ∑∏ ÌëúÏãú
        function displayActivityLogs(logs) {
            const content = document.getElementById('activityLogContent');
            
            if (logs.length === 0) {
                content.innerHTML = '<div class="log-empty">ÏïÑÏßÅ Î≥ÄÍ≤Ω ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.</div>';
                return;
            }
            
            // ÌïÑÎìúÎ™Ö ÌïúÍ∏ÄÌôî (ÏûêÎèô Î≥ÄÌôò)
            function prettifyFieldName(field) {
                // 1Îã®Í≥Ñ: ÏïåÎ†§ÏßÑ ÌïÑÎìúÎ™Ö Îß§Ìïë
                const fieldMap = {
                    'staffing.perm-tc-plan': 'T/C Plan',
                    'staffing.perm-tc-actual': 'T/C Actual',
                    'staffing.perm-perm-plan': 'Perm Plan',
                    'staffing.perm-perm-actual': 'Perm Actual',
                    'staffing.temp-temp-plan': 'Temp Plan',
                    'staffing.temp-temp-actual': 'Temp Actual',
                    'staffing.temp-newbie-plan': 'Newbie Plan',
                    'staffing.temp-newbie-actual': 'Newbie Actual'
                };
                
                if (fieldMap[field]) {
                    return fieldMap[field];
                }
                
                // 2Îã®Í≥Ñ: Ìå®ÌÑ¥ Í∏∞Î∞ò ÏûêÎèô Î≥ÄÌôò
                
                // report.managers[Ïà´Ïûê] ‚Üí Manager Ïà´Ïûê+1
                const managerMatch = field.match(/report\.managers\[(\d+)\]/);
                if (managerMatch) {
                    return `Manager ${parseInt(managerMatch[1]) + 1}`;
                }
                
                // report.remarks[Ïà´Ïûê] ‚Üí ÎπÑÍ≥† Ïà´Ïûê+1
                const remarkMatch = field.match(/report\.remarks\[(\d+)\]/);
                if (remarkMatch) {
                    const index = parseInt(remarkMatch[1]);
                    const remarkNames = ['T/C ÎπÑÍ≥†', 'Í≥ÑÏïΩÏßÅ ÎπÑÍ≥†', 'Îã®Í∏∞ÏßÅ ÎπÑÍ≥†'];
                    return remarkNames[index] || `ÎπÑÍ≥† ${index + 1}`;
                }
                
                // 3Îã®Í≥Ñ: ÏùºÎ∞ò Ìå®ÌÑ¥ ÏûêÎèô Î≥ÄÌôò
                const arrayMatch = field.match(/(\w+)\.(\w+)\[(\d+)\]/);
                if (arrayMatch) {
                    const [_, section, property, index] = arrayMatch;
                    const sectionName = section.toUpperCase();
                    const propertyName = property.charAt(0).toUpperCase() + property.slice(1);
                    return `${sectionName} ${propertyName} ${parseInt(index) + 1}`;
                }
                
                // 4Îã®Í≥Ñ: Ï†ê ÌëúÍ∏∞Î≤ï ÏûêÎèô Î≥ÄÌôò
                const dotMatch = field.match(/(\w+)\.(\w+)/);
                if (dotMatch) {
                    const [_, section, property] = dotMatch;
                    const sectionName = section.charAt(0).toUpperCase() + section.slice(1);
                    const propertyName = property.split(/[-_]/).map(word => 
                        word.charAt(0).toUpperCase() + word.slice(1)
                    ).join(' ');
                    return `${sectionName} ${propertyName}`;
                }
                
                // 5Îã®Í≥Ñ: Í∑∏ Ïô∏Îäî kebab-caseÎ•º Title CaseÎ°ú Î≥ÄÌôò
                return field.split(/[-_.]/).map(word => 
                    word.charAt(0).toUpperCase() + word.slice(1)
                ).join(' ');
            }
            
            content.innerHTML = logs.map(log => {
                const timeAgo = getTimeAgo(log.timestamp);
                const changesHtml = log.changes.map(change => {
                    const prettyField = prettifyFieldName(change.field);
                    return `<div class="log-change">
                        ${prettyField}: <span class="log-value">${change.oldValue}</span> ‚Üí <span class="log-value">${change.newValue}</span>
                    </div>`;
                }).join('');
                
                return `
                    <div class="log-item">
                        <div><span class="log-user">${log.user}</span>ÎãòÏù¥ ÏàòÏ†ï</div>
                        ${changesHtml}
                        <div class="log-time">${timeAgo}</div>
                    </div>
                `;
            }).join('');
        }
        
        // ÏãúÍ∞Ñ Í≥ÑÏÇ∞ (Î™á Î∂Ñ Ï†Ñ)
        function getTimeAgo(timestamp) {
            const now = new Date().getTime();
            const diff = now - timestamp;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            
            if (days > 0) return `${days}Ïùº Ï†Ñ`;
            if (hours > 0) return `${hours}ÏãúÍ∞Ñ Ï†Ñ`;
            if (minutes > 0) return `${minutes}Î∂Ñ Ï†Ñ`;
            return 'Î∞©Í∏à Ï†Ñ';
        }
		
		// ÏûÖÎ†•Ï§ë ÌÉÄÏù¥Ìïë
        function notifyTyping() {
            if (!currentUser) return;
            
            // Í∞Å ÏÇ¨Ïö©ÏûêÎ≥Ñ Î¨∏ÏÑúÎ°ú Ï†ÄÏû•
            const typingRef = doc(db, "typing", currentUser.username);
            setDoc(typingRef, {
                displayName: currentUser.displayName,
                timestamp: new Date().getTime()
            });
            
            // 3Ï¥à ÌõÑ ÌÉÄÏù¥Ìïë ÏÉÅÌÉú Ï†úÍ±∞
            clearTimeout(typingTimeout);
            typingTimeout = setTimeout(() => {
                setDoc(typingRef, {
                    displayName: null,
                    timestamp: null
                });
            }, 3000);
        }

        function updateUIFromData(data) {
            // Ïù∏Ïõê ÌòÑÌô© Îç∞Ïù¥ÌÑ∞ Ï±ÑÏö∞Í∏∞
            if (data.staffing) {
                for (const id in data.staffing) {
                    const input = document.getElementById(id);
                    if (input) input.value = data.staffing[id];
                }
            }
            
            // OB Report Îç∞Ïù¥ÌÑ∞ Ï±ÑÏö∞Í∏∞
            if (data.report && data.report.managers) {
                const managerInputs = document.querySelectorAll('#manager-report-table .report-input');
                managerInputs.forEach((input, index) => {
                    const value = data.report.managers[index];
                    // '-'Ïù¥Î©¥ Îπà Î¨∏ÏûêÏó¥Î°ú Ï≤òÎ¶¨ (placeholderÍ∞Ä Î≥¥Ïù¥ÎèÑÎ°ù)
                    input.value = (value === '-' || !value) ? '' : value;
                });
            }
            
            // Ïã§ÏãúÍ∞Ñ Ïù∏Ïõê ÌòÑÌô© ÎπÑÍ≥† Ï±ÑÏö∞Í∏∞
            if (data.report && data.report.remarks) {
                const remarkInputs = document.querySelectorAll('.report-remark');
                remarkInputs.forEach((input, index) => {
                    const value = data.report.remarks[index];
                    // '-'Ïù¥Î©¥ Îπà Î¨∏ÏûêÏó¥Î°ú Ï≤òÎ¶¨ (placeholderÍ∞Ä Î≥¥Ïù¥ÎèÑÎ°ù)
                    input.value = (value === '-' || !value) ? '' : value;
                });
            }

            calculateAll();
            
            // Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
            if (Object.keys(lastSavedData).length === 0) {
                lastSavedData = JSON.parse(JSON.stringify(data));
            }
        }
		
		function showAdminPanel() {
            const adminPanel = document.getElementById('adminPanel');
            if (!adminPanel) return;
            
            adminPanel.style.display = 'block';
            renderUserList();
            
            // Í≥ÑÏ†ï Ï∂îÍ∞Ä Î≤ÑÌäº
            document.getElementById('addUserBtn').onclick = () => {
                const username = document.getElementById('newUsername').value.trim();
                const displayName = document.getElementById('newDisplayName').value.trim();
                const password = document.getElementById('newPassword').value;
                
                if (!username || !displayName || !password) {
                    alert('Î™®Îì† ÌïÑÎìúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }
                
                if (users.find(u => u.username.toLowerCase() === username.toLowerCase())) {
                    alert('Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÎäî ÏïÑÏù¥ÎîîÏûÖÎãàÎã§.');
                    return;
                }
                
                users.push({ username, displayName, password });
                document.getElementById('newUsername').value = '';
                document.getElementById('newDisplayName').value = '';
                document.getElementById('newPassword').value = '';
                
                renderUserList();
                alert('Í≥ÑÏ†ïÏù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§!');
            };
        }
        
        function renderUserList() {
            const userList = document.getElementById('userList');
            if (!userList) return;
            
            userList.innerHTML = users.map((user, index) => `
                <div class="user-item">
                    <div class="user-info">
                        <div class="user-avatar" style="width: 32px; height: 32px; font-size: 14px;">${user.displayName.charAt(0).toUpperCase()}</div>
                        <div>
                            <div style="font-weight: 600;">${user.displayName}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">@${user.username}</div>
                        </div>
                    </div>
                    ${user.username.toLowerCase() !== 'admin' ? `<button class="delete-btn" onclick="deleteUser(${index})">ÏÇ≠Ï†ú</button>` : '<span style="color: var(--accent); font-weight: 600; font-size: 12px;">Í¥ÄÎ¶¨Ïûê</span>'}
                </div>
            `).join('');
        }
        
        window.deleteUser = function(index) {
            if (confirm(`'${users[index].displayName}' Í≥ÑÏ†ïÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
                users.splice(index, 1);
                renderUserList();
                alert('Í≥ÑÏ†ïÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
            }
        }
		
		function setupLoginListeners() {
            const loginModal = document.getElementById('loginModal');
            const loginBtn = document.getElementById('loginBtn');
            const registerBtn = document.getElementById('registerBtn');
            const userBadge = document.getElementById('userBadge');
            const loginError = document.getElementById('loginError');

            // ÌöåÏõêÍ∞ÄÏûÖ Î≤ÑÌäº Ïà®Í∏∞Í∏∞
            registerBtn.style.display = 'none';

            // Î°úÍ∑∏Ïù∏ Î≤ÑÌäº
            loginBtn.addEventListener('click', () => {
                const username = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                // ÎåÄÏÜåÎ¨∏Ïûê Íµ¨Î∂Ñ ÏóÜÏù¥ ÎπÑÍµê
                const user = users.find(u => 
                    u.username.toLowerCase() === username.toLowerCase() && 
                    u.password === password
                );
                
                if (user) {
                    currentUser = user;
                    document.getElementById('userName').textContent = user.displayName;
                    document.getElementById('userAvatar').textContent = user.displayName.charAt(0).toUpperCase();
                    userBadge.style.display = 'flex';
                    loginModal.classList.remove('active');
                    loginError.style.display = 'none';
                    
                    // ÏÑ∏ÏÖòÏóê Ï†ÄÏû•
                    sessionStorage.setItem('currentUser', JSON.stringify(user));
                    
                    // Admin Í≥ÑÏ†ïÏù¥Î©¥ Í¥ÄÎ¶¨Ïûê Ìå®ÎÑê ÌëúÏãú
                    if (user.username.toLowerCase() === 'admin') {
                        setTimeout(() => {
                    initializeHomeTabListeners();
                    if (cachedData) {
                        updateUIFromData(cachedData);
                    }
                    // Admin ÏÇ¨Ïö©ÏûêÎ©¥ Í¥ÄÎ¶¨Ïûê Ìå®ÎÑê Îã§Ïãú ÌëúÏãú
                    if (currentUser && currentUser.username.toLowerCase() === 'admin') {
                        showAdminPanel();
                    }
                }, 0);
                    }
                } else {
                    loginError.textContent = 'ÏïÑÏù¥Îîî ÎòêÎäî ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.';
                    loginError.style.display = 'block';
                }
            });

            // Enter ÌÇ§Î°ú Î°úÍ∑∏Ïù∏
            document.getElementById('loginPassword').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    loginBtn.click();
                }
            });

            // ÏÇ¨Ïö©Ïûê Î±ÉÏßÄ ÌÅ¥Î¶≠ Ïãú Î°úÍ∑∏ÏïÑÏõÉ
            userBadge.addEventListener('click', () => {
                if (confirm('Î°úÍ∑∏ÏïÑÏõÉ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    currentUser = null;
                    userBadge.style.display = 'none';
                    loginModal.classList.add('active');
                    sessionStorage.removeItem('currentUser');
                    document.getElementById('loginEmail').value = '';
                    document.getElementById('loginPassword').value = '';
                }
            });

            const savedUser = sessionStorage.getItem('currentUser');
            if (savedUser) {
                const user = JSON.parse(savedUser);
                currentUser = user;
                document.getElementById('userName').textContent = user.displayName;
                document.getElementById('userAvatar').textContent = user.displayName.charAt(0).toUpperCase();
                userBadge.style.display = 'flex';
                
                // Admin Í≥ÑÏ†ïÏù¥Î©¥ Í¥ÄÎ¶¨Ïûê Ìå®ÎÑê ÌëúÏãú
                if (user.username.toLowerCase() === 'admin') {
                    setTimeout(() => {
                        showAdminPanel();
                    }, 500);
                }
            } else {
                loginModal.classList.add('active');
            }
        }
		
        function updateReportTotal() {
            const managerReportTable = document.getElementById('manager-report-table');
            if (!managerReportTable) return;
            const nameInputs = managerReportTable.querySelectorAll('.report-input');
            let count = 0;
            nameInputs.forEach(input => {
                if (input.value.trim() !== '' && input.value.trim() !== '-') {
                    count++;
                }
            });
            const reportTotalCell = document.getElementById('report-manager-total');
            if(reportTotalCell) reportTotalCell.textContent = count;
        }
		
		function updateConnectionStatus(connected) {
            const status = document.getElementById('connectionStatus');
            const dot = document.getElementById('statusDot');
            const text = document.getElementById('statusText');
            
            if (connected) {
                status.className = 'connection-status connected';
                dot.className = 'status-dot connected';
                text.textContent = 'ÏÑúÎ≤Ñ Ïó∞Í≤∞ ÏôÑÎ£å';
            } else {
                status.className = 'connection-status';
                dot.className = 'status-dot';
                text.textContent = 'Ïó∞Í≤∞ Ï§ë...';
            }
        }

        function calculateAll() {
            const dateElement = document.getElementById('current-date');
            if (dateElement) {
                const now = new Date();
                const dateStr = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} (${['Ïùº','Ïõî','Ìôî','Ïàò','Î™©','Í∏à','ÌÜ†'][now.getDay()]})`;
                dateElement.textContent = dateStr;
            }
            
            const permTcPlan = parseInt(document.getElementById('perm-tc-plan')?.value) || 0;
            const permTcActual = parseInt(document.getElementById('perm-tc-actual')?.value) || 0;
            const permPermPlan = parseInt(document.getElementById('perm-perm-plan')?.value) || 0;
            const permPermActual = parseInt(document.getElementById('perm-perm-actual')?.value) || 0;
            const tempTempPlan = parseInt(document.getElementById('temp-temp-plan')?.value) || 0;
            const tempTempActual = parseInt(document.getElementById('temp-temp-actual')?.value) || 0;
            const tempNewbiePlan = parseInt(document.getElementById('temp-newbie-plan')?.value) || 0;
            const tempNewbieActual = parseInt(document.getElementById('temp-newbie-actual')?.value) || 0;
            
            const permTcGap = permTcActual - permTcPlan;
            const permPermGap = permPermActual - permPermPlan;
            const tempTempGap = tempTempActual - tempTempPlan;
            const tempNewbieGap = tempNewbieActual - tempNewbiePlan;
            
            const permTotalPlan = permTcPlan + permPermPlan;
            const permTotalActual = permTcActual + permPermActual;
            const permTotalGap = permTotalActual - permTotalPlan;
            
            const tempTotalPlan = tempTempPlan + tempNewbiePlan;
            const tempTotalActual = tempTempActual + tempNewbieActual;
            const tempTotalGap = tempTotalActual - tempTotalPlan;
            
            const grandTotalPlan = permTotalPlan + tempTotalPlan;
            const grandTotalActual = permTotalActual + tempTotalActual;
            const grandTotalGap = grandTotalActual - grandTotalPlan;
            
            const hiringRate = grandTotalPlan > 0 ? ((grandTotalActual / grandTotalPlan) * 100).toFixed(0) : 0;
            
            const setGapColor = (element, value) => {
                if (!element) return;
                if (value > 0) {
                    element.style.color = '#4ade80';
                    element.textContent = '+' + value;
                } else if (value < 0) {
                    element.style.color = '#f87171';
                    element.textContent = value;
                } else {
                    element.style.color = 'var(--text-primary)';
                    element.textContent = '0';
                }
            };
            
            setGapColor(document.getElementById('perm-tc-gap'), permTcGap);
            setGapColor(document.getElementById('perm-perm-gap'), permPermGap);
            setGapColor(document.getElementById('temp-temp-gap'), tempTempGap);
            setGapColor(document.getElementById('temp-newbie-gap'), tempNewbieGap);
            
            if (document.getElementById('perm-total-plan')) document.getElementById('perm-total-plan').textContent = permTotalPlan;
            if (document.getElementById('perm-total-actual')) document.getElementById('perm-total-actual').textContent = permTotalActual;
            setGapColor(document.getElementById('perm-total-gap'), permTotalGap);
            
            if (document.getElementById('temp-total-plan')) document.getElementById('temp-total-plan').textContent = tempTotalPlan;
            if (document.getElementById('temp-total-actual')) document.getElementById('temp-total-actual').textContent = tempTotalActual;
            setGapColor(document.getElementById('temp-total-gap'), tempTotalGap);
            
            if (document.getElementById('grand-total-plan')) document.getElementById('grand-total-plan').textContent = grandTotalPlan;
            if (document.getElementById('grand-total-actual')) document.getElementById('grand-total-actual').textContent = grandTotalActual;
            setGapColor(document.getElementById('grand-total-gap'), grandTotalGap);
            
            const hiringRateElement = document.getElementById('hiring-rate');
            if (hiringRateElement) hiringRateElement.textContent = hiringRate;

            const reportTcActual = permTcActual;
            const reportPermActual = permPermActual;
            const reportTempActual = tempTempActual;
            const reportTotalActual = reportTcActual + reportPermActual + reportTempActual;

            if(document.getElementById('report-tc-actual')) document.getElementById('report-tc-actual').textContent = reportTcActual + ' Î™Ö';
            if(document.getElementById('report-perm-actual')) document.getElementById('report-perm-actual').textContent = reportPermActual + ' Î™Ö';
            if(document.getElementById('report-temp-actual')) document.getElementById('report-temp-actual').textContent = reportTempActual + ' Î™Ö';
            if(document.getElementById('report-total-actual')) document.getElementById('report-total-actual').textContent = reportTotalActual + ' Î™Ö';

            updateReportTotal();
        }
		
		// DATA ÌÉ≠ Ï¥àÍ∏∞Ìôî
        function initializeDataTab() {
            // Ìñâ Ï∂îÍ∞Ä Î≤ÑÌäº Ïù¥Î≤§Ìä∏ (Í∏∞Ï°¥ + ÏÉà ÎîîÏûêÏù∏)
            document.querySelectorAll('.add-row-btn, .add-row-btn-modern').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const tableType = e.target.dataset.table;
                    addTableRow(tableType);
                });
            });

            // Ìñâ ÏÇ≠Ï†ú Î≤ÑÌäº Ïù¥Î≤§Ìä∏
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('delete-row-btn')) {
                    const row = e.target.closest('tr');
                    if (row.parentElement.querySelectorAll('tr').length > 1) {
                        row.remove();
                        saveDataTabToFirestore();
                    } else {
                        alert('ÏµúÏÜå 1Í∞úÏùò ÌñâÏùÄ Ïú†ÏßÄÌï¥Ïïº Ìï©ÎãàÎã§.');
                    }
                }
            });

            // ÏûÖÎ†• Î≥ÄÍ≤Ω Ïãú ÏûêÎèô Ï†ÄÏû•
            document.querySelectorAll('.data-input, .data-select, .skill-checkbox').forEach(input => {
                input.addEventListener('change', saveDataTabToFirestore);
                input.addEventListener('input', saveDataTabToFirestore);
            });
            
            // Ï°∞Î≥Ñ Ï†ïÎ†¨ Î≤ÑÌäº
            document.getElementById('sort-permanent-btn')?.addEventListener('click', () => {
                const tbody = document.getElementById('permanent-tbody');
                if (!tbody) return;

                const rows = Array.from(tbody.querySelectorAll('tr'));

                rows.sort((rowA, rowB) => {
                    const selectA = rowA.querySelector('select');
                    const selectB = rowB.querySelector('select');

                    if (!selectA || !selectB) return 0;

                    return selectA.value.localeCompare(selectB.value);
                });

                rows.forEach(row => tbody.appendChild(row));

                saveDataTabToFirestore();
                alert('Í≥ÑÏïΩÏßÅ ÏÇ¨Ïõê Î™©Î°ùÏù¥ Ï°∞Î≥ÑÎ°ú Ï†ïÎ†¨ÎêòÏóàÏäµÎãàÎã§.');
            });
            
            // Ïù¥Î¶Ñ Ï†ïÎ†¨ Î≤ÑÌäº
            document.getElementById('sort-temporary-btn')?.addEventListener('click', () => {
                const tbody = document.getElementById('temporary-tbody');
                if (!tbody) return;

                const rows = Array.from(tbody.querySelectorAll('tr'));

                rows.sort((rowA, rowB) => {
                    const inputA = rowA.querySelectorAll('.data-input')[1];
                    const inputB = rowB.querySelectorAll('.data-input')[1];

                    if (!inputA || !inputB) return 0;

                    return inputA.value.localeCompare(inputB.value);
                });

                rows.forEach(row => tbody.appendChild(row));

                saveDataTabToFirestore();
                alert('Îã®Í∏∞ÏßÅ ÏÇ¨Ïõê Î™©Î°ùÏù¥ Ïù¥Î¶ÑÏàúÏúºÎ°ú Ï†ïÎ†¨ÎêòÏóàÏäµÎãàÎã§.');
            });
            
            // Ï†ÑÏ≤¥ ÏÇ≠Ï†ú Î≤ÑÌäº (Í≥ÑÏïΩÏßÅ)
            document.getElementById('clear-permanent-btn')?.addEventListener('click', () => {
                if (!confirm('‚ö†Ô∏è Ï†ïÎßêÎ°ú Í≥ÑÏïΩÏßÅ ÏÇ¨Ïõê Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÏù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§!')) {
                    return;
                }
                
                const tbody = document.getElementById('permanent-tbody');
                if (!tbody) return;
                
                tbody.innerHTML = '';
                
                tbody.innerHTML = `
                    <tr class="data-row">
                        <td><input type="text" class="data-input" placeholder="ÏõêÎ∞îÏΩîÎìú"></td>
                        <td>
                            <select class="data-select">
                                <option value="">ÏÑ†ÌÉù</option>
                                <option value="A">AÏ°∞</option>
                                <option value="B">BÏ°∞</option>
                                <option value="C">CÏ°∞</option>
                                <option value="D">DÏ°∞</option>
                                <option value="E">EÏ°∞</option>
                                <option value="F">FÏ°∞</option>
                                <option value="G">GÏ°∞</option>
                            </select>
                        </td>
                        <td><input type="text" class="data-input" placeholder="Ïù¥Î¶Ñ"></td>
                        <td><input type="checkbox" class="skill-checkbox"></td>
                        <td><input type="checkbox" class="skill-checkbox"></td>
                        <td><input type="checkbox" class="skill-checkbox"></td>
                        <td><input type="checkbox" class="skill-checkbox"></td>
                        <td><input type="checkbox" class="skill-checkbox"></td>
                        <td><input type="checkbox" class="skill-checkbox"></td>
                        <td><input type="checkbox" class="skill-checkbox"></td>
                        <td><button class="delete-row-btn">üóëÔ∏è</button></td>
                    </tr>
                `;
                
                const newRow = tbody.querySelector('tr');
                newRow.querySelectorAll('.data-input, .data-select, .skill-checkbox').forEach(input => {
                    input.addEventListener('change', saveDataTabToFirestore);
                    input.addEventListener('input', saveDataTabToFirestore);
                });
                
                saveDataTabToFirestore();
                alert('‚úÖ Í≥ÑÏïΩÏßÅ ÏÇ¨Ïõê Îç∞Ïù¥ÌÑ∞Í∞Ä Ï†ÑÏ≤¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
            });
            
            // Ï†ÑÏ≤¥ ÏÇ≠Ï†ú Î≤ÑÌäº (Îã®Í∏∞ÏßÅ)
            document.getElementById('clear-temporary-btn')?.addEventListener('click', () => {
                if (!confirm('‚ö†Ô∏è Ï†ïÎßêÎ°ú Îã®Í∏∞ÏßÅ ÏÇ¨Ïõê Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÏù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§!')) {
                    return;
                }
                
                const tbody = document.getElementById('temporary-tbody');
                if (!tbody) return;
                
                tbody.innerHTML = '';
                
                tbody.innerHTML = `
                    <tr class="data-row">
                        <td><input type="text" class="data-input" placeholder="ÏõêÎ∞îÏΩîÎìú"></td>
                        <td><input type="text" class="data-input" placeholder="Ïù¥Î¶Ñ"></td>
                        <td><input type="checkbox" class="skill-checkbox"></td>
                        <td><input type="checkbox" class="skill-checkbox"></td>
                        <td><input type="checkbox" class="skill-checkbox"></td>
                        <td><input type="checkbox" class="skill-checkbox"></td>
                        <td><input type="checkbox" class="skill-checkbox"></td>
                        <td><input type="checkbox" class="skill-checkbox"></td>
                        <td><input type="checkbox" class="skill-checkbox"></td>
                        <td><button class="delete-row-btn">üóëÔ∏è</button></td>
                    </tr>
                `;
                
                const newRow = tbody.querySelector('tr');
                newRow.querySelectorAll('.data-input, .data-select, .skill-checkbox').forEach(input => {
                    input.addEventListener('change', saveDataTabToFirestore);
                    input.addEventListener('input', saveDataTabToFirestore);
                });
                
                saveDataTabToFirestore();
                alert('‚úÖ Îã®Í∏∞ÏßÅ ÏÇ¨Ïõê Îç∞Ïù¥ÌÑ∞Í∞Ä Ï†ÑÏ≤¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
            });

            // Î∂ôÏó¨ÎÑ£Í∏∞ Ïù¥Î≤§Ìä∏ ÏÑ§Ï†ï
            setupPasteListeners();
            
            // ÌÖåÏù¥Î∏î ÎÑàÎπÑ ÏûêÎèô Ï°∞Ï†ï
            document.querySelectorAll('.data-table th, .data-table td').forEach(cell => {
                cell.removeAttribute('style');
            });

            // FirestoreÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞
            loadDataTabFromFirestore();
        }

        // ÏóëÏÖÄ Î∂ôÏó¨ÎÑ£Í∏∞ Í∏∞Îä•
        function setupPasteListeners() {
            const tableConfigs = [
                { tbodyId: 'managers-tbody', columns: ['barcode', 'nickname', 'name'] },
                { tbodyId: 'tc-tbody', columns: ['barcode', 'nickname', 'name'] },
                { tbodyId: 'ps-tbody', columns: ['barcode', 'team', 'name'] },
                { tbodyId: 'permanent-tbody', columns: ['barcode', 'team', 'name', 'skill1', 'skill2', 'skill3', 'skill4', 'skill5', 'skill6', 'skill7'] },
                { tbodyId: 'temporary-tbody', columns: ['barcode', 'name', 'skill1', 'skill2', 'skill3', 'skill4', 'skill5', 'skill6', 'skill7'] },
                { tbodyId: 'newbie-tbody', columns: ['barcode', 'name'] },
                { tbodyId: 'cd-tbody', columns: ['barcode', 'process', 'name'] }
            ];

            tableConfigs.forEach(config => {
                const tbody = document.getElementById(config.tbodyId);
                if (!tbody) return;
                tbody.addEventListener('paste', (e) => handlePaste(e, config.tbodyId, config.columns));
            });
        }

        function handlePaste(e, tbodyId, columns) {
            e.preventDefault();
            
            const pastedText = (e.clipboardData || window.clipboardData).getData('text');
            const rows = pastedText.trim().split('\n');
            
            if (rows.length === 0) return;

            const tbody = document.getElementById(tbodyId);
            const tableType = tbodyId.replace('-tbody', '');
            let targetRow = e.target.closest('tr');
            let targetRowIndex = Array.from(tbody.children).indexOf(targetRow);

            rows.forEach((rowText, index) => {
                const cells = rowText.trim().split(/\s+/);
                if (cells.length === 0) return;

                if (targetRowIndex + index >= tbody.children.length) {
                    addTableRow(tableType);
                }

                const currentRow = tbody.children[targetRowIndex + index];
                const inputs = currentRow.querySelectorAll('.data-input');
                const selects = currentRow.querySelectorAll('.data-select');
                const checkboxes = currentRow.querySelectorAll('.skill-checkbox');

                let inputIdx = 0;
                let selectIdx = 0;
                let checkboxIdx = 0;

                columns.forEach((colType, colIndex) => {
                    if (colIndex >= cells.length) return;
                    const cellValue = cells[colIndex];

                    if (colType === 'team' || colType === 'process') {
                        if (selects[selectIdx]) {
                            selects[selectIdx].value = cellValue.toUpperCase();
                        }
                        selectIdx++;
                    } else if (colType.startsWith('skill')) {
                        if (checkboxes[checkboxIdx]) {
                            const isChecked = ['O', 'o', '1', 'true', 'TRUE', '‚úì', 'v', 'V'].includes(cellValue);
                            checkboxes[checkboxIdx].checked = isChecked;
                        }
                        checkboxIdx++;
                    } else {
                        if (inputs[inputIdx]) {
                            inputs[inputIdx].value = cellValue;
                        }
                        inputIdx++;
                    }
                });
            });

            saveDataTabToFirestore();
            alert(`‚úÖ ${rows.length}Í∞úÏùò ÌñâÏù¥ Î∂ôÏó¨ÎÑ£Í∏∞ ÎêòÏóàÏäµÎãàÎã§!`);
        }

        // Ìñâ Ï∂îÍ∞Ä Ìï®Ïàò
    function addTableRow(tableType) {
        const tbody = document.getElementById(`${tableType}-tbody`);
        if (!tbody) {
            console.error(`ÌÖåÏù¥Î∏îÏùò tbody ('${tableType}-tbody')Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.`);
            return;
        }
        
        const templates = {
            managers: `
                <tr class="data-row">
                    <td><input type="text" class="data-input" placeholder="ÏõêÎ∞îÏΩîÎìú ÏûÖÎ†•"></td>
                    <td><input type="text" class="data-input" placeholder="ÎãâÎÑ§ÏûÑ ÏûÖÎ†•"></td>
                    <td><input type="text" class="data-input" placeholder="Ïù¥Î¶Ñ ÏûÖÎ†•"></td>
                    <td><button class="delete-row-btn">üóëÔ∏è</button></td>
                </tr>
            `,
            tc: `
                <tr class="data-row">
                    <td><input type="text" class="data-input" placeholder="ÏõêÎ∞îÏΩîÎìú ÏûÖÎ†•"></td>
                    <td><input type="text" class="data-input" placeholder="ÎãâÎÑ§ÏûÑ ÏûÖÎ†•"></td>
                    <td><input type="text" class="data-input" placeholder="Ïù¥Î¶Ñ ÏûÖÎ†•"></td>
                    <td><button class="delete-row-btn">üóëÔ∏è</button></td>
                </tr>
            `,
            ps: `
                <tr class="data-row">
                    <td><input type="text" class="data-input" placeholder="ÏõêÎ∞îÏΩîÎìú ÏûÖÎ†•"></td>
                    <td>
                        <select class="data-select">
                            <option value="">ÏÑ†ÌÉù</option><option value="A">AÏ°∞</option><option value="B">BÏ°∞</option><option value="C">CÏ°∞</option><option value="D">DÏ°∞</option><option value="E">EÏ°∞</option><option value="F">FÏ°∞</option><option value="G">GÏ°∞</option>
                        </select>
                    </td>
                    <td><input type="text" class="data-input" placeholder="Ïù¥Î¶Ñ ÏûÖÎ†•"></td>
                    <td><button class="delete-row-btn">üóëÔ∏è</button></td>
                </tr>
            `,
            permanent: `
                <tr class="data-row">
                    <td><input type="text" class="data-input" placeholder="ÏõêÎ∞îÏΩîÎìú"></td>
                    <td>
                        <select class="data-select">
                            <option value="">ÏÑ†ÌÉù</option><option value="A">AÏ°∞</option><option value="B">BÏ°∞</option><option value="C">CÏ°∞</option><option value="D">DÏ°∞</option><option value="E">EÏ°∞</option><option value="F">FÏ°∞</option><option value="G">GÏ°∞</option>
                        </select>
                    </td>
                    <td><input type="text" class="data-input" placeholder="Ïù¥Î¶Ñ"></td>
                    <td><input type="checkbox" class="skill-checkbox"></td><td><input type="checkbox" class="skill-checkbox"></td><td><input type="checkbox" class="skill-checkbox"></td><td><input type="checkbox" class="skill-checkbox"></td><td><input type="checkbox" class="skill-checkbox"></td><td><input type="checkbox" class="skill-checkbox"></td><td><input type="checkbox" class="skill-checkbox"></td>
                    <td><button class="delete-row-btn">üóëÔ∏è</button></td>
                </tr>
            `,
            temporary: `
                <tr class="data-row">
                    <td><input type="text" class="data-input" placeholder="ÏõêÎ∞îÏΩîÎìú"></td>
                    <td><input type="text" class="data-input" placeholder="Ïù¥Î¶Ñ"></td>
                    <td><input type="checkbox" class="skill-checkbox"></td><td><input type="checkbox" class="skill-checkbox"></td><td><input type="checkbox" class="skill-checkbox"></td><td><input type="checkbox" class="skill-checkbox"></td><td><input type="checkbox" class="skill-checkbox"></td><td><input type="checkbox" class="skill-checkbox"></td><td><input type="checkbox" class="skill-checkbox"></td>
                    <td><button class="delete-row-btn">üóëÔ∏è</button></td>
                </tr>
            `,
            newbie: `
                <tr class="data-row">
                    <td><input type="text" class="data-input" placeholder="ÏõêÎ∞îÏΩîÎìú ÏûÖÎ†•"></td>
                    <td><input type="text" class="data-input" placeholder="Ïù¥Î¶Ñ ÏûÖÎ†•"></td>
                    <td><button class="delete-row-btn">üóëÔ∏è</button></td>
                </tr>
            `,
            cd: `
                <tr class="data-row">
                    <td><input type="text" class="data-input" placeholder="ÏõêÎ∞îÏΩîÎìú ÏûÖÎ†•"></td>
                    <td>
                        <select class="data-select">
                            <option value="">ÏÑ†ÌÉù</option><option value="OB">OB</option><option value="IB">IB</option><option value="ICQA">ICQA</option><option value="HUB">HUB</option><option value="CFC">CFC</option>
                        </select>
                    </td>
                    <td><input type="text" class="data-input" placeholder="Ïù¥Î¶Ñ ÏûÖÎ†•"></td>
                    <td><button class="delete-row-btn">üóëÔ∏è</button></td>
                </tr>
            `
        };

        // ‚òÖ‚òÖ‚òÖ Ïó¨Í∏∞Í∞Ä ÏàòÏ†ïÎêú Î∂ÄÎ∂Ñ ‚òÖ‚òÖ‚òÖ
        // Ïù¥Ï†ÑÏóê Î¨∏Ï†úÍ∞Ä ÏûàÎçò Î∞©Ïãù ÎåÄÏã†, HTML Î¨∏ÏûêÏó¥ÏùÑ ÏßÅÏ†ë ÏïàÏ†ÑÌïòÍ≤å ÏÇΩÏûÖÌïòÎäî Î∞©ÏãùÏúºÎ°ú Î≥ÄÍ≤Ω
        tbody.insertAdjacentHTML('beforeend', templates[tableType]);
        const newRow = tbody.lastElementChild; // Î∞©Í∏à Ï∂îÍ∞ÄÎêú ÎßàÏßÄÎßâ ÌñâÏùÑ Ï†ïÌôïÌûà Í≤ÄÏÉâ

        // ÏÉàÎ°ú Ï∂îÍ∞ÄÎêú ÌñâÏùò Î™®Îì† ÏûÖÎ†• ÏöîÏÜåÏóê Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑàÎ•º Ïû¨ÏÑ§Ï†ï
        newRow.querySelectorAll('.data-input, .data-select, .skill-checkbox').forEach(input => {
            input.addEventListener('change', saveDataTabToFirestore);
            input.addEventListener('input', saveDataTabToFirestore);
        });

        saveDataTabToFirestore();
    }

        // DATA ÌÉ≠ Ï†ÄÏû•
        function saveDataTabToFirestore() {
            const tables = ['managers', 'tc', 'ps', 'permanent', 'temporary', 'newbie', 'cd'];
            const dataToSave = {};

            tables.forEach(tableType => {
                const tbody = document.getElementById(`${tableType}-tbody`);
                if (!tbody) return;

                const rows = [];
                tbody.querySelectorAll('tr').forEach(row => {
                    const inputs = row.querySelectorAll('.data-input');
                    const selects = row.querySelectorAll('.data-select');
                    const checkboxes = row.querySelectorAll('.skill-checkbox');

                    const rowData = {
                        inputs: Array.from(inputs).map(input => input.value),
                        selects: Array.from(selects).map(select => select.value),
                        checkboxes: Array.from(checkboxes).map(checkbox => checkbox.checked)
                    };

                    rows.push(rowData);
                });

                dataToSave[tableType] = rows;
            });

            const dataDocRef = doc(db, "employeeData", "current");
            setDoc(dataDocRef, dataToSave, { merge: true });
        }

        // DATA ÌÉ≠ Î∂àÎü¨Ïò§Í∏∞
        function loadDataTabFromFirestore() {
            const dataDocRef = doc(db, "employeeData", "current");
            onSnapshot(dataDocRef, (doc) => {
                if (doc.exists()) {
                    const data = doc.data();
                    restoreDataTab(data);
                }
            });
        }
									
		// DATA ÌÉ≠ Î≥µÏõê
        function restoreDataTab(data) {
            const tables = ['managers', 'tc', 'ps', 'permanent', 'temporary', 'newbie', 'cd'];

            tables.forEach(tableType => {
                const tbody = document.getElementById(`${tableType}-tbody`);
                if (!tbody || !data[tableType]) return;

                tbody.innerHTML = '';

                data[tableType].forEach(rowData => {
                    const row = document.createElement('tr');
                    row.className = 'data-row';

                    let cellsHTML = '';
                    let inputIndex = 0;
                    let selectIndex = 0;
                    let checkboxIndex = 0;

                    // Í∞Å ÌÖåÏù¥Î∏î ÌÉÄÏûÖÎ≥ÑÎ°ú Ï†ÅÏ†àÌïú Íµ¨Ï°∞ ÏÉùÏÑ±
                    const structures = {
                        managers: ['input', 'input', 'input', 'delete'],
                        tc: ['input', 'input', 'input', 'delete'],
                        ps: ['input', 'select', 'input', 'delete'],
                        permanent: ['input', 'select', 'input', 'checkbox', 'checkbox', 'checkbox', 'checkbox', 'checkbox', 'checkbox', 'checkbox', 'delete'],
                        temporary: ['input', 'input', 'checkbox', 'checkbox', 'checkbox', 'checkbox', 'checkbox', 'checkbox', 'checkbox', 'delete'],
                        newbie: ['input', 'input', 'delete'],
                        cd: ['input', 'select', 'input', 'delete']
                    };

                    structures[tableType].forEach(type => {
                        if (type === 'input') {
                            const value = rowData.inputs[inputIndex++] || '';
                            cellsHTML += `<td><input type="text" class="data-input" value="${value}"></td>`;
                        } else if (type === 'select') {
                            const value = rowData.selects[selectIndex++] || '';
                            let options = '';
                            
                            if (tableType === 'ps' || tableType === 'permanent') {
                                options = `
                                    <option value="">ÏÑ†ÌÉù</option>
                                    <option value="A" ${value === 'A' ? 'selected' : ''}>AÏ°∞</option>
                                    <option value="B" ${value === 'B' ? 'selected' : ''}>BÏ°∞</option>
                                    <option value="C" ${value === 'C' ? 'selected' : ''}>CÏ°∞</option>
                                    <option value="D" ${value === 'D' ? 'selected' : ''}>DÏ°∞</option>
                                    <option value="E" ${value === 'E' ? 'selected' : ''}>EÏ°∞</option>
                                    <option value="F" ${value === 'F' ? 'selected' : ''}>FÏ°∞</option>
                                    <option value="G" ${value === 'G' ? 'selected' : ''}>GÏ°∞</option>
                                `;
                            } else if (tableType === 'cd') {
                                options = `
                                    <option value="">ÏÑ†ÌÉù</option>
                                    <option value="OB" ${value === 'OB' ? 'selected' : ''}>OB</option>
                                    <option value="IB" ${value === 'IB' ? 'selected' : ''}>IB</option>
                                    <option value="ICQA" ${value === 'ICQA' ? 'selected' : ''}>ICQA</option>
                                    <option value="HUB" ${value === 'HUB' ? 'selected' : ''}>HUB</option>
                                    <option value="CFC" ${value === 'CFC' ? 'selected' : ''}>CFC</option>
                                `;
                            }
                            
                            cellsHTML += `<td><select class="data-select">${options}</select></td>`;
                        } else if (type === 'checkbox') {
                            const checked = rowData.checkboxes[checkboxIndex++] ? 'checked' : '';
                            cellsHTML += `<td><input type="checkbox" class="skill-checkbox" ${checked}></td>`;
                        } else if (type === 'delete') {
                            cellsHTML += `<td><button class="delete-row-btn">üóëÔ∏è</button></td>`;
                        }
                    });

                    row.innerHTML = cellsHTML;
                    tbody.appendChild(row);

                    // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
                    row.querySelectorAll('.data-input, .data-select, .skill-checkbox').forEach(input => {
                        input.addEventListener('change', saveDataTabToFirestore);
                        input.addEventListener('input', saveDataTabToFirestore);
                    });
                });
            });
        }
		
		// FLOW ÌÉ≠ Ï¥àÍ∏∞Ìôî
        function initializeFlowTab() {
            // ÏõêÎ∞îÏΩîÎìú ÏûÖÎ†• Ïãú ÏûêÎèô ÏôÑÏÑ±
            document.querySelectorAll('.flow-barcode-input').forEach(input => {
                input.addEventListener('input', handleFlowBarcodeInput);
                input.addEventListener('change', saveFlowDataToFirestore);
            });

            // Role/ÎπÑÍ≥† ÏûÖÎ†• Ïãú Ï†ÄÏû•
            document.querySelectorAll('.flow-role-input, .flow-remark-input').forEach(input => {
                input.addEventListener('input', saveFlowDataToFirestore);
                
                if (input.classList.contains('flow-role-input')) {
                    input.addEventListener('input', () => {
                        const section = input.dataset.section;
                        if (section === 'tc') {
                            setTimeout(() => syncFlowToHome(), 100);
                        }
                    });
                }
            });

            // Ï†ÑÏ≤¥ Ï¥àÍ∏∞Ìôî Î≤ÑÌäº
            document.getElementById('clear-flow-btn')?.addEventListener('click', () => {
                if (!confirm('‚ö†Ô∏è FLOW ÌÉ≠Ïùò Î™®Îì† Îç∞Ïù¥ÌÑ∞Î•º Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÏù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§!')) {
                    return;
                }
                
                // Î™®Îì† ÏûÖÎ†•Ïπ∏ Ï¥àÍ∏∞Ìôî
                document.querySelectorAll('.flow-barcode-input, .flow-role-input, .flow-remark-input').forEach(input => {
                    input.value = '';
                });
                
                // Î™®Îì† Ïù¥Î¶Ñ/ÎãâÎÑ§ÏûÑ/ÌåÄ Ï¥àÍ∏∞Ìôî
                document.querySelectorAll('.flow-name, .flow-nick, .flow-team').forEach(cell => {
                    cell.textContent = '-';
                });
                
                // Ïπ¥Ïö¥Ìä∏ Ï¥àÍ∏∞Ìôî
                updateFlowCount();
                
                // FirestoreÏóê Îπà Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
                const emptyFlowData = {
                    tc: Array(20).fill({ barcode: '', role: '', remark: '' }),
                    ps: Array(20).fill({ barcode: '', role: '', remark: '' }),
                    leave: Array(20).fill({ barcode: '', remark: '' }),
                    newbie: Array(35).fill({ barcode: '', remark: '' })
                };
                
                const flowDocRef = doc(db, "flowData", "current");
                setDoc(flowDocRef, emptyFlowData);
                
                // Î≥ÄÍ≤Ω Î°úÍ∑∏ Í∏∞Î°ù
                if (currentUser) {
                    const logRef = doc(collection(db, "activityLogs"));
                    setDoc(logRef, {
                        user: currentUser.displayName,
                        timestamp: new Date().getTime(),
                        changes: [{
                            field: 'FLOW Ï†ÑÏ≤¥ Ï¥àÍ∏∞Ìôî',
                            oldValue: 'Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞',
                            newValue: 'Ï¥àÍ∏∞ÌôîÎê®'
                        }]
                    });
                }
                
                alert('‚úÖ FLOW ÌÉ≠Ïù¥ Ï†ÑÏ≤¥ Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§.');
            });

            // FirestoreÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞
            loadFlowDataFromFirestore();
        }

        // ÏõêÎ∞îÏΩîÎìúÎ°ú ÏÇ¨Ïõê Ï†ïÎ≥¥ Ï∞æÍ∏∞
        function findEmployeeByBarcode(barcode) {
            const dataDocRef = doc(db, "employeeData", "current");
            
            return new Promise((resolve) => {
                onSnapshot(dataDocRef, (docSnap) => {
                    if (!docSnap.exists()) {
                        resolve(null);
                        return;
                    }

                    const data = docSnap.data();
                    
                    // Îß§ÎãàÏ†Ä (M/G) - ÏõêÎ∞îÏΩîÎìú, ÎãâÎÑ§ÏûÑ, Ïù¥Î¶Ñ
                    if (data.managers) {
                        for (const row of data.managers) {
                            if (row.inputs?.[0] === barcode) {
                                return resolve({
                                    name: row.inputs[2] || '-',      // Ïù¥Î¶Ñ
                                    nickname: row.inputs[1] || '-',  // ÎãâÎÑ§ÏûÑ
                                    team: '-',
                                    type: 'managers'
                                });
                            }
                        }
                    }

                    // ÌòÑÏû•Í¥ÄÎ¶¨Ïûê (T/C) - ÏõêÎ∞îÏΩîÎìú, ÎãâÎÑ§ÏûÑ, Ïù¥Î¶Ñ
                    if (data.tc) {
                        for (const row of data.tc) {
                            if (row.inputs?.[0] === barcode) {
                                return resolve({
                                    name: row.inputs[2] || '-',      // Ïù¥Î¶Ñ
                                    nickname: row.inputs[1] || '-',  // ÎãâÎÑ§ÏûÑ
                                    team: '-',
                                    type: 'tc'
                                });
                            }
                        }
                    }

                    // PS ÏÇ¨Ïõê - ÏõêÎ∞îÏΩîÎìú, Ï°∞, Ïù¥Î¶Ñ
                    if (data.ps) {
                        for (const row of data.ps) {
                            if (row.inputs?.[0] === barcode) {
                                return resolve({
                                    name: row.inputs[1] || '-',      // Ïù¥Î¶Ñ
                                    nickname: '-',                    // ÎãâÎÑ§ÏûÑ ÏóÜÏùå
                                    team: row.selects?.[0] || '-',   // Ï°∞
                                    type: 'ps'
                                });
                            }
                        }
                    }

                    // Í≥ÑÏïΩÏßÅ ÏÇ¨Ïõê - ÏõêÎ∞îÏΩîÎìú, Ï°∞, Ïù¥Î¶Ñ
                    if (data.permanent) {
                        for (const row of data.permanent) {
                            if (row.inputs?.[0] === barcode) {
                                return resolve({
                                    name: row.inputs[1] || '-',      // Ïù¥Î¶Ñ
                                    nickname: '-',                    // ÎãâÎÑ§ÏûÑ ÏóÜÏùå
                                    team: row.selects?.[0] || '-',   // Ï°∞
                                    type: 'permanent'
                                });
                            }
                        }
                    }

                    // Îã®Í∏∞ÏßÅ ÏÇ¨Ïõê - ÏõêÎ∞îÏΩîÎìú, Ïù¥Î¶Ñ
                    if (data.temporary) {
                        for (const row of data.temporary) {
                            if (row.inputs?.[0] === barcode) {
                                return resolve({
                                    name: row.inputs[1] || '-',      // Ïù¥Î¶Ñ
                                    nickname: '-',                    // ÎãâÎÑ§ÏûÑ ÏóÜÏùå
                                    team: '-',
                                    type: 'temporary'
                                });
                            }
                        }
                    }

                    // Ïã†Í∑úÎã®Í∏∞ ÏÇ¨Ïõê - ÏõêÎ∞îÏΩîÎìú, Ïù¥Î¶Ñ
                    if (data.newbie) {
                        for (const row of data.newbie) {
                            if (row.inputs?.[0] === barcode) {
                                return resolve({
                                    name: row.inputs[1] || '-',      // Ïù¥Î¶Ñ
                                    nickname: '-',                    // ÎãâÎÑ§ÏûÑ ÏóÜÏùå
                                    team: '-',
                                    type: 'newbie'
                                });
                            }
                        }
                    }

                    // CD ÏÇ¨Ïõê - ÏõêÎ∞îÏΩîÎìú, Í≥µÏ†ï, Ïù¥Î¶Ñ
                    if (data.cd) {
                        for (const row of data.cd) {
                            if (row.inputs?.[0] === barcode) {
                                return resolve({
                                    name: row.inputs[1] || '-',      // Ïù¥Î¶Ñ
                                    nickname: '-',                    // ÎãâÎÑ§ÏûÑ ÏóÜÏùå
                                    team: row.selects?.[0] || '-',   // Í≥µÏ†ï
                                    type: 'cd'
                                });
                            }
                        }
                    }
                    
                    resolve(null);
                }, { once: true });
            });
        }

        // ÏõêÎ∞îÏΩîÎìú ÏûÖÎ†• Ï≤òÎ¶¨
        async function handleFlowBarcodeInput(e) {
            const input = e.target;
            const barcode = input.value.trim();
            const section = input.dataset.section;
            const index = input.dataset.index;

            if (!barcode) {
                // ÎπÑÏö∞Î©¥ Ïù¥Î¶ÑÎèÑ Ï¥àÍ∏∞Ìôî
                const nameCell = document.querySelector(`.flow-name[data-section="${section}"][data-index="${index}"]`);
                const nickCell = document.querySelector(`.flow-nick[data-section="${section}"][data-index="${index}"]`);
                const teamCell = document.querySelector(`.flow-team[data-section="${section}"][data-index="${index}"]`);
                
                if (nameCell) nameCell.textContent = '-';
                if (nickCell) nickCell.textContent = '-';
                if (teamCell) teamCell.textContent = '-';
                
                updateFlowCount();
                return;
            }

            // ÏÇ¨Ïõê Ï†ïÎ≥¥ Ï°∞Ìöå
            const employee = await findEmployeeByBarcode(barcode);

            const nameCell = document.querySelector(`.flow-name[data-section="${section}"][data-index="${index}"]`);
            const nickCell = document.querySelector(`.flow-nick[data-section="${section}"][data-index="${index}"]`);
            const teamCell = document.querySelector(`.flow-team[data-section="${section}"][data-index="${index}"]`);

            if (employee) {
                if (nameCell) nameCell.textContent = employee.name;
                if (nickCell) nickCell.textContent = employee.nickname;
                if (teamCell) teamCell.textContent = employee.team;
            } else {
                if (nameCell) nameCell.textContent = '‚ö†Ô∏è ÎØ∏Îì±Î°ù';
                if (nickCell) nickCell.textContent = '-';
                if (teamCell) teamCell.textContent = '-';
            }

            updateFlowCount();
		
		// Team CaptainÏù¥Î©¥ HOME ÌÉ≠Ïóê ÏûêÎèô ÎèôÍ∏∞Ìôî
            if (section === 'tc') {
                setTimeout(() => syncFlowToHome(), 100);
            }
        }

        // Ïù∏Ïõê Ïπ¥Ïö¥Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
        function updateFlowCount() {
            const sections = ['tc', 'ps', 'leave', 'newbie'];
            
            sections.forEach(section => {
                const inputs = document.querySelectorAll(`.flow-barcode-input[data-section="${section}"]`);
                let count = 0;
                
                inputs.forEach(input => {
                    if (input.value.trim()) count++;
                });
                
                const countElement = document.getElementById(`${section}-count`);
                if (countElement) {
                    countElement.textContent = `${count}Î™Ö`;
                }
            });
            
            // Ï¥ù Ïù∏Ïõê ÏóÖÎç∞Ïù¥Ìä∏ ÏΩîÎìú ÏÇ≠Ï†ú (ÏïÑÎûò 3Ï§Ñ Ï†úÍ±∞)
            // const totalElement = document.getElementById('total-flow-count');
            // if (totalElement) {
            //     totalElement.textContent = `${totalCount}Î™Ö`;
            // }
        }

        // FLOW Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
        function saveFlowDataToFirestore() {
            const flowData = {
                tc: [],
                ps: [],
                leave: [],
                newbie: []
            };

            // Í∞Å ÏÑπÏÖò Îç∞Ïù¥ÌÑ∞ ÏàòÏßë
            ['tc', 'ps', 'leave', 'newbie'].forEach(section => {
                const rows = document.querySelectorAll(`.flow-barcode-input[data-section="${section}"]`);
                
                rows.forEach((input, index) => {
                    const barcode = input.value.trim();
                    const roleInput = document.querySelector(`.flow-role-input[data-section="${section}"][data-index="${index}"]`);
                    const remarkInput = document.querySelector(`.flow-remark-input[data-section="${section}"][data-index="${index}"]`);
                    
                    flowData[section].push({
                        barcode: barcode,
                        role: roleInput?.value.trim() || '',
                        remark: remarkInput?.value.trim() || ''
                    });
                });
            });

            const flowDocRef = doc(db, "flowData", "current");
            setDoc(flowDocRef, flowData, { merge: true });
        }

        // FLOW Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞
        function loadFlowDataFromFirestore() {
            const flowDocRef = doc(db, "flowData", "current");
            
            onSnapshot(flowDocRef, (docSnap) => {
                if (!docSnap.exists()) return;
                
                const data = docSnap.data();
                
                ['tc', 'ps', 'leave', 'newbie'].forEach(section => {
                    if (!data[section]) return;
                    
                    data[section].forEach((item, index) => {
                        const barcodeInput = document.querySelector(`.flow-barcode-input[data-section="${section}"][data-index="${index}"]`);
                        const roleInput = document.querySelector(`.flow-role-input[data-section="${section}"][data-index="${index}"]`);
                        const remarkInput = document.querySelector(`.flow-remark-input[data-section="${section}"][data-index="${index}"]`);
                        
                        if (barcodeInput) {
                            barcodeInput.value = item.barcode || '';
                            // ÏõêÎ∞îÏΩîÎìúÍ∞Ä ÏûàÏúºÎ©¥ ÏûêÎèôÏúºÎ°ú Ïù¥Î¶Ñ Ï±ÑÏö∞Í∏∞
                            if (item.barcode) {
                                handleFlowBarcodeInput({ target: barcodeInput });
                            }
                        }
                        if (roleInput) roleInput.value = item.role || '';
                        if (remarkInput) remarkInput.value = item.remark || '';
                    });
                });
                
                updateFlowCount();
            });
        }
		
		async function syncFlowToHome() {
            const flowDocRef = doc(db, "flowData", "current");
            const dataDocRef = doc(db, "employeeData", "current");
            
            try {
                const flowSnap = await getDoc(flowDocRef);
                const employeeSnap = await getDoc(dataDocRef);
                
                if (!flowSnap.exists() || !employeeSnap.exists()) return;
                
                const flowData = flowSnap.data();
                const employeeData = employeeSnap.data();
                
                if (!flowData.tc) return;
                
                // Î™®Îì† T/C ÏûÖÎ†•Ïπ∏ Ï¥àÍ∏∞Ìôî
                for (let i = 0; i < 21; i++) {
                    const input = document.getElementById(`tc-report-${i}`);
                    if (input) input.value = '';
                }
                
                let reportIndex = 0;
                
                flowData.tc.forEach((item) => {
                    if (!item.barcode) return;
                    
                    let nickname = '-';
                    
                    if (employeeData.managers) {
                        for (const row of employeeData.managers) {
                            if (row.inputs?.[0] === item.barcode) {
                                nickname = row.inputs[1] || '-';
                                break;
                            }
                        }
                    }
                    
                    if (nickname === '-' && employeeData.tc) {
                        for (const row of employeeData.tc) {
                            if (row.inputs?.[0] === item.barcode) {
                                nickname = row.inputs[1] || '-';
                                break;
                            }
                        }
                    }
                    
                    if (nickname !== '-') {
                        const reportInput = document.getElementById(`tc-report-${reportIndex}`);
                        if (reportInput) {
                            reportInput.value = nickname;
                        }
                        reportIndex++;
                    }
                });
                
                // DOM ÏóÖÎç∞Ïù¥Ìä∏ ÌõÑ Total Í≥ÑÏÇ∞
                setTimeout(() => {
                    updateReportTotal();
                    saveDataToFirestore();
                }, 100);
                
            } catch (error) {
                console.error('ÎèôÍ∏∞Ìôî Ïò§Î•ò:', error);
            }
        }
    </script>
	
	<!-- Î°úÍ∑∏Ïù∏ -->
	<div class="login-modal" id="loginModal">
        <div class="login-box">
            <h2 class="login-title">üöÄ PDAÏùºÏßÄ Î°úÍ∑∏Ïù∏</h2>
            <p class="login-subtitle">GWJ2 OB Ïù∏Ïõê Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</p>
            <input type="text" id="loginEmail" class="login-input" placeholder="ÏïÑÏù¥Îîî">
            <input type="password" id="loginPassword" class="login-input" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏">
            <div id="loginError" class="error-message" style="display: none;"></div>
            <button id="loginBtn" class="login-btn">Î°úÍ∑∏Ïù∏</button>
            <button id="registerBtn" class="login-btn" style="background: linear-gradient(135deg, #38bdf8, #3b82f6); margin-top: 12px;">ÌöåÏõêÍ∞ÄÏûÖ</button>
        </div>
    </div>

    <!-- Î≥ÄÍ≤Ω Î°úÍ∑∏ Ìå®ÎÑê -->
    <div class="activity-log-panel" id="activityLogPanel">
        <div class="activity-log-header">
            <div class="activity-log-title">üìã Î≥ÄÍ≤Ω ÎÇ¥Ïó≠</div>
            <button class="close-log-btn" id="closeLogBtn">√ó</button>
        </div>
        <div class="activity-log-content" id="activityLogContent">
            <div class="log-empty">ÏïÑÏßÅ Î≥ÄÍ≤Ω ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.</div>
        </div>
    </div>
</body>
</html>