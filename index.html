<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GWJ2 OB 인원 관리 시트</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700;800&display=swap');

        /* 색상 변수 - 깔끔한 팔레트 */
        :root[color-theme='light'] {
            --bg-primary: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            --surface-primary: rgba(255, 255, 255, 0.8);
            --surface-secondary: rgba(255, 255, 255, 0.6);
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --accent: #3b82f6;
            --accent-hover: #2563eb;
            --border: rgba(148, 163, 184, 0.2);
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        :root[color-theme='dark'] {
            --bg-primary: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            --surface-primary: rgba(30, 41, 59, 0.8);
            --surface-secondary: rgba(30, 41, 59, 0.6);
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --accent: #60a5fa;
            --accent-hover: #3b82f6;
            --border: rgba(148, 163, 184, 0.1);
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.2), 0 1px 2px rgba(0, 0, 0, 0.12);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            font-size: 14px;
            line-height: 1.5;
            transition: all 0.3s ease;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* 고정 헤더 */
        .fixed-header {
            position: fixed;
            top: 16px;
            left: 16px;
            right: 16px;
            background: var(--surface-primary);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--border);
            border-radius: 16px;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .fixed-header:hover {
            transform: translateY(-1px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        /* 헤더 상단 */
        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
        }

        .header-title {
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
            letter-spacing: -0.025em;
            position: relative;
            overflow: visible;
        }

        .title-text {
            position: relative;
            background: linear-gradient(45deg, #667eea, #764ba2, #f093fb, #f5576c, #4facfe, #00f2fe);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: smooth-gradient-flow 8s ease-in-out infinite, subtle-glow 4s ease-in-out infinite;
            filter: brightness(1.1);
        }

        .title-text::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(
                circle at center,
                rgba(255, 255, 255, 0.15) 0%,
                rgba(255, 255, 255, 0.08) 30%,
                transparent 70%
            );
            opacity: 0;
            animation: ethereal-glow 8s ease-in-out infinite;
            pointer-events: none;
        }
        
        .date-display {
            display: inline-flex; 
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 600;
            color: #ffffff;
            background-color: #ef4444; 
            border: 1px solid #dc2626; 
            border-radius: 12px;
            padding: 6px 10px;
            margin-left: 12px;
            vertical-align: middle;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
            animation: fadeIn 0.8s ease-out forwards;
            white-space: nowrap;
            letter-spacing: -0.01em;
        }

        .capture-btn {
            background: var(--surface-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 16px;
            line-height: 1;
            transition: all 0.2s ease;
        }
        .capture-btn:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        @keyframes subtle-glow {
            0%, 100% { 
                filter: brightness(1.1) drop-shadow(0 0 8px rgba(102, 126, 234, 0.2));
            }
            50% { 
                filter: brightness(1.2) drop-shadow(0 0 12px rgba(102, 126, 234, 0.3));
            }
        }

        @keyframes ethereal-glow {
            0%, 80% { 
                opacity: 0;
                transform: scale(0.8);
            }
            85% { 
                opacity: 0.6;
                transform: scale(1.1);
            }
            95% { 
                opacity: 0.3;
                transform: scale(1.3);
            }
            100% { 
                opacity: 0;
                transform: scale(1.5);
            }
        }

        .rocket {
            font-size: 24px;
            animation: rocket-thruster 2s ease-in-out infinite;
            filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.6));
        }

        @keyframes smooth-gradient-flow {
            0%, 100% { 
                background-position: 0% 50%;
                filter: brightness(1);
            }
            25% { 
                background-position: 100% 50%;
                filter: brightness(1.1);
            }
            50% { 
                background-position: 50% 100%;
                filter: brightness(1.05);
            }
            75% { 
                background-position: 100% 0%;
                filter: brightness(1.1);
            }
        }

        @keyframes rocket-thruster {
            0%, 100% { 
                transform: translateY(0px) rotate(-5deg);
                filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.6));
            }
            25% { 
                transform: translateY(-1px) rotate(0deg);
                filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.7));
            }
            75% { 
                transform: translateY(-0.5px) rotate(2deg);
                filter: drop-shadow(0 0 6px rgba(255, 215, 0, 0.5));
            }
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        /* 시계 스타일 */
        .clock-display {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: var(--surface-primary);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid var(--border);
            border-radius: 16px;
            box-shadow: var(--shadow);
            transition: all 0.2s ease;
        }

        .clock-display:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .clock-emoji {
            font-size: 18px;
            opacity: 0.8;
            margin-right: 4px;
        }

        .time-segment {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .time-unit {
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .digit-box {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 32px;
            background: var(--surface-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-family: 'Noto Sans KR', monospace;
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
        }

        .time-separator {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-secondary);
            margin: 0 2px;
            animation: blink 2s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        /* 마감 임박 효과 */
        .clock-urgent .digit-box {
            background: rgba(239, 68, 68, 0.1) !important;
            border-color: #ef4444 !important;
            color: #ef4444 !important;
        }

        .clock-urgent .time-separator {
            color: #ef4444 !important;
        }

        @keyframes urgent-pulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: var(--shadow), 0 0 0 0 rgba(239, 68, 68, 0.4);
            }
            50% { 
                transform: scale(1.02);
                box-shadow: var(--shadow), 0 0 0 4px rgba(239, 68, 68, 0.1);
            }
        }

        .clock-urgent {
            animation: urgent-pulse 1.5s ease-in-out infinite;
        }

        /* 다크/라이트 모드 토글 */
        .dark-light-toggle {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            width: 48px;
            height: 48px;
            background: var(--surface-secondary);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            overflow: hidden;
        }

        .dark-light-toggle:hover {
            transform: translateY(-1px);
            background: var(--surface-primary);
            border-color: var(--border);
        }

        .icon30 {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 24px;
            height: 24px;
            position: absolute;
        }

        .icon30 > svg {
            transition: all 0.3s ease;
        }

        .sun {
            animation: rise-animation 0.6s ease-out forwards;
            transform-origin: center;
        }

        .moon {
            animation: set-animation 0.6s ease-out forwards;
            transform-origin: center;
        }

        [color-theme='dark'] .dark-light-toggle .sun {
            animation: set-animation 0.6s ease-out forwards;
        }

        [color-theme='dark'] .dark-light-toggle .moon {
            animation: rise-animation 0.6s ease-out forwards;
        }

        .dark-light-toggle:hover svg {
            fill: #f59e0b;
            transform: scale(1.1);
        }

        @keyframes rise-animation {
            from { 
                transform: rotate(-90deg) scale(0.8);
                opacity: 0;
            }
            to { 
                transform: rotate(0deg) scale(1);
                opacity: 1;
            }
        }

        @keyframes set-animation {
            from { 
                transform: rotate(0deg) scale(1);
                opacity: 1;
            }
            to { 
                transform: rotate(90deg) scale(0.8);
                opacity: 0;
            }
        }

        /* 탭 네비게이션 - 가로 일렬 */
        .tab-navigation {
            padding: 16px 24px;
            background: transparent;
            border-bottom-left-radius: 16px;
            border-bottom-right-radius: 16px;
        }

        .tab-list {
            display: flex;
            align-items: center;
            gap: 32px;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
            padding: 4px 0;
        }

        .tab-list::-webkit-scrollbar {
            display: none;
        }

        .tab-item {
            position: relative;
            padding: 12px 4px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            user-select: none;
            flex-shrink: 0;
        }

        .tab-item::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--accent);
            transform: scaleX(0);
            transition: transform 0.3s ease;
            border-radius: 1px;
        }

        .tab-item:hover {
            color: var(--text-primary);
        }

        .tab-item.active {
            color: var(--accent);
            font-weight: 600;
        }

        .tab-item.active::after {
            transform: scaleX(1);
        }
		
		/* 로그인 모달 */
        .login-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .login-modal.active {
            display: flex;
        }

        .login-box {
            background: var(--surface-primary);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 40px;
            max-width: 400px;
            width: 90%;
            box-shadow: var(--shadow-lg);
            animation: fadeInUp 0.3s ease-out;
        }

        .login-title {
            font-size: 28px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 8px;
            text-align: center;
        }

        .login-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 32px;
            text-align: center;
        }

        .login-input {
            width: 100%;
            padding: 12px 16px;
            margin-bottom: 16px;
            background: var(--surface-secondary);
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 15px;
            color: var(--text-primary);
            transition: all 0.2s ease;
        }

        .login-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .login-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 8px;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
        }

        .login-btn:active {
            transform: translateY(0);
        }

        .user-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            background: var(--surface-primary);
            border: 1px solid var(--border);
            border-radius: 16px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .user-badge:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .user-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: 700;
        }

        .error-message {
            color: #ef4444;
            font-size: 13px;
            margin-top: -8px;
            margin-bottom: 16px;
            text-align: center;
        }
		
		/* 관리자 패널 */
        .admin-panel {
            margin-top: 24px;
            padding: 24px;
            background: var(--surface-secondary);
            border: 2px solid var(--accent);
            border-radius: 16px;
        }

        .admin-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-list {
            margin-bottom: 20px;
        }

        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--surface-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .delete-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .delete-btn:hover {
            background: #dc2626;
        }

        .add-user-form {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        .admin-input {
            flex: 1;
            padding: 10px 14px;
            background: var(--surface-primary);
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            color: var(--text-primary);
        }

        .admin-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .add-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .add-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        /* 메인 콘텐츠 */
        .main-content {
            margin-top: 140px;
            padding: 24px;
            min-height: calc(100vh - 140px);
        }

        .content-area {
            background: var(--surface-primary);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 32px;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease;
        }

        .content-area:hover {
            transform: translateY(-2px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
        }

        .welcome-message {
            text-align: center;
            color: var(--text-secondary);
            font-size: 16px;
            font-weight: 500;
            margin-top: 40px;
            line-height: 1.6;
            letter-spacing: -0.025em;
        }

        .welcome-message strong {
            color: var(--text-primary);
            font-weight: 600;
        }
		
		/* 메인 화면 애니메이션 */
        @keyframes fadeInUp {
            from { 
                opacity: 0; 
                transform: translateY(30px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }
        
        @keyframes rocketPulse {
            0%, 100% { 
                transform: scale(1) rotate(-5deg);
            }
            50% { 
                transform: scale(1.15) rotate(0deg);
            }
        }
        
        @keyframes gradientFlow {
            0%, 100% { 
                background-position: 0% 50%;
            }
            50% { 
                background-position: 100% 50%;
            }
        }
        
        .welcome-title {
            animation: fadeInUp 0.8s ease-out;
            letter-spacing: -0.5px;
        }
        
        .welcome-title-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientFlow 8s ease infinite;
        }
        
        .welcome-subtitle {
            animation: fadeInUp 0.8s ease-out 0.2s backwards;
        }
        
        .welcome-line {
            animation: fadeInUp 0.8s ease-out 0.4s backwards;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.3);
        }
        
        .welcome-version {
            animation: fadeInUp 0.8s ease-out 0.6s backwards;
            opacity: 0.5;
            transition: opacity 0.3s ease;
        }
        
        .welcome-version:hover {
            opacity: 1;
        }
		
		/* 연결 상태 표시 */
        .connection-status {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: var(--surface-primary);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid var(--border);
            border-radius: 16px;
            box-shadow: var(--shadow);
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .connection-status.connected {
            border-color: rgba(34, 197, 94, 0.3);
            background: rgba(34, 197, 94, 0.08);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        .status-dot.connected {
            background: #22c55e;
            box-shadow: 0 0 8px rgba(34, 197, 94, 0.6);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(0.95); }
        }
		
		/* 입력 중 표시 */
        .typing-indicator {
            display: none;
            align-items: center;
            padding: 8px 14px;
            background: var(--surface-primary);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid var(--border);
            border-radius: 16px;
            box-shadow: var(--shadow);
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
            gap: 6px;
        }
		
		/* 인원 현황 테이블 input 스타일 */
        .staffing-input {
            width: 70px;
            text-align: center;
            background: var(--surface-secondary);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 6px 8px;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 15px;
            transition: all 0.2s ease;
            -moz-appearance: textfield;
        }
        
        .staffing-input::-webkit-outer-spin-button,
        .staffing-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        .staffing-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .staffing-input:hover {
            border-color: var(--accent);
        }

        .report-input {
            width: 100%;
            background: transparent;
            border: 1px solid transparent;
            border-radius: 6px;
            padding: 4px;
            text-align: center;
            color: var(--text-primary);
            font-weight: 500;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        .report-input:focus {
            outline: none;
            background: var(--surface-secondary);
            border-color: var(--accent);
        }

        @keyframes fadeIn {
            from { 
                opacity: 0;
                transform: translateY(10px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 반응형 */
        @media (max-width: 1200px) {
            .welcome-message > div:nth-of-type(2) {
                flex-direction: column;
                align-items: center;
            }
        }
        
        @media (max-width: 768px) {
            .tab-navigation {
                padding: 12px 20px;
            }

            .tab-list {
                gap: 24px;
            }
            
            .tab-item {
                font-size: 13px;
            }

            .main-content {
                margin-top: 160px;
            }

            .header-top {
                padding: 16px 20px;
            }

            .header-title {
                font-size: 18px;
            }
            
            .date-display {
                background: none;
                border: none;
                padding: 0;
                color: var(--text-secondary);
                box-shadow: none;
                font-size: 12px;
                margin-left: 8px;
                vertical-align: baseline;
            }
        }

        @media (max-width: 480px) {
            .tab-list {
                gap: 20px;
            }
            
            .tab-item {
                font-size: 12px;
            }
        }
		
		/* 변경 로그 패널 */
        .activity-log-btn {
            background: var(--surface-secondary);
            backdrop-filter: blur(8px);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 10px 14px;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: all 0.2s ease;
            font-size: 18px;
            margin-right: 12px;
        }

        .activity-log-btn:hover {
            transform: translateY(-1px);
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .activity-log-panel {
            position: fixed;
            left: -400px;
            top: 0;
            width: 400px;
            height: 100vh;
            background: var(--surface-primary);
            backdrop-filter: blur(12px);
            border-right: 1px solid var(--border);
            box-shadow: var(--shadow-lg);
            z-index: 1001;
            transition: left 0.3s ease;
            overflow-y: auto;
        }

        .activity-log-panel.open {
            left: 0;
        }

        .activity-log-header {
            position: sticky;
            top: 0;
            background: var(--surface-primary);
            backdrop-filter: blur(12px);
            padding: 20px 24px;
            border-bottom: 2px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }

        .activity-log-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .close-log-btn {
            background: transparent;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: color 0.2s ease;
        }

        .close-log-btn:hover {
            color: var(--text-primary);
        }

        .activity-log-content {
            padding: 16px 24px;
        }

        .log-item {
            padding: 12px;
            margin-bottom: 8px;
            background: var(--surface-secondary);
            border-radius: 8px;
            border-left: 3px solid var(--accent);
            animation: fadeIn 0.3s ease-out;
        }

        .log-user {
            font-weight: 600;
            color: var(--accent);
        }

        .log-time {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .log-change {
            margin-top: 6px;
            font-size: 13px;
            color: var(--text-primary);
        }

        .log-value {
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 4px;
            background: rgba(59, 130, 246, 0.1);
        }

        .log-empty {
            text-align: center;
            color: var(--text-secondary);
            padding: 40px 20px;
            font-size: 14px;
        }
		
		/* DATA 탭 스타일 */
        .data-management {
            animation: fadeIn 0.3s ease-out;
        }

        .data-section {
            margin-bottom: 40px;
            background: var(--surface-primary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border);
        }

        .section-header h3 {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .add-row-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .add-row-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .table-wrapper {
            overflow-x: auto;
            border-radius: 8px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .data-table thead {
            background: var(--surface-secondary);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .data-table th {
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 2px solid var(--border);
            white-space: nowrap;
        }

        .data-table td {
            padding: 8px;
            text-align: center;
            border-bottom: 1px solid var(--border);
        }

        .data-row:hover {
            background: var(--surface-secondary);
        }

        .data-input {
            width: 100%;
            padding: 6px 8px;
            background: transparent;
            border: 1px solid transparent;
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 14px;
            text-align: center;
            transition: all 0.2s ease;
        }

        .data-input:focus {
            outline: none;
            background: var(--surface-secondary);
            border-color: var(--accent);
        }

        .data-input:hover {
            background: var(--surface-secondary);
        }

        .data-select {
            width: 100%;
            padding: 6px 8px;
            background: var(--surface-secondary);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .data-select:focus {
            outline: none;
            border-color: var(--accent);
        }

        .skill-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--accent);
        }

        .delete-row-btn {
            background: transparent;
            border: none;
            font-size: 18px;
            cursor: pointer;
            opacity: 0.6;
            transition: all 0.2s ease;
        }

        .delete-row-btn:hover {
            opacity: 1;
            transform: scale(1.2);
        }
    </style>
</head>
<body>
    <header class="fixed-header">
        <div class="header-top">
            <div class="header-title">
                <button class="activity-log-btn" id="activityLogBtn" title="변경 내역">📋</button>
                <span class="rocket">🚀</span>
                <span class="title-text">GWJ2 OB 인원 관리 시트 #PDA 일지</span>
            </div>
            <div class="header-controls">
                <div class="clock-display" id="currentClock">
                    <span class="clock-emoji">⏰</span>
                    <div class="time-segment">
                        <div class="time-unit">
                            <div class="digit-box" id="hour1">0</div>
                            <div class="digit-box" id="hour2">0</div>
                        </div>
                        <span class="time-separator">:</span>
                        <div class="time-unit">
                            <div class="digit-box" id="minute1">0</div>
                            <div class="digit-box" id="minute2">0</div>
                        </div>
                        <span class="time-separator">:</span>
                        <div class="time-unit">
                            <div class="digit-box" id="second1">0</div>
                            <div class="digit-box" id="second2">0</div>
                        </div>
                    </div>
                </div>
                <button class="dark-light-toggle" aria-label="다크모드 토글">
                    <div class="icon30 sun">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#fbbf24">
                            <path d="M480-280q-83 0-141.5-58.5T280-480q0-83 58.5-141.5T480-680q83 0 141.5 58.5T680-480q0 83-58.5 141.5T480-280ZM200-440H40v-80h160v80Zm720 0H760v-80h160v80ZM440-760v-160h80v160h-80Zm0 720v-160h80v160h-80ZM256-650l-101-97 57-59 96 100-52 56Zm492 496-97-101 53-55 101 97-57 59Zm-98-550 97-101 59 57-100 96-56-52ZM154-212l101-97 55 53-97 101-59-57Z"/>
                        </svg>
                    </div>
                    <div class="icon30 moon">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#fbbf24">
                            <path d="M480-120q-150 0-255-105T120-480q0-150 105-255t255-105q14 0 27.5 1t26.5 3q-41 29-65.5 75.5T444-660q0 90 63 153t153 63q55 0 101-24.5t75-65.5q2 13 3 26.5t1 27.5q0 150-105 255T480-120Z"/>
                        </svg>
                    </div>
                </button>
				<div class="user-badge" id="userBadge" style="display: none;">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <span id="userName">사용자</span>
                </div>
				<div class="connection-status" id="connectionStatus">
                    <div class="status-dot" id="statusDot"></div>
                    <span id="statusText">연결 중...</span>
                </div>
                <div class="typing-indicator" id="typingIndicator">
                    <span style="color: var(--accent);">✍️</span>
                    <span id="typingUser"></span>
                    <span style="color: var(--text-secondary);">입력 중...</span>
                </div>
            </div>
        </div>
        
        <nav class="tab-navigation">
            <div class="tab-list">
                <div class="tab-item active" data-tab="home">HOME</div>
                <div class="tab-item" data-tab="data">DATA</div>
                <div class="tab-item" data-tab="flow">FLOW</div>
                <div class="tab-item" data-tab="pack">PACK</div>
                <div class="tab-item" data-tab="pick">PICK</div>
                <div class="tab-item" data-tab="share">공유</div>
                <div class="tab-item" data-tab="rtpb">RTPB DATA</div>
                <div class="tab-item" data-tab="raw">RAW</div>
                <div class="tab-item" data-tab="duplicate">중복값</div>
                <div class="tab-item" data-tab="extension">연장 조사</div>
            </div>
        </nav>
    </header>

    <main class="main-content">
	<div class="content-area" id="contentArea">
        <!-- 내용은 switchTab 함수에 의해 동적으로 채워집니다 -->
    </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection, query } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
		
		// 입력중 전역변수
        let typingTimeout = null;
        let isTyping = false;
        let saveTimeout = null;
        let lastSavedData = {};

        // Firebase API KEY
        const firebaseConfig = {
            apiKey: "AIzaSyDhYh-C1Zsv7PjRq0kHBNDUf8JMcxTV_l4",
            authDomain: "gwj2swingsheet.firebaseapp.com",
            projectId: "gwj2swingsheet",
            storageBucket: "gwj2swingsheet.appspot.com",
            messagingSenderId: "336629205001",
            appId: "1:336629205001:web:480a6bbb643ceff98c10d8",
            measurementId: "G-L5P3HWMB41"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const docRef = doc(db, "reports", "today");
		let cachedData = null;
        let currentUser = null;
		
		// 하드코딩된 사용자 계정 목록
        const users = [
            { username: 'Bennett', password: '1234', displayName: 'Bennett' },
            { username: 'Leif', password: '1234', displayName: 'Leif' },
            { username: 'Admin', password: 'admin123', displayName: 'Admin' }
        ];

        // 탭 콘텐츠 데이터
        const tabContents = {
			home: {
                title: 'HOME',
                content: ''
            },
            data: {
                title: 'DATA 관리',
                content: '기본 데이터 관리 및 조회 기능을 제공합니다.'
            },
            flow: {
                title: 'FLOW 관리',
                content: '워크플로우 및 프로세스 관리를 위한 도구입니다.'
            },
            pack: {
                title: 'PACK 관리',
                content: '패키지 및 묶음 데이터 관리 기능입니다.'
            },
            pick: {
                title: 'PICK 관리',
                content: '선별 및 추출 작업을 위한 도구입니다.'
            },
            share: {
                title: '공유 관리',
                content: '데이터 공유 및 협업 기능을 제공합니다.'
            },
            rtpb: {
                title: 'RTPB DATA',
                content: '실시간 RTPB 데이터 분석 및 모니터링 기능입니다.'
            },
            raw: {
                title: 'RAW 데이터',
                content: '원본 데이터 조회 및 처리 기능을 제공합니다.'
            },
            duplicate: {
                title: '중복값 검사',
                content: '데이터 중복 검사 및 정리 도구입니다.'
            },
            extension: {
                title: '연장 조사',
                content: '추가 조사 및 연장 관련 업무 관리 기능입니다.'
            }
        };

        function switchTab(tabId) {
            const contentArea = document.getElementById('contentArea');
            if (!contentArea) return;
            
            document.querySelectorAll('.tab-item').forEach(tab => tab.classList.remove('active'));
            const selectedTab = document.querySelector(`[data-tab="${tabId}"]`);
            if (selectedTab) selectedTab.classList.add('active');
            
            if (tabId === 'home') {
                contentArea.innerHTML = `
                    <div class="welcome-message">
                        <div class="welcome-title" style="font-size: 48px; font-weight: 900; margin-bottom: 12px; line-height: 1.2;">
                            <span style="display: inline-block; animation: rocketPulse 2s ease-in-out infinite;">🚀</span> 
                            <span class="welcome-title-gradient">GWJ2 OB 인원 관리 시스템</span>
                        </div>
                        <div class="welcome-subtitle" style="font-size: 22px; font-weight: 600; color: var(--text-secondary); margin-bottom: 24px;">
                            # SWING PDA 일지
                        </div>
                        <div class="welcome-line" style="width: 300px; height: 3px; background: linear-gradient(90deg, transparent, var(--accent), transparent); margin: 0 auto 24px;"></div>
                        <div class="welcome-version" style="font-size: 14px; color: var(--text-tertiary); font-weight: 500;">
                            Ver 1.0
                        </div>
                        
                        <div style="margin-top: 40px; display: flex; justify-content: center; align-items: stretch; gap: 24px;">
                            <!-- 인원 현황 테이블 -->
                            <div style="flex: 1; max-width: 580px;">
                                <div id="staffing-box" style="background: var(--surface-primary); backdrop-filter: blur(12px); border: 1px solid var(--border); border-radius: 16px; padding: 24px; box-shadow: var(--shadow-lg); height: 100%;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 14px; border-bottom: 2px solid var(--border);">
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <h3 style="font-size: 20px; font-weight: 800; color: var(--text-primary); margin: 0; letter-spacing: -0.5px;">📊 인원 현황</h3>
                                            <button id="capture-staffing-btn" class="capture-btn">📸</button>
                                        </div>
                                        <div style="display: flex; gap: 10px;">
                                            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 8px 18px; border-radius: 10px; box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);">
                                                <div style="font-size: 9px; color: rgba(255,255,255,0.8); font-weight: 600; margin-bottom: 1px; letter-spacing: 0.3px;">채용률</div>
                                                <div style="color: white; font-weight: 900; font-size: 24px; line-height: 1; letter-spacing: -1px;"><span id="hiring-rate">-</span><span style="font-size: 16px;"> %</span></div>
                                            </div>
                                            <div style="background: linear-gradient(135deg, #38bdf8 0%, #3b82f6 100%); padding: 0 18px; border-radius: 10px; box-shadow: 0 3px 10px rgba(59, 130, 246, 0.3); display: flex; align-items: center; justify-content: center;">
                                                <div style="color: white; font-weight: 900; font-size: 20px; letter-spacing: -0.5px;">SWING 🌙</div>
                                            </div>
                                        </div>
                                    </div>
                                    <table style="width: 100%; border-collapse: collapse;">
                                        <thead>
                                            <tr style="border-bottom: 2px solid var(--border);"><th style="padding: 8px 0; text-align: center; color: var(--text-tertiary); font-weight: 700; font-size: 11px; text-transform: uppercase; letter-spacing: 0.3px; width: 34%;">구분</th><th style="padding: 8px 0; text-align: center; color: var(--text-tertiary); font-weight: 700; font-size: 11px; text-transform: uppercase; letter-spacing: 0.3px; width: 22%;">Plan</th><th style="padding: 8px 0; text-align: center; color: var(--text-tertiary); font-weight: 700; font-size: 11px; text-transform: uppercase; letter-spacing: 0.3px; width: 22%;">Actual</th><th style="padding: 8px 0; text-align: center; color: var(--text-tertiary); font-weight: 700; font-size: 11px; text-transform: uppercase; letter-spacing: 0.3px; width: 22%;">Gap</th></tr>
                                        </thead>
                                        <tbody>
                                            <tr style="border-bottom: 1px solid var(--border);"><td colspan="4" style="padding: 10px 0; font-weight: 800; font-size: 15px; color: var(--text-primary); background: var(--surface-secondary); text-align: center;">상용직</td></tr>
                                            <tr style="border-bottom: 1px solid rgba(148, 163, 184, 0.08);"><td style="padding: 8px 0; color: var(--text-primary); font-weight: 500; font-size: 14px; text-align: center;">T/C</td><td style="padding: 8px 0; text-align: center;"><input type="number" id="perm-tc-plan" class="staffing-input"></td><td style="padding: 8px 0; text-align: center;"><input type="number" id="perm-tc-actual" class="staffing-input"></td><td style="padding: 8px 0; text-align: center; font-weight: 700; font-size: 15px;" id="perm-tc-gap"></td></tr>
                                            <tr style="border-bottom: 1px solid rgba(148, 163, 184, 0.08);"><td style="padding: 8px 0; color: var(--text-primary); font-weight: 500; font-size: 14px; text-align: center;">Perm</td><td style="padding: 8px 0; text-align: center;"><input type="number" id="perm-perm-plan" class="staffing-input"></td><td style="padding: 8px 0; text-align: center;"><input type="number" id="perm-perm-actual" class="staffing-input"></td><td style="padding: 8px 0; text-align: center; font-weight: 700; font-size: 15px;" id="perm-perm-gap"></td></tr>
                                            <tr style="background: var(--surface-secondary); border-bottom: 2px solid var(--border);"><td style="padding: 9px 0; font-weight: 700; color: var(--text-primary); font-size: 14px; text-align: center;">소계</td><td style="padding: 9px 0; text-align: center; font-weight: 700; font-size: 16px; color: var(--text-primary);" id="perm-total-plan"></td><td style="padding: 9px 0; text-align: center; font-weight: 700; font-size: 16px; color: var(--text-primary);" id="perm-total-actual"></td><td style="padding: 9px 0; text-align: center; font-weight: 700; font-size: 16px;" id="perm-total-gap"></td></tr>
                                            <tr style="border-bottom: 1px solid var(--border);"><td colspan="4" style="padding: 10px 0; font-weight: 800; font-size: 15px; color: var(--text-primary); background: var(--surface-secondary); text-align: center;">임시직</td></tr>
                                            <tr style="border-bottom: 1px solid rgba(148, 163, 184, 0.08);"><td style="padding: 8px 0; color: var(--text-primary); font-weight: 500; font-size: 14px; text-align: center;">Temp</td><td style="padding: 8px 0; text-align: center;"><input type="number" id="temp-temp-plan" class="staffing-input"></td><td style="padding: 8px 0; text-align: center;"><input type="number" id="temp-temp-actual" class="staffing-input"></td><td style="padding: 8px 0; text-align: center; font-weight: 700; font-size: 15px;" id="temp-temp-gap"></td></tr>
                                            <tr style="border-bottom: 1px solid rgba(148, 163, 184, 0.08);"><td style="padding: 8px 0; color: var(--text-primary); font-weight: 500; font-size: 14px; text-align: center;">Newbie</td><td style="padding: 8px 0; text-align: center;"><input type="number" id="temp-newbie-plan" class="staffing-input"></td><td style="padding: 8px 0; text-align: center;"><input type="number" id="temp-newbie-actual" class="staffing-input"></td><td style="padding: 8px 0; text-align: center; font-weight: 700; font-size: 15px;" id="temp-newbie-gap"></td></tr>
                                            <tr style="background: var(--surface-secondary); border-bottom: 2px solid var(--border);"><td style="padding: 9px 0; font-weight: 700; color: var(--text-primary); font-size: 14px; text-align: center;">소계</td><td style="padding: 9px 0; text-align: center; font-weight: 700; font-size: 16px; color: var(--text-primary);" id="temp-total-plan"></td><td style="padding: 9px 0; text-align: center; font-weight: 700; font-size: 16px; color: var(--text-primary);" id="temp-total-actual"></td><td style="padding: 9px 0; text-align: center; font-weight: 700; font-size: 16px;" id="temp-total-gap"></td></tr>
                                            <tr style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);"><td style="padding: 11px 0; font-weight: 800; font-size: 15px; color: var(--text-primary); text-align: center;">Total</td><td style="padding: 11px 0; text-align: center; font-weight: 800; font-size: 18px; color: var(--text-primary);" id="grand-total-plan"></td><td style="padding: 11px 0; text-align: center; font-weight: 800; font-size: 18px; color: var(--text-primary);" id="grand-total-actual"></td><td style="padding: 11px 0; text-align: center; font-weight: 800; font-size: 18px;" id="grand-total-gap"></td></tr>
                                        </tbody>
                                    </table>
                                    <div style="margin-top: 24px; display: flex; justify-content: center; gap: 12px;"><button id="reset-btn" style="background: #f87171; color: white; border: none; padding: 10px 20px; border-radius: 10px; font-weight: 600; cursor: pointer; transition: background 0.2s ease;">값 초기화</button></div>
                                </div>
                            </div>
                            <div style="flex: 1; max-width: 580px;">
                                <div id="report-box" style="background: var(--surface-primary); backdrop-filter: blur(12px); border: 1px solid var(--border); border-radius: 16px; padding: 24px; box-shadow: var(--shadow-lg); height: 100%;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding-bottom: 14px; border-bottom: 2px solid var(--border);">
                                        <h3 style="font-size: 20px; font-weight: 800; color: var(--text-primary); margin: 0; letter-spacing: -0.5px;">▣ OB Employees Report</h3>
                                        <button id="capture-report-btn" class="capture-btn">📸</button>
                                    </div>
                                    <table id="manager-report-table" style="width: 100%; font-size: 14px; border-collapse: collapse;">
                                        <tbody>
                                            <tr><td style="width: 80px; font-weight: 600; padding: 2px 4px; text-align: center;">OM/AM</td><td style="padding: 2px;"><input type="text" class="report-input" placeholder="-"></td><td style="padding: 2px;"><input type="text" class="report-input" placeholder="-"></td><td style="padding: 2px;"><input type="text" class="report-input" placeholder="-"></td></tr>
											<tr><td style="font-weight: 600; padding: 2px 4px; text-align: center;">T/C</td><td style="padding: 2px;"><input type="text" class="report-input" placeholder="-"></td><td style="padding: 2px;"><input type="text" class="report-input" placeholder="-"></td><td style="padding: 2px;"><input type="text" class="report-input" placeholder="-"></td></tr>
                                            <tr><td></td><td style="padding: 2px;"><input type="text" class="report-input" placeholder="-"></td><td style="padding: 2px;"><input type="text" class="report-input" placeholder="-"></td><td style="padding: 2px;"><input type="text" class="report-input" placeholder="-"></td></tr>
<tr><td></td><td style="padding: 2px;"><input type="text" class="report-input" placeholder="-"></td><td style="padding: 2px;"><input type="text" class="report-input" placeholder="-"></td><td style="padding: 2px;"><input type="text" class="report-input" placeholder="-"></td></tr>
<tr><td></td><td style="padding: 2px;"><input type="text" class="report-input" placeholder="-"></td><td style="padding: 2px;"><input type="text" class="report-input" placeholder="-"></td><td style="padding: 2px;"><input type="text" class="report-input" placeholder="-"></td></tr>
<tr><td></td><td style="padding: 2px;"><input type="text" class="report-input" placeholder="-"></td><td style="padding: 2px;"><input type="text" class="report-input" placeholder="-"></td><td style="padding: 2px;"><input type="text" class="report-input" placeholder="-"></td></tr>
<tr><td></td><td style="padding: 2px;"><input type="text" class="report-input" placeholder="-"></td><td style="padding: 2px;"><input type="text" class="report-input" placeholder="-"></td><td style="padding: 2px;"><input type="text" class="report-input" placeholder="-"></td></tr>
											<tr style="border-top: 1px solid var(--border);"><td style="font-weight: 600; padding: 6px 4px; text-align: center;">Total</td><td id="report-manager-total" style="font-weight: 700; text-align: center;" colspan="3">0</td></tr>
                                        </tbody>
                                    </table>
                                    <h3 style="font-size: 20px; font-weight: 800; color: var(--text-primary); margin: 20px 0 4px 0; letter-spacing: -0.5px; text-align: left; padding-top: 20px; padding-bottom: 14px; border-top: 2px solid var(--border);">📊 실시간 인원 현황</h3>
                                    <table style="width: 100%; margin-top: 10px; font-size: 14px; border-collapse: collapse;">
                                        <thead>
                                            <tr style="border-bottom: 2px solid var(--border);"><th style="text-align: center; color: var(--text-tertiary); font-weight: 700; font-size: 11px; text-transform: uppercase; letter-spacing: 0.3px; width: 50%;">구분</th><th style="text-align: center; color: var(--text-tertiary); font-weight: 700; font-size: 11px; text-transform: uppercase; letter-spacing: 0.3px; width: 25%;">인원</th><th style="text-align: center; color: var(--text-tertiary); font-weight: 700; font-size: 11px; text-transform: uppercase; letter-spacing: 0.3px; width: 25%;">비고</th></tr>
                                        </thead>
                                        <tbody>
                                            <tr><td style="font-weight: 500; padding: 8px 0; text-align: center;">Team Captain</td><td id="report-tc-actual" style="text-align: center; font-weight: 600;">- 명</td><td style="text-align: center; padding: 2px;"><input type="text" class="report-input report-remark"></td></tr>
                                            <tr><td style="font-weight: 500; padding: 8px 0; text-align: center;">계약직</td><td id="report-perm-actual" style="text-align: center; font-weight: 600;">- 명</td><td style="text-align: center; padding: 2px;"><input type="text" class="report-input report-remark"></td></tr>
                                            <tr><td style="font-weight: 500; padding: 8px 0; text-align: center;">단기직</td><td id="report-temp-actual" style="text-align: center; font-weight: 600;">- 명</td><td style="text-align: center; padding: 2px;"><input type="text" class="report-input report-remark"></td></tr>
                                            <tr style="border-top: 1px solid var(--border);"><td style="font-weight: 700; padding: 8px 0; text-align: center;">Total</td><td id="report-total-actual" style="text-align: center; font-weight: 700;">- 명</td><td style="text-align: center;">-</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    <!-- 👇 여기에 추가! -->
                        <div id="adminPanel" style="display: none;" class="admin-panel">
                            <h3 class="admin-title">🔐 관리자 패널 - 계정 관리</h3>
                            <div class="user-list" id="userList"></div>
                            <div style="border-top: 1px solid var(--border); padding-top: 16px;">
                                <h4 style="font-size: 16px; font-weight: 600; margin-bottom: 12px;">새 계정 추가</h4>
                                <div class="add-user-form">
                                    <input type="text" id="newUsername" class="admin-input" placeholder="아이디">
                                    <input type="text" id="newDisplayName" class="admin-input" placeholder="표시 이름">
                                    <input type="password" id="newPassword" class="admin-input" placeholder="비밀번호">
                                    <button id="addUserBtn" class="add-btn">추가</button>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                `;
                 setTimeout(() => {
                    initializeHomeTabListeners();
                    if (cachedData) {
                        updateUIFromData(cachedData);
                    }
                    // Admin 사용자면 관리자 패널 다시 표시
                    if (currentUser && currentUser.username.toLowerCase() === 'admin') {
                        showAdminPanel();
                    }
                }, 0);
                return;
            }
			
			if (tabId === 'data') {
                contentArea.innerHTML = `
                    <div class="data-management">
                        <h2 style="font-size: 28px; font-weight: 700; margin-bottom: 24px; color: var(--text-primary);">📊 사원 데이터 관리</h2>
                        
                        <!-- 매니저 테이블 -->
                        <div class="data-section">
                            <div class="section-header">
                                <h3>👔 매니저 (M/G)</h3>
                                <button class="add-row-btn" data-table="managers">+ 행 추가</button>
                            </div>
                            <div class="table-wrapper">
                                <table class="data-table" id="managers-table">
                                    <thead>
                                        <tr>
                                            <th style="width: 120px;">원바코드</th>
                                            <th style="width: 120px;">닉네임</th>
                                            <th style="width: 150px;">이름</th>
                                            <th style="width: 60px;">삭제</th>
                                        </tr>
                                    </thead>
                                    <tbody id="managers-tbody">
                                        <tr class="data-row">
                                            <td><input type="text" class="data-input" placeholder="원바코드 입력"></td>
                                            <td><input type="text" class="data-input" placeholder="닉네임 입력"></td>
                                            <td><input type="text" class="data-input" placeholder="이름 입력"></td>
                                            <td><button class="delete-row-btn">🗑️</button></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- 현장관리자 테이블 -->
                        <div class="data-section">
                            <div class="section-header">
                                <h3>👷 현장관리자 (T/C)</h3>
                                <button class="add-row-btn" data-table="tc">+ 행 추가</button>
                            </div>
                            <div class="table-wrapper">
                                <table class="data-table" id="tc-table">
                                    <thead>
                                        <tr>
                                            <th style="width: 120px;">원바코드</th>
                                            <th style="width: 120px;">닉네임</th>
                                            <th style="width: 150px;">이름</th>
                                            <th style="width: 60px;">삭제</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tc-tbody">
                                        <tr class="data-row">
                                            <td><input type="text" class="data-input" placeholder="원바코드 입력"></td>
                                            <td><input type="text" class="data-input" placeholder="닉네임 입력"></td>
                                            <td><input type="text" class="data-input" placeholder="이름 입력"></td>
                                            <td><button class="delete-row-btn">🗑️</button></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- PS 사원 테이블 -->
                        <div class="data-section">
                            <div class="section-header">
                                <h3>⭐ PS 사원</h3>
                                <button class="add-row-btn" data-table="ps">+ 행 추가</button>
                            </div>
                            <div class="table-wrapper">
                                <table class="data-table" id="ps-table">
                                    <thead>
                                        <tr>
                                            <th style="width: 120px;">원바코드</th>
                                            <th style="width: 80px;">조</th>
                                            <th style="width: 150px;">이름</th>
                                            <th style="width: 60px;">삭제</th>
                                        </tr>
                                    </thead>
                                    <tbody id="ps-tbody">
                                        <tr class="data-row">
                                            <td><input type="text" class="data-input" placeholder="원바코드 입력"></td>
                                            <td>
                                                <select class="data-select">
                                                    <option value="">선택</option>
                                                    <option value="A">A조</option>
                                                    <option value="B">B조</option>
                                                    <option value="C">C조</option>
                                                    <option value="D">D조</option>
                                                    <option value="E">E조</option>
                                                    <option value="F">F조</option>
                                                    <option value="G">G조</option>
                                                </select>
                                            </td>
                                            <td><input type="text" class="data-input" placeholder="이름 입력"></td>
                                            <td><button class="delete-row-btn">🗑️</button></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- 계약직 사원 테이블 -->
                        <div class="data-section">
                            <div class="section-header">
                                <h3>💼 계약직 사원</h3>
                                <button class="add-row-btn" data-table="permanent">+ 행 추가</button>
                            </div>
                            <div class="table-wrapper">
                                <table class="data-table" id="permanent-table">
                                    <thead>
                                        <tr>
                                            <th style="width: 100px;">원바코드</th>
                                            <th style="width: 70px;">조</th>
                                            <th style="width: 100px;">이름</th>
                                            <th style="width: 70px;">오토백</th>
                                            <th style="width: 70px;">메뉴얼</th>
                                            <th style="width: 70px;">멀티</th>
                                            <th style="width: 80px;">하이스킬</th>
                                            <th style="width: 70px;">AGV</th>
                                            <th style="width: 90px;">오더피커</th>
                                            <th style="width: 70px;">워터</th>
                                            <th style="width: 60px;">삭제</th>
                                        </tr>
                                    </thead>
                                    <tbody id="permanent-tbody">
                                        <tr class="data-row">
                                            <td><input type="text" class="data-input" placeholder="원바코드"></td>
                                            <td>
                                                <select class="data-select">
                                                    <option value="">선택</option>
                                                    <option value="A">A조</option>
                                                    <option value="B">B조</option>
                                                    <option value="C">C조</option>
                                                    <option value="D">D조</option>
                                                    <option value="E">E조</option>
                                                    <option value="F">F조</option>
                                                    <option value="G">G조</option>
                                                </select>
                                            </td>
                                            <td><input type="text" class="data-input" placeholder="이름"></td>
                                            <td><input type="checkbox" class="skill-checkbox"></td>
                                            <td><input type="checkbox" class="skill-checkbox"></td>
                                            <td><input type="checkbox" class="skill-checkbox"></td>
                                            <td><input type="checkbox" class="skill-checkbox"></td>
                                            <td><input type="checkbox" class="skill-checkbox"></td>
                                            <td><input type="checkbox" class="skill-checkbox"></td>
                                            <td><input type="checkbox" class="skill-checkbox"></td>
                                            <td><button class="delete-row-btn">🗑️</button></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- 단기직 사원 테이블 -->
                        <div class="data-section">
                            <div class="section-header">
                                <h3>📋 단기직 사원</h3>
                                <button class="add-row-btn" data-table="temporary">+ 행 추가</button>
                            </div>
                            <div class="table-wrapper">
                                <table class="data-table" id="temporary-table">
                                    <thead>
                                        <tr>
                                            <th style="width: 120px;">원바코드</th>
                                            <th style="width: 120px;">이름</th>
                                            <th style="width: 70px;">오토백</th>
                                            <th style="width: 70px;">메뉴얼</th>
                                            <th style="width: 70px;">멀티</th>
                                            <th style="width: 80px;">하이스킬</th>
                                            <th style="width: 70px;">AGV</th>
                                            <th style="width: 90px;">오더피커</th>
                                            <th style="width: 70px;">워터</th>
                                            <th style="width: 60px;">삭제</th>
                                        </tr>
                                    </thead>
                                    <tbody id="temporary-tbody">
                                        <tr class="data-row">
                                            <td><input type="text" class="data-input" placeholder="원바코드"></td>
                                            <td><input type="text" class="data-input" placeholder="이름"></td>
                                            <td><input type="checkbox" class="skill-checkbox"></td>
                                            <td><input type="checkbox" class="skill-checkbox"></td>
                                            <td><input type="checkbox" class="skill-checkbox"></td>
                                            <td><input type="checkbox" class="skill-checkbox"></td>
                                            <td><input type="checkbox" class="skill-checkbox"></td>
                                            <td><input type="checkbox" class="skill-checkbox"></td>
                                            <td><input type="checkbox" class="skill-checkbox"></td>
                                            <td><button class="delete-row-btn">🗑️</button></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- 신규단기 사원 테이블 -->
                        <div class="data-section">
                            <div class="section-header">
                                <h3>🆕 신규단기 사원</h3>
                                <button class="add-row-btn" data-table="newbie">+ 행 추가</button>
                            </div>
                            <div class="table-wrapper">
                                <table class="data-table" id="newbie-table">
                                    <thead>
                                        <tr>
                                            <th style="width: 150px;">원바코드</th>
                                            <th style="width: 200px;">이름</th>
                                            <th style="width: 60px;">삭제</th>
                                        </tr>
                                    </thead>
                                    <tbody id="newbie-tbody">
                                        <tr class="data-row">
                                            <td><input type="text" class="data-input" placeholder="원바코드 입력"></td>
                                            <td><input type="text" class="data-input" placeholder="이름 입력"></td>
                                            <td><button class="delete-row-btn">🗑️</button></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- CD 사원 테이블 -->
                        <div class="data-section">
                            <div class="section-header">
                                <h3>🔧 CD 사원</h3>
                                <button class="add-row-btn" data-table="cd">+ 행 추가</button>
                            </div>
                            <div class="table-wrapper">
                                <table class="data-table" id="cd-table">
                                    <thead>
                                        <tr>
                                            <th style="width: 120px;">원바코드</th>
                                            <th style="width: 100px;">공정</th>
                                            <th style="width: 150px;">이름</th>
                                            <th style="width: 60px;">삭제</th>
                                        </tr>
                                    </thead>
                                    <tbody id="cd-tbody">
                                        <tr class="data-row">
                                            <td><input type="text" class="data-input" placeholder="원바코드 입력"></td>
                                            <td>
                                                <select class="data-select">
                                                    <option value="">선택</option>
                                                    <option value="OB">OB</option>
                                                    <option value="IB">IB</option>
                                                    <option value="ICQA">ICQA</option>
                                                    <option value="HUB">HUB</option>
                                                    <option value="CFC">CFC</option>
                                                </select>
                                            </td>
                                            <td><input type="text" class="data-input" placeholder="이름 입력"></td>
                                            <td><button class="delete-row-btn">🗑️</button></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
                
                setTimeout(() => {
                    initializeDataTab();
                }, 0);
                return;
            }
            
            const content = tabContents[tabId];
            contentArea.innerHTML = `
                <div class="tab-content" style="animation: fadeIn 0.3s ease-out;">
                    <h2 style="color: var(--text-primary); font-size: 28px; font-weight: 700; margin-bottom: 16px;">${content.title}</h2>
                    <p style="color: var(--text-secondary); font-size: 16px; line-height: 1.6;">${content.content}</p>
                    <div style="margin-top: 32px; padding: 24px; background: var(--surface-secondary); border-radius: 16px; border: 1px solid var(--border);">
                        <p style="color: var(--text-secondary); font-size: 14px; text-align: center; opacity: 0.8;">
                            ${content.title} 기능이 곧 업데이트됩니다. ✨
                        </p>
                    </div>
                </div>
            `;
        }

        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('hour1').textContent = hours[0];
            document.getElementById('hour2').textContent = hours[1];
            document.getElementById('minute1').textContent = minutes[0];
            document.getElementById('minute2').textContent = minutes[1];
            document.getElementById('second1').textContent = seconds[0];
            document.getElementById('second2').textContent = seconds[1];
            checkUrgentDeadline(now);
        }

        function checkUrgentDeadline(currentTime) {
            const clockElement = document.getElementById('currentClock');
            let isUrgent = false;
            const deadlines = [ { hour: 11, minute: 10 }, { hour: 11, minute: 30 }, { hour: 17, minute: 30 }, { hour: 22, minute: 0 }, { hour: 1, minute: 15 }, { hour: 3, minute: 30 }, { hour: 4, minute: 30 } ];
            deadlines.forEach(deadline => {
                const deadlineTime = new Date(currentTime);
                deadlineTime.setHours(deadline.hour, deadline.minute, 0, 0);
                const urgentTime = new Date(deadlineTime);
                urgentTime.setHours(urgentTime.getHours() - 1);
                if (currentTime >= urgentTime && currentTime <= deadlineTime) {
                    isUrgent = true;
                }
            });
            if (isUrgent) {
                clockElement.classList.add('clock-urgent');
            } else {
                clockElement.classList.remove('clock-urgent');
            }
        }
        
        function displayCurrentDate() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const date = String(now.getDate()).padStart(2, '0');
            const dayNames = ['일', '월', '화', '수', '목', '금', '토'];
            const day = dayNames[now.getDay()];
            const formattedDate = `${year}년 ${month}월 ${date}일 (${day})`;
            const dateElement = document.createElement('span');
            dateElement.className = 'date-display';
            dateElement.textContent = formattedDate;
            const titleContainer = document.querySelector('.header-title');
            if (titleContainer) {
                titleContainer.appendChild(dateElement);
            }
        }
        
        function captureElementAsImage(elementId, friendlyName) {
            const element = document.getElementById(elementId);
            if (!element) {
                alert('캡처할 대상을 찾을 수 없습니다.');
                return;
            }
            const currentTheme = document.documentElement.getAttribute("color-theme");
            const bgColor = (currentTheme === 'dark') ? '#1e293b' : '#f8fafc';

            html2canvas(element, { 
                useCORS: true, 
                backgroundColor: bgColor,
                scale: 2
            }).then(canvas => {
                canvas.toBlob(blob => {
                    if (navigator.clipboard && navigator.clipboard.write) {
                        const item = new ClipboardItem({ 'image/png': blob });
                        navigator.clipboard.write([item]).then(() => {
                            alert(`'${friendlyName}' 박스가 이미지(PNG)로 복사되었습니다!`);
                        }).catch(err => {
                            console.error('클립보드 복사 실패:', err);
                            alert('클립보드 복사에 실패했습니다. 브라우저 권한을 확인해주세요.');
                        });
                    } else {
                        alert('이 브라우저에서는 클립보드 복사 기능을 지원하지 않습니다.');
                    }
                }, 'image/png');
            });
        }
        
        function initializeHomeTabListeners() {
            document.querySelectorAll('.staffing-input, .report-input').forEach(input => {
                input.addEventListener('input', () => {
                    saveDataToFirestore();
                    notifyTyping();
                });
            });
            document.getElementById('reset-btn')?.addEventListener('click', () => {
                if (confirm('정말로 모든 값을 0으로 초기화하시겠습니까?')) {
                    const defaultData = getInitialData();
                    setDoc(docRef, defaultData);
                    alert('모든 값이 0으로 초기화되었습니다.');
                }
            });
            document.getElementById('capture-staffing-btn')?.addEventListener('click', () => captureElementAsImage('staffing-box', '인원 현황'));
            document.getElementById('capture-report-btn')?.addEventListener('click', () => captureElementAsImage('report-box', 'OB Report'));
        }

        document.addEventListener("DOMContentLoaded", function () {
            const savedTheme = localStorage.getItem("color-theme") || "light";
            document.documentElement.setAttribute("color-theme", savedTheme);
            
            displayCurrentDate(); 
            updateClock();
            setInterval(updateClock, 1000);

            document.querySelectorAll('.tab-item').forEach(tab => {
                tab.addEventListener('click', () => switchTab(tab.dataset.tab));
            });
            
            // 로그인 설정 (이 줄 추가!)
            setupLoginListeners();
            
            switchTab('home');
			
			// 로그 패널 이벤트
            document.getElementById('activityLogBtn')?.addEventListener('click', toggleActivityLog);
            document.getElementById('closeLogBtn')?.addEventListener('click', toggleActivityLog);
        });

        const toggleButton = document.querySelector('.dark-light-toggle');
        toggleButton.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute("color-theme");
            const newTheme = currentTheme === "light" ? "dark" : "light";
            document.documentElement.setAttribute("color-theme", newTheme);
            localStorage.setItem("color-theme", newTheme);
        });

        // Firestore 데이터 리스너 설정
        onSnapshot(docRef, (doc) => {
            updateConnectionStatus(true);
            if (doc.exists()) {
                cachedData = doc.data();
                updateUIFromData(cachedData);
            } else {
                console.log("No such document! Creating with initial data.");
                setDoc(docRef, getInitialData());
            }
        }, (error) => {
            console.error('Connection error:', error);
            updateConnectionStatus(false);
        });
		
		// 타이핑 상태 리스너 - 컬렉션 전체 감시
        const typingCollectionRef = collection(db, "typing");
        onSnapshot(typingCollectionRef, (snapshot) => {
            const typingIndicator = document.getElementById('typingIndicator');
            const typingUser = document.getElementById('typingUser');
            
            if (!typingIndicator || !typingUser) return;
            
            const now = new Date().getTime();
            const typingUsers = [];
            
            snapshot.forEach((doc) => {
                const data = doc.data();
                // 5초 이내 & 본인 아닌 경우만
                if (data.displayName && 
                    data.timestamp && 
                    (now - data.timestamp < 5000) &&
                    data.displayName !== currentUser?.displayName) {
                    typingUsers.push(data.displayName);
                }
            });
            
            if (typingUsers.length > 0) {
                if (typingUsers.length === 1) {
                    typingUser.textContent = typingUsers[0] + ' 님이';
                } else {
                    typingUser.textContent = typingUsers.join(', ') + ' 님이';
                }
                typingIndicator.style.display = 'flex';
            } else {
                typingIndicator.style.display = 'none';
            }
        });
        
        function getInitialData() {
            // 모든 입력 필드의 기본값을 포함하는 객체를 반환하는 함수
            return {
                staffing: {
                    'perm-tc-plan': 0, 'perm-tc-actual': 0,
                    'perm-perm-plan': 0, 'perm-perm-actual': 0,
                    'temp-temp-plan': 0, 'temp-temp-actual': 0,
                    'temp-newbie-plan': 0, 'temp-newbie-actual': 0,
                },
                report: {
                    managers: Array(24).fill(''),
                    remarks: Array(3).fill('')
                }
            };
        }
        
        function saveDataToFirestore() {
            const staffingData = {};
            document.querySelectorAll('.staffing-input').forEach(input => {
                staffingData[input.id] = parseInt(input.value) || 0;
            });

            const managerInputs = document.querySelectorAll('#manager-report-table .report-input');
            const managerData = Array.from(managerInputs).map(input => input.value.trim() || '');
            
            const remarkInputs = document.querySelectorAll('.report-remark');
            const remarkData = Array.from(remarkInputs).map(input => input.value.trim() || '');

            const dataToSave = {
                staffing: staffingData,
                report: {
                    managers: managerData,
                    remarks: remarkData
                }
            };
            
            // 5초 디바운스 - 마지막 수정만 기록
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                // 변경사항 로그 기록 (자동 감지)
                if (Object.keys(lastSavedData).length > 0) {
                    logChangesAuto(lastSavedData, dataToSave);
                }
                lastSavedData = JSON.parse(JSON.stringify(dataToSave));
                
                setDoc(docRef, dataToSave, { merge: true });
            }, 5000);
        }
		
		// 자동 변경사항 감지 (모든 필드 자동 추적)
        function logChangesAuto(oldData, newData) {
            if (!currentUser) return;
            
            const changes = [];
            
            // 재귀적으로 모든 변경사항 찾기
            function findChanges(oldObj, newObj, path = '') {
                if (typeof newObj !== 'object' || newObj === null) {
                    if (oldObj !== newObj) {
                        changes.push({
                            field: path,
                            oldValue: oldObj === undefined || oldObj === null ? '-' : String(oldObj),
                            newValue: newObj === undefined || newObj === null ? '-' : String(newObj)
                        });
                    }
                    return;
                }
                
                // 배열 처리
                if (Array.isArray(newObj)) {
                    newObj.forEach((item, index) => {
                        const oldItem = oldObj?.[index];
                        const fieldPath = path ? `${path}[${index}]` : `[${index}]`;
                        
                        // 빈 값끼리는 무시
                        if ((oldItem || item) && oldItem !== item) {
                            findChanges(oldItem, item, fieldPath);
                        }
                    });
                    return;
                }
                
                // 객체 처리
                for (const key in newObj) {
                    const oldValue = oldObj?.[key];
                    const newValue = newObj[key];
                    const fieldPath = path ? `${path}.${key}` : key;
                    
                    findChanges(oldValue, newValue, fieldPath);
                }
            }
            
            findChanges(oldData, newData);
            
            // 변경사항이 있으면 Firestore에 저장
            if (changes.length > 0) {
                const logRef = doc(collection(db, "activityLogs"));
                setDoc(logRef, {
                    user: currentUser.displayName,
                    timestamp: new Date().getTime(),
                    changes: changes
                });
            }
        }
        
        // 로그 패널 토글
        function toggleActivityLog() {
            const panel = document.getElementById('activityLogPanel');
            panel.classList.toggle('open');
            
            if (panel.classList.contains('open')) {
                loadActivityLogs();
            }
        }
        
        // 로그 불러오기
        function loadActivityLogs() {
            const logsCollectionRef = collection(db, "activityLogs");
            
            onSnapshot(logsCollectionRef, (snapshot) => {
                const logs = [];
                const sevenDaysAgo = new Date().getTime() - (7 * 24 * 60 * 60 * 1000);
                
                snapshot.forEach((docSnapshot) => {
                    const data = docSnapshot.data();
                    
                    // 7일 이상 된 로그는 삭제
                    if (data.timestamp < sevenDaysAgo) {
                        docSnapshot.ref.delete();
                    } else {
                        logs.push({ id: docSnapshot.id, ...data });
                    }
                });
                
                // 최신순 정렬
                logs.sort((a, b) => b.timestamp - a.timestamp);
                
                // 최근 20개만 표시
                displayActivityLogs(logs.slice(0, 20));
            }, (error) => {
                console.error('로그 로딩 에러:', error);
            });
        }
        
        // 로그 표시
        function displayActivityLogs(logs) {
            const content = document.getElementById('activityLogContent');
            
            if (logs.length === 0) {
                content.innerHTML = '<div class="log-empty">아직 변경 내역이 없습니다.</div>';
                return;
            }
            
            // 필드명 한글화 (자동 변환)
            function prettifyFieldName(field) {
                // 1단계: 알려진 필드명 매핑
                const fieldMap = {
                    'staffing.perm-tc-plan': 'T/C Plan',
                    'staffing.perm-tc-actual': 'T/C Actual',
                    'staffing.perm-perm-plan': 'Perm Plan',
                    'staffing.perm-perm-actual': 'Perm Actual',
                    'staffing.temp-temp-plan': 'Temp Plan',
                    'staffing.temp-temp-actual': 'Temp Actual',
                    'staffing.temp-newbie-plan': 'Newbie Plan',
                    'staffing.temp-newbie-actual': 'Newbie Actual'
                };
                
                if (fieldMap[field]) {
                    return fieldMap[field];
                }
                
                // 2단계: 패턴 기반 자동 변환
                
                // report.managers[숫자] → Manager 숫자+1
                const managerMatch = field.match(/report\.managers\[(\d+)\]/);
                if (managerMatch) {
                    return `Manager ${parseInt(managerMatch[1]) + 1}`;
                }
                
                // report.remarks[숫자] → 비고 숫자+1
                const remarkMatch = field.match(/report\.remarks\[(\d+)\]/);
                if (remarkMatch) {
                    const index = parseInt(remarkMatch[1]);
                    const remarkNames = ['T/C 비고', '계약직 비고', '단기직 비고'];
                    return remarkNames[index] || `비고 ${index + 1}`;
                }
                
                // 3단계: 일반 패턴 자동 변환
                const arrayMatch = field.match(/(\w+)\.(\w+)\[(\d+)\]/);
                if (arrayMatch) {
                    const [_, section, property, index] = arrayMatch;
                    const sectionName = section.toUpperCase();
                    const propertyName = property.charAt(0).toUpperCase() + property.slice(1);
                    return `${sectionName} ${propertyName} ${parseInt(index) + 1}`;
                }
                
                // 4단계: 점 표기법 자동 변환
                const dotMatch = field.match(/(\w+)\.(\w+)/);
                if (dotMatch) {
                    const [_, section, property] = dotMatch;
                    const sectionName = section.charAt(0).toUpperCase() + section.slice(1);
                    const propertyName = property.split(/[-_]/).map(word => 
                        word.charAt(0).toUpperCase() + word.slice(1)
                    ).join(' ');
                    return `${sectionName} ${propertyName}`;
                }
                
                // 5단계: 그 외는 kebab-case를 Title Case로 변환
                return field.split(/[-_.]/).map(word => 
                    word.charAt(0).toUpperCase() + word.slice(1)
                ).join(' ');
            }
            
            content.innerHTML = logs.map(log => {
                const timeAgo = getTimeAgo(log.timestamp);
                const changesHtml = log.changes.map(change => {
                    const prettyField = prettifyFieldName(change.field);
                    return `<div class="log-change">
                        ${prettyField}: <span class="log-value">${change.oldValue}</span> → <span class="log-value">${change.newValue}</span>
                    </div>`;
                }).join('');
                
                return `
                    <div class="log-item">
                        <div><span class="log-user">${log.user}</span>님이 수정</div>
                        ${changesHtml}
                        <div class="log-time">${timeAgo}</div>
                    </div>
                `;
            }).join('');
        }
        
        // 시간 계산 (몇 분 전)
        function getTimeAgo(timestamp) {
            const now = new Date().getTime();
            const diff = now - timestamp;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            
            if (days > 0) return `${days}일 전`;
            if (hours > 0) return `${hours}시간 전`;
            if (minutes > 0) return `${minutes}분 전`;
            return '방금 전';
        }
		
		// 입력중 타이핑
        function notifyTyping() {
            if (!currentUser) return;
            
            // 각 사용자별 문서로 저장
            const typingRef = doc(db, "typing", currentUser.username);
            setDoc(typingRef, {
                displayName: currentUser.displayName,
                timestamp: new Date().getTime()
            });
            
            // 3초 후 타이핑 상태 제거
            clearTimeout(typingTimeout);
            typingTimeout = setTimeout(() => {
                setDoc(typingRef, {
                    displayName: null,
                    timestamp: null
                });
            }, 3000);
        }

        function updateUIFromData(data) {
            // 인원 현황 데이터 채우기
            if (data.staffing) {
                for (const id in data.staffing) {
                    const input = document.getElementById(id);
                    if (input) input.value = data.staffing[id];
                }
            }
            
            // OB Report 데이터 채우기
            if (data.report && data.report.managers) {
                const managerInputs = document.querySelectorAll('#manager-report-table .report-input');
                managerInputs.forEach((input, index) => {
                    const value = data.report.managers[index];
                    // '-'이면 빈 문자열로 처리 (placeholder가 보이도록)
                    input.value = (value === '-' || !value) ? '' : value;
                });
            }
            
            // 실시간 인원 현황 비고 채우기
            if (data.report && data.report.remarks) {
                const remarkInputs = document.querySelectorAll('.report-remark');
                remarkInputs.forEach((input, index) => {
                    const value = data.report.remarks[index];
                    // '-'이면 빈 문자열로 처리 (placeholder가 보이도록)
                    input.value = (value === '-' || !value) ? '' : value;
                });
            }

            calculateAll();
            
            // 초기 데이터 저장
            if (Object.keys(lastSavedData).length === 0) {
                lastSavedData = JSON.parse(JSON.stringify(data));
            }
        }
		
		function showAdminPanel() {
            const adminPanel = document.getElementById('adminPanel');
            if (!adminPanel) return;
            
            adminPanel.style.display = 'block';
            renderUserList();
            
            // 계정 추가 버튼
            document.getElementById('addUserBtn').onclick = () => {
                const username = document.getElementById('newUsername').value.trim();
                const displayName = document.getElementById('newDisplayName').value.trim();
                const password = document.getElementById('newPassword').value;
                
                if (!username || !displayName || !password) {
                    alert('모든 필드를 입력해주세요.');
                    return;
                }
                
                if (users.find(u => u.username.toLowerCase() === username.toLowerCase())) {
                    alert('이미 존재하는 아이디입니다.');
                    return;
                }
                
                users.push({ username, displayName, password });
                document.getElementById('newUsername').value = '';
                document.getElementById('newDisplayName').value = '';
                document.getElementById('newPassword').value = '';
                
                renderUserList();
                alert('계정이 추가되었습니다!');
            };
        }
        
        function renderUserList() {
            const userList = document.getElementById('userList');
            if (!userList) return;
            
            userList.innerHTML = users.map((user, index) => `
                <div class="user-item">
                    <div class="user-info">
                        <div class="user-avatar" style="width: 32px; height: 32px; font-size: 14px;">${user.displayName.charAt(0).toUpperCase()}</div>
                        <div>
                            <div style="font-weight: 600;">${user.displayName}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">@${user.username}</div>
                        </div>
                    </div>
                    ${user.username.toLowerCase() !== 'admin' ? `<button class="delete-btn" onclick="deleteUser(${index})">삭제</button>` : '<span style="color: var(--accent); font-weight: 600; font-size: 12px;">관리자</span>'}
                </div>
            `).join('');
        }
        
        window.deleteUser = function(index) {
            if (confirm(`'${users[index].displayName}' 계정을 삭제하시겠습니까?`)) {
                users.splice(index, 1);
                renderUserList();
                alert('계정이 삭제되었습니다.');
            }
        }
		
		function setupLoginListeners() {
            const loginModal = document.getElementById('loginModal');
            const loginBtn = document.getElementById('loginBtn');
            const registerBtn = document.getElementById('registerBtn');
            const userBadge = document.getElementById('userBadge');
            const loginError = document.getElementById('loginError');

            // 회원가입 버튼 숨기기
            registerBtn.style.display = 'none';

            // 로그인 버튼
            loginBtn.addEventListener('click', () => {
                const username = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                // 대소문자 구분 없이 비교
                const user = users.find(u => 
                    u.username.toLowerCase() === username.toLowerCase() && 
                    u.password === password
                );
                
                if (user) {
                    currentUser = user;
                    document.getElementById('userName').textContent = user.displayName;
                    document.getElementById('userAvatar').textContent = user.displayName.charAt(0).toUpperCase();
                    userBadge.style.display = 'flex';
                    loginModal.classList.remove('active');
                    loginError.style.display = 'none';
                    
                    // 세션에 저장
                    sessionStorage.setItem('currentUser', JSON.stringify(user));
                    
                    // Admin 계정이면 관리자 패널 표시
                    if (user.username.toLowerCase() === 'admin') {
                        setTimeout(() => {
                    initializeHomeTabListeners();
                    if (cachedData) {
                        updateUIFromData(cachedData);
                    }
                    // Admin 사용자면 관리자 패널 다시 표시
                    if (currentUser && currentUser.username.toLowerCase() === 'admin') {
                        showAdminPanel();
                    }
                }, 0);
                    }
                } else {
                    loginError.textContent = '아이디 또는 비밀번호가 올바르지 않습니다.';
                    loginError.style.display = 'block';
                }
            });

            // Enter 키로 로그인
            document.getElementById('loginPassword').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    loginBtn.click();
                }
            });

            // 사용자 뱃지 클릭 시 로그아웃
            userBadge.addEventListener('click', () => {
                if (confirm('로그아웃 하시겠습니까?')) {
                    currentUser = null;
                    userBadge.style.display = 'none';
                    loginModal.classList.add('active');
                    sessionStorage.removeItem('currentUser');
                    document.getElementById('loginEmail').value = '';
                    document.getElementById('loginPassword').value = '';
                }
            });

            const savedUser = sessionStorage.getItem('currentUser');
            if (savedUser) {
                const user = JSON.parse(savedUser);
                currentUser = user;
                document.getElementById('userName').textContent = user.displayName;
                document.getElementById('userAvatar').textContent = user.displayName.charAt(0).toUpperCase();
                userBadge.style.display = 'flex';
                
                // Admin 계정이면 관리자 패널 표시
                if (user.username.toLowerCase() === 'admin') {
                    setTimeout(() => {
                        showAdminPanel();
                    }, 500);
                }
            } else {
                loginModal.classList.add('active');
            }
        }
		
        function updateReportTotal() {
            const managerReportTable = document.getElementById('manager-report-table');
            if (!managerReportTable) return;
            const nameInputs = managerReportTable.querySelectorAll('.report-input');
            let count = 0;
            nameInputs.forEach(input => {
                if (input.value.trim() !== '' && input.value.trim() !== '-') {
                    count++;
                }
            });
            const reportTotalCell = document.getElementById('report-manager-total');
            if(reportTotalCell) reportTotalCell.textContent = count;
        }
		
		function updateConnectionStatus(connected) {
            const status = document.getElementById('connectionStatus');
            const dot = document.getElementById('statusDot');
            const text = document.getElementById('statusText');
            
            if (connected) {
                status.className = 'connection-status connected';
                dot.className = 'status-dot connected';
                text.textContent = '서버 연결 완료';
            } else {
                status.className = 'connection-status';
                dot.className = 'status-dot';
                text.textContent = '연결 중...';
            }
        }

        function calculateAll() {
            const dateElement = document.getElementById('current-date');
            if (dateElement) {
                const now = new Date();
                const dateStr = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} (${['일','월','화','수','목','금','토'][now.getDay()]})`;
                dateElement.textContent = dateStr;
            }
            
            const permTcPlan = parseInt(document.getElementById('perm-tc-plan')?.value) || 0;
            const permTcActual = parseInt(document.getElementById('perm-tc-actual')?.value) || 0;
            const permPermPlan = parseInt(document.getElementById('perm-perm-plan')?.value) || 0;
            const permPermActual = parseInt(document.getElementById('perm-perm-actual')?.value) || 0;
            const tempTempPlan = parseInt(document.getElementById('temp-temp-plan')?.value) || 0;
            const tempTempActual = parseInt(document.getElementById('temp-temp-actual')?.value) || 0;
            const tempNewbiePlan = parseInt(document.getElementById('temp-newbie-plan')?.value) || 0;
            const tempNewbieActual = parseInt(document.getElementById('temp-newbie-actual')?.value) || 0;
            
            const permTcGap = permTcActual - permTcPlan;
            const permPermGap = permPermActual - permPermPlan;
            const tempTempGap = tempTempActual - tempTempPlan;
            const tempNewbieGap = tempNewbieActual - tempNewbiePlan;
            
            const permTotalPlan = permTcPlan + permPermPlan;
            const permTotalActual = permTcActual + permPermActual;
            const permTotalGap = permTotalActual - permTotalPlan;
            
            const tempTotalPlan = tempTempPlan + tempNewbiePlan;
            const tempTotalActual = tempTempActual + tempNewbieActual;
            const tempTotalGap = tempTotalActual - tempTotalPlan;
            
            const grandTotalPlan = permTotalPlan + tempTotalPlan;
            const grandTotalActual = permTotalActual + tempTotalActual;
            const grandTotalGap = grandTotalActual - grandTotalPlan;
            
            const hiringRate = grandTotalPlan > 0 ? ((grandTotalActual / grandTotalPlan) * 100).toFixed(0) : 0;
            
            const setGapColor = (element, value) => {
                if (!element) return;
                if (value > 0) {
                    element.style.color = '#4ade80';
                    element.textContent = '+' + value;
                } else if (value < 0) {
                    element.style.color = '#f87171';
                    element.textContent = value;
                } else {
                    element.style.color = 'var(--text-primary)';
                    element.textContent = '0';
                }
            };
            
            setGapColor(document.getElementById('perm-tc-gap'), permTcGap);
            setGapColor(document.getElementById('perm-perm-gap'), permPermGap);
            setGapColor(document.getElementById('temp-temp-gap'), tempTempGap);
            setGapColor(document.getElementById('temp-newbie-gap'), tempNewbieGap);
            
            if (document.getElementById('perm-total-plan')) document.getElementById('perm-total-plan').textContent = permTotalPlan;
            if (document.getElementById('perm-total-actual')) document.getElementById('perm-total-actual').textContent = permTotalActual;
            setGapColor(document.getElementById('perm-total-gap'), permTotalGap);
            
            if (document.getElementById('temp-total-plan')) document.getElementById('temp-total-plan').textContent = tempTotalPlan;
            if (document.getElementById('temp-total-actual')) document.getElementById('temp-total-actual').textContent = tempTotalActual;
            setGapColor(document.getElementById('temp-total-gap'), tempTotalGap);
            
            if (document.getElementById('grand-total-plan')) document.getElementById('grand-total-plan').textContent = grandTotalPlan;
            if (document.getElementById('grand-total-actual')) document.getElementById('grand-total-actual').textContent = grandTotalActual;
            setGapColor(document.getElementById('grand-total-gap'), grandTotalGap);
            
            const hiringRateElement = document.getElementById('hiring-rate');
            if (hiringRateElement) hiringRateElement.textContent = hiringRate;

            const reportTcActual = permTcActual;
            const reportPermActual = permPermActual;
            const reportTempActual = tempTempActual;
            const reportTotalActual = reportTcActual + reportPermActual + reportTempActual;

            if(document.getElementById('report-tc-actual')) document.getElementById('report-tc-actual').textContent = reportTcActual + ' 명';
            if(document.getElementById('report-perm-actual')) document.getElementById('report-perm-actual').textContent = reportPermActual + ' 명';
            if(document.getElementById('report-temp-actual')) document.getElementById('report-temp-actual').textContent = reportTempActual + ' 명';
            if(document.getElementById('report-total-actual')) document.getElementById('report-total-actual').textContent = reportTotalActual + ' 명';

            updateReportTotal();
        }
		
		// DATA 탭 초기화
        function initializeDataTab() {
            // 행 추가 버튼 이벤트
            document.querySelectorAll('.add-row-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const tableType = e.target.dataset.table;
                    addTableRow(tableType);
                });
            });

            // 행 삭제 버튼 이벤트
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('delete-row-btn')) {
                    const row = e.target.closest('tr');
                    if (row.parentElement.querySelectorAll('tr').length > 1) {
                        row.remove();
                        saveDataTabToFirestore();
                    } else {
                        alert('최소 1개의 행은 유지해야 합니다.');
                    }
                }
            });

            // 입력 변경 시 자동 저장
            document.querySelectorAll('.data-input, .data-select, .skill-checkbox').forEach(input => {
                input.addEventListener('change', saveDataTabToFirestore);
                input.addEventListener('input', saveDataTabToFirestore);
            });

            // Firestore에서 데이터 불러오기
            loadDataTabFromFirestore();
        }

        // 행 추가 함수
    function addTableRow(tableType) {
        const tbody = document.getElementById(`${tableType}-tbody`);
        if (!tbody) {
            console.error(`테이블의 tbody ('${tableType}-tbody')를 찾을 수 없습니다.`);
            return;
        }
        
        const templates = {
            managers: `
                <tr class="data-row">
                    <td><input type="text" class="data-input" placeholder="원바코드 입력"></td>
                    <td><input type="text" class="data-input" placeholder="닉네임 입력"></td>
                    <td><input type="text" class="data-input" placeholder="이름 입력"></td>
                    <td><button class="delete-row-btn">🗑️</button></td>
                </tr>
            `,
            tc: `
                <tr class="data-row">
                    <td><input type="text" class="data-input" placeholder="원바코드 입력"></td>
                    <td><input type="text" class="data-input" placeholder="닉네임 입력"></td>
                    <td><input type="text" class="data-input" placeholder="이름 입력"></td>
                    <td><button class="delete-row-btn">🗑️</button></td>
                </tr>
            `,
            ps: `
                <tr class="data-row">
                    <td><input type="text" class="data-input" placeholder="원바코드 입력"></td>
                    <td>
                        <select class="data-select">
                            <option value="">선택</option><option value="A">A조</option><option value="B">B조</option><option value="C">C조</option><option value="D">D조</option><option value="E">E조</option><option value="F">F조</option><option value="G">G조</option>
                        </select>
                    </td>
                    <td><input type="text" class="data-input" placeholder="이름 입력"></td>
                    <td><button class="delete-row-btn">🗑️</button></td>
                </tr>
            `,
            permanent: `
                <tr class="data-row">
                    <td><input type="text" class="data-input" placeholder="원바코드"></td>
                    <td>
                        <select class="data-select">
                            <option value="">선택</option><option value="A">A조</option><option value="B">B조</option><option value="C">C조</option><option value="D">D조</option><option value="E">E조</option><option value="F">F조</option><option value="G">G조</option>
                        </select>
                    </td>
                    <td><input type="text" class="data-input" placeholder="이름"></td>
                    <td><input type="checkbox" class="skill-checkbox"></td><td><input type="checkbox" class="skill-checkbox"></td><td><input type="checkbox" class="skill-checkbox"></td><td><input type="checkbox" class="skill-checkbox"></td><td><input type="checkbox" class="skill-checkbox"></td><td><input type="checkbox" class="skill-checkbox"></td><td><input type="checkbox" class="skill-checkbox"></td>
                    <td><button class="delete-row-btn">🗑️</button></td>
                </tr>
            `,
            temporary: `
                <tr class="data-row">
                    <td><input type="text" class="data-input" placeholder="원바코드"></td>
                    <td><input type="text" class="data-input" placeholder="이름"></td>
                    <td><input type="checkbox" class="skill-checkbox"></td><td><input type="checkbox" class="skill-checkbox"></td><td><input type="checkbox" class="skill-checkbox"></td><td><input type="checkbox" class="skill-checkbox"></td><td><input type="checkbox" class="skill-checkbox"></td><td><input type="checkbox" class="skill-checkbox"></td><td><input type="checkbox" class="skill-checkbox"></td>
                    <td><button class="delete-row-btn">🗑️</button></td>
                </tr>
            `,
            newbie: `
                <tr class="data-row">
                    <td><input type="text" class="data-input" placeholder="원바코드 입력"></td>
                    <td><input type="text" class="data-input" placeholder="이름 입력"></td>
                    <td><button class="delete-row-btn">🗑️</button></td>
                </tr>
            `,
            cd: `
                <tr class="data-row">
                    <td><input type="text" class="data-input" placeholder="원바코드 입력"></td>
                    <td>
                        <select class="data-select">
                            <option value="">선택</option><option value="OB">OB</option><option value="IB">IB</option><option value="ICQA">ICQA</option><option value="HUB">HUB</option><option value="CFC">CFC</option>
                        </select>
                    </td>
                    <td><input type="text" class="data-input" placeholder="이름 입력"></td>
                    <td><button class="delete-row-btn">🗑️</button></td>
                </tr>
            `
        };

        // ★★★ 여기가 수정된 부분입니다 ★★★
        // 이전에 문제가 있던 방식 대신, HTML 문자열을 직접 안전하게 삽입하는 방식으로 변경했습니다.
        tbody.insertAdjacentHTML('beforeend', templates[tableType]);
        const newRow = tbody.lastElementChild; // 방금 추가된 마지막 행을 정확히 찾습니다.

        // 새로 추가된 행의 모든 입력 요소에 이벤트 리스너를 다시 설정합니다.
        newRow.querySelectorAll('.data-input, .data-select, .skill-checkbox').forEach(input => {
            input.addEventListener('change', saveDataTabToFirestore);
            input.addEventListener('input', saveDataTabToFirestore);
        });

        saveDataTabToFirestore();
    }

        // DATA 탭 저장
        function saveDataTabToFirestore() {
            const tables = ['managers', 'tc', 'ps', 'permanent', 'temporary', 'newbie', 'cd'];
            const dataToSave = {};

            tables.forEach(tableType => {
                const tbody = document.getElementById(`${tableType}-tbody`);
                if (!tbody) return;

                const rows = [];
                tbody.querySelectorAll('tr').forEach(row => {
                    const inputs = row.querySelectorAll('.data-input');
                    const selects = row.querySelectorAll('.data-select');
                    const checkboxes = row.querySelectorAll('.skill-checkbox');

                    const rowData = {
                        inputs: Array.from(inputs).map(input => input.value),
                        selects: Array.from(selects).map(select => select.value),
                        checkboxes: Array.from(checkboxes).map(checkbox => checkbox.checked)
                    };

                    rows.push(rowData);
                });

                dataToSave[tableType] = rows;
            });

            const dataDocRef = doc(db, "employeeData", "current");
            setDoc(dataDocRef, dataToSave, { merge: true });
        }

        // DATA 탭 불러오기
        function loadDataTabFromFirestore() {
            const dataDocRef = doc(db, "employeeData", "current");
            onSnapshot(dataDocRef, (doc) => {
                if (doc.exists()) {
                    const data = doc.data();
                    restoreDataTab(data);
                }
            });
        }
									
		// DATA 탭 복원
        function restoreDataTab(data) {
            const tables = ['managers', 'tc', 'ps', 'permanent', 'temporary', 'newbie', 'cd'];

            tables.forEach(tableType => {
                const tbody = document.getElementById(`${tableType}-tbody`);
                if (!tbody || !data[tableType]) return;

                tbody.innerHTML = '';

                data[tableType].forEach(rowData => {
                    const row = document.createElement('tr');
                    row.className = 'data-row';

                    let cellsHTML = '';
                    let inputIndex = 0;
                    let selectIndex = 0;
                    let checkboxIndex = 0;

                    // 각 테이블 타입별로 적절한 구조 생성
                    const structures = {
                        managers: ['input', 'input', 'input', 'delete'],
                        tc: ['input', 'input', 'input', 'delete'],
                        ps: ['input', 'select', 'input', 'delete'],
                        permanent: ['input', 'select', 'input', 'checkbox', 'checkbox', 'checkbox', 'checkbox', 'checkbox', 'checkbox', 'checkbox', 'delete'],
                        temporary: ['input', 'input', 'checkbox', 'checkbox', 'checkbox', 'checkbox', 'checkbox', 'checkbox', 'checkbox', 'delete'],
                        newbie: ['input', 'input', 'delete'],
                        cd: ['input', 'select', 'input', 'delete']
                    };

                    structures[tableType].forEach(type => {
                        if (type === 'input') {
                            const value = rowData.inputs[inputIndex++] || '';
                            cellsHTML += `<td><input type="text" class="data-input" value="${value}"></td>`;
                        } else if (type === 'select') {
                            const value = rowData.selects[selectIndex++] || '';
                            let options = '';
                            
                            if (tableType === 'ps' || tableType === 'permanent') {
                                options = `
                                    <option value="">선택</option>
                                    <option value="A" ${value === 'A' ? 'selected' : ''}>A조</option>
                                    <option value="B" ${value === 'B' ? 'selected' : ''}>B조</option>
                                    <option value="C" ${value === 'C' ? 'selected' : ''}>C조</option>
                                    <option value="D" ${value === 'D' ? 'selected' : ''}>D조</option>
                                    <option value="E" ${value === 'E' ? 'selected' : ''}>E조</option>
                                    <option value="F" ${value === 'F' ? 'selected' : ''}>F조</option>
                                    <option value="G" ${value === 'G' ? 'selected' : ''}>G조</option>
                                `;
                            } else if (tableType === 'cd') {
                                options = `
                                    <option value="">선택</option>
                                    <option value="OB" ${value === 'OB' ? 'selected' : ''}>OB</option>
                                    <option value="IB" ${value === 'IB' ? 'selected' : ''}>IB</option>
                                    <option value="ICQA" ${value === 'ICQA' ? 'selected' : ''}>ICQA</option>
                                    <option value="HUB" ${value === 'HUB' ? 'selected' : ''}>HUB</option>
                                    <option value="CFC" ${value === 'CFC' ? 'selected' : ''}>CFC</option>
                                `;
                            }
                            
                            cellsHTML += `<td><select class="data-select">${options}</select></td>`;
                        } else if (type === 'checkbox') {
                            const checked = rowData.checkboxes[checkboxIndex++] ? 'checked' : '';
                            cellsHTML += `<td><input type="checkbox" class="skill-checkbox" ${checked}></td>`;
                        } else if (type === 'delete') {
                            cellsHTML += `<td><button class="delete-row-btn">🗑️</button></td>`;
                        }
                    });

                    row.innerHTML = cellsHTML;
                    tbody.appendChild(row);

                    // 이벤트 리스너 추가
                    row.querySelectorAll('.data-input, .data-select, .skill-checkbox').forEach(input => {
                        input.addEventListener('change', saveDataTabToFirestore);
                        input.addEventListener('input', saveDataTabToFirestore);
                    });
                });
            });
        }
    </script>
	
	<!-- 로그인 -->
	<div class="login-modal" id="loginModal">
        <div class="login-box">
            <h2 class="login-title">🚀 PDA일지 로그인</h2>
            <p class="login-subtitle">GWJ2 OB 인원 관리 시스템</p>
            <input type="text" id="loginEmail" class="login-input" placeholder="아이디">
            <input type="password" id="loginPassword" class="login-input" placeholder="비밀번호">
            <div id="loginError" class="error-message" style="display: none;"></div>
            <button id="loginBtn" class="login-btn">로그인</button>
            <button id="registerBtn" class="login-btn" style="background: linear-gradient(135deg, #38bdf8, #3b82f6); margin-top: 12px;">회원가입</button>
        </div>
    </div>

    <!-- 변경 로그 패널 -->
    <div class="activity-log-panel" id="activityLogPanel">
        <div class="activity-log-header">
            <div class="activity-log-title">📋 변경 내역</div>
            <button class="close-log-btn" id="closeLogBtn">×</button>
        </div>
        <div class="activity-log-content" id="activityLogContent">
            <div class="log-empty">아직 변경 내역이 없습니다.</div>
        </div>
    </div>
</body>
</html>